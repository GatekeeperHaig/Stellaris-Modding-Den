ex_new_worlds_change_habitability_trait_correspondence = {
	if = {
		limit = { exists = pop pop = { has_pop_flag = preference_correspondence } } 
		else = { break = yes }
		random_owned_pop = {
			limit = { has_pop_flag = preference_correspondence }
			if = {
				limit = { is_presapient_pop = yes }
				remove_pop_flag = preference_correspondence
				if = { 
					limit = { prev = { is_planet_class = pc_geocrystalline } }
					species = { save_event_target_as = presapient_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_geocrystalline_preference
							trait = random_presapient_trait							
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:presapient_target_species } }
							change_species = last_created
						}	
					}	
				}
				if = { 
					limit = { prev = { is_planet_class = pc_terraformed } }
					species = { save_event_target_as = presapient_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_terraformed_preference
							trait = random_presapient_trait							
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:presapient_target_species } }
							change_species = last_created
						}	
					}	
				}			
				if = { 
					limit = { prev = { is_planet_class = pc_greenhouse_cold } }
					species = { save_event_target_as = presapient_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_greenhouse_cold_preference
							trait = random_presapient_trait							
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:presapient_target_species } }
							change_species = last_created
						}	
					}	
				}				
				if = { 
					limit = { prev = { is_planet_class = pc_lush } }
					species = { save_event_target_as = presapient_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_lush_preference
							trait = random_presapient_trait							
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:presapient_target_species } }
							change_species = last_created
						}	
					}	
				}		
				if = { 
					limit = { prev = { is_planet_class = pc_retinal } }
					species = { save_event_target_as = presapient_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_retinal_preference
							trait = random_presapient_trait							
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:presapient_target_species } }
							change_species = last_created
						}	
					}	
				}
				if = { 
					limit = { prev = { is_planet_class = pc_marginal } }
					species = { save_event_target_as = presapient_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_marginal_preference
							trait = random_presapient_trait							
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:presapient_target_species } }
							change_species = last_created
						}	
					}	
				}
				if = { 
					limit = { prev = { is_planet_class = pc_marginal_dry } }
					species = { save_event_target_as = presapient_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_marginal_dry_preference
							trait = random_presapient_trait							
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:presapient_target_species } }
							change_species = last_created
						}	
					}	
				}	
				if = { 
					limit = { prev = { is_planet_class = pc_marginal_cold } }
					species = { save_event_target_as = presapient_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_marginal_cold_preference
							trait = random_presapient_trait							
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:presapient_target_species } }
							change_species = last_created
						}	
					}	
				}			
			}	
			if = {
				limit = { owner = { is_country_type = primitive } }
				remove_pop_flag = preference_correspondence
				if = { 
					limit = { prev = { is_planet_class = pc_geocrystalline } }
					species = { save_event_target_as = primitive_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_geocrystalline_preference
							trait = random_traits						
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:primitive_target_species } }
							change_species = last_created
						}						
					}	
				}
				if = { 
					limit = { prev = { is_planet_class = pc_terraformed } }
					species = { save_event_target_as = primitive_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_terraformed_preference
							trait = random_traits						
						}
						sapient = yes
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:primitive_target_species } }
							change_species = last_created
						}	
					}	
				}			
				if = { 
					limit = { prev = { is_planet_class = pc_greenhouse_cold } }
					species = { save_event_target_as = primitive_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_greenhouse_cold_preference
							trait = random_traits						
						}
						sapient = yes
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:primitive_target_species } }
							change_species = last_created
						}	
					}	
				}				
				if = { 
					limit = { prev = { is_planet_class = pc_lush } }
					species = { save_event_target_as = primitive_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_lush_preference
							trait = random_traits						
						}
						sapient = yes
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:primitive_target_species } }
							change_species = last_created
						}	
					}	
				}		
				if = { 
					limit = { prev = { is_planet_class = pc_retinal } }
					species = { save_event_target_as = primitive_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_retinal_preference
							trait = random_traits						
						}
						sapient = yes
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:primitive_target_species } }
							change_species = last_created
						}	
					}	
				}
				if = { 
					limit = { prev = { is_planet_class = pc_marginal } }
					species = { save_event_target_as = primitive_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_marginal_preference
							trait = random_traits						
						}
						sapient = yes
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:primitive_target_species } }
							change_species = last_created
						}	
					}	
				}
				if = { 
					limit = { prev = { is_planet_class = pc_marginal_dry } }
					species = { save_event_target_as = primitive_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_marginal_dry_preference
							trait = random_traits						
						}
						sapient = yes
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:primitive_target_species } }
							change_species = last_created
						}	
					}	
				}	
				if = { 
					limit = { prev = { is_planet_class = pc_marginal_cold } }
					species = { save_event_target_as = primitive_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_marginal_cold_preference
							trait = random_traits						
						}
						sapient = yes
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:primitive_target_species } }
							change_species = last_created
						}	
					}	
				}			
			}	
			if = {
				limit = {
					OR = {
						NOT = { exists = owner }
						AND = {
							exists = owner
							owner = { NOT = { is_country_type = primitive } }
							OR = {
								NOT = { species = { is_same_value = owner.species } }
								is_subspecies = yes
							}	
						}
					}	
				}
				remove_pop_flag = preference_correspondence
				remove_habitability_trait = yes
				if = { 
					limit = { prev = { is_planet_class = pc_geocrystalline } }
					modify_species = { species = this add_trait = trait_pc_geocrystalline_preference }
				}
				if = { 
					limit = { prev = { is_planet_class = pc_terraformed } }
					modify_species = { species = this add_trait = trait_pc_terraformed_preference }
				}			
				if = { 
					limit = { prev = { is_planet_class = pc_greenhouse_cold } }
					modify_species = { species = this add_trait = trait_pc_greenhouse_cold_preference }
				}						
				if = { 
					limit = { prev = { is_planet_class = pc_retinal } }
					modify_species = { species = this add_trait = trait_pc_retinal_preference }
				}									
				if = { 
					limit = { prev = { is_planet_class = pc_lush } }
					modify_species = { species = this add_trait = trait_pc_lush_preference }
				}
				if = { 
					limit = { prev = { is_planet_class = pc_marginal } }
					modify_species = { species = this add_trait = trait_pc_marginal_preference }
				}			
				if = { 
					limit = { prev = { is_planet_class = pc_marginal_dry } }
					modify_species = { species = this add_trait = trait_pc_marginal_dry_preference }
				}			
				if = { 
					limit = { prev = { is_planet_class = pc_marginal_cold } }
					modify_species = { species = this add_trait = trait_pc_marginal_cold_preference }
				}						
			}
			ex_new_worlds_change_habitability_trait_correspondence = yes
		}
	}	
}