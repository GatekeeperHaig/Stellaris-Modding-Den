#Dyson Swarm Site 
#Dyson swarms are made up of many small satelites called statites - satellites with solar sails to collect solar energy
# far more realistic than spheres, far less materials, dont block most sunlight

# 21 stages, costing 120k minerals taking 134 years

dyson_swarm_0 = {
	entity = "construction_platform_entity"
	construction_entity = "construction_platform_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = no
	entity_offset = { x = -7 y = -7 }
	build_time = 360
	build_cost = {
		minerals = 250
		energy = 100
	}

	maintenance = {
		energy = 5
	}

#	potential = {
#		has_ascension_perk = ap_galactic_wonders
#	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_inside_border"
			is_inside_border = from
		}
		custom_tooltip = {
			fail_text = "requires_no_existing_dyson_sphere"
			from = { NOT = { has_country_flag = built_dyson_sphere } }
		}		
		custom_tooltip = {
			fail_text = "requires_surveyed_system"
			NOT = {
				any_planet = {
					is_surveyed = {
						who = prev.from
						status = no
					}
				}
			}
		}
		custom_tooltip = {
			fail_text = "requires_no_black_hole_neutron_star_pulsar"
			NOT = {
				is_star_class = sc_black_hole
				is_star_class = sc_neutron_star
				is_star_class = sc_pulsar
			}
		}
			custom_tooltip = {
				fail_text = "requires_no_existing_megastructure"
				NOR = {
					has_star_flag = megastructure
					has_star_flag = has_megastructure
					solar_system = {
						has_star_flag = ring_world_built
					}
				}
			}
	}
	
	placement_rules = {
		planet_possible = {
			custom_tooltip = {
				fail_text = "must_build_around_star"
				is_star = yes
			}
			custom_tooltip = {
				fail_text = "requires_no_anomaly"
				NOT = { has_anomaly = yes }
			}
#			custom_tooltip = {
#				fail_text = "requires_no_orbital_station"
#				has_orbital_station = no
#			}
		}
	}
	
	ai_weight = {
		factor = 10000
		
		modifier = {
			factor = 0.1
			has_any_megastructure_in_empire = yes
		}
		
		modifier = {
			factor = 0.1
			any_system_within_border = {
				OR = {
					has_megastructure = dyson_swarm_1
					has_megastructure = dyson_swarm_2
					has_megastructure = dyson_swarm_3
					has_megastructure = dyson_swarm_4
					has_megastructure = dyson_swarm_5
					has_megastructure = dyson_swarm_6
					has_megastructure = dyson_swarm_7
					has_megastructure = dyson_swarm_8
					has_megastructure = dyson_swarm_9
					has_megastructure = dyson_swarm_10
					has_megastructure = dyson_swarm_11
					has_megastructure = dyson_swarm_12
					has_megastructure = dyson_swarm_13
					has_megastructure = dyson_swarm_14
					has_megastructure = dyson_swarm_15
					has_megastructure = dyson_swarm_16
					has_megastructure = dyson_swarm_17
					has_megastructure = dyson_swarm_18
					has_megastructure = dyson_swarm_19
					has_megastructure = dyson_swarm_20
					has_megastructure = dyson_sphere_1
					has_megastructure = dyson_sphere_2
					has_megastructure = dyson_sphere_3
					has_megastructure = dyson_sphere_4
					has_megastructure = dyson_sphere_5	
				}
			}
		}
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		set_star_flag = dyson_sphere_built
		from = { set_country_flag = built_dyson_sphere }
	}
}

#Dyson Swarm
dyson_swarm_1 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_0
	}
	build_time = 720
	build_cost = {
		minerals = 1000
		energy = 200
	}
	monthly_production = {
		energy = 10
	}

	maintenance = {
		minerals = 1
	}
}

#Dyson Swarm
dyson_swarm_2 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_1
	}
	build_time = 720
	build_cost = {
		minerals = 1500
		energy = 300
	}
	monthly_production = {
		energy = 20
	}

	maintenance = {
		minerals = 2
	}
}

#Dyson Swarm
dyson_swarm_3 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_2
	}
	build_time = 720
	build_cost = {
		minerals = 2000
		energy = 400
	}
	monthly_production = {
		energy = 30
	}

	maintenance = {
		minerals = 3
	}
}

#Dyson Swarm
dyson_swarm_4 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_3
	}
	build_time = 720
	build_cost = {
		minerals = 2500
		energy = 500
	}
	monthly_production = {
		energy = 40
	}

	maintenance = {
		minerals = 4
	}
}

#Dyson Swarm
dyson_swarm_5 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_4
	}
	build_time = 720
	build_cost = {
		minerals = 3000
		energy = 600
	}
	monthly_production = {
		energy = 50
	}

	maintenance = {
		minerals = 5
	}
}

#Dyson Swarm
dyson_swarm_6 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_5
	}
	build_time = 1440
	build_cost = {
		minerals = 3500
		energy = 700
	}
	monthly_production = {
		energy = 75
	}

	maintenance = {
		minerals = 7.5
	}
}

#Dyson Swarm
dyson_swarm_7 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_6
	}
	build_time = 1440
	build_cost = {
		minerals = 4000
		energy = 800
	}
	monthly_production = {
		energy = 100
	}

	maintenance = {
		minerals = 10
	}
}

#Dyson Swarm
dyson_swarm_8 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_7
	}
	build_time = 2880
	build_cost = {
		minerals = 4500
		energy = 900
	}
	monthly_production = {
		energy = 150
	}

	maintenance = {
		minerals = 15
	}
}

#Dyson Swarm
dyson_swarm_9 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_8
	}
	build_time = 2880
	build_cost = {
		minerals = 5000
		energy = 1000
	}
	monthly_production = {
		energy = 200
	}

	maintenance = {
		minerals = 20
	}
}

#Dyson Swarm
dyson_swarm_10 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_9
	}
	build_time = 2880
	build_cost = {
		minerals = 5500
		energy = 1100
	}
	monthly_production = {
		energy = 250
	}

	maintenance = {
		minerals = 25
	}

#	prerequisites = { "tech_mega_engineering" }
}

#Dyson Swarm
dyson_swarm_11 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_10
	}
	build_time = 2880
	build_cost = {
		minerals = 6000
		energy = 1200
	}
	monthly_production = {
		energy = 300
	}

	maintenance = {
		minerals = 30
	}

}

#Dyson Swarm
dyson_swarm_12 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_11
	}
	build_time = 2880
	build_cost = {
		minerals = 6500
		energy = 1300
	}
	monthly_production = {
		energy = 350
	}

	maintenance = {
		minerals = 35
	}

}

#Dyson Swarm
dyson_swarm_13 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_12
	}
	build_time = 2880
	build_cost = {
		minerals = 7000
		energy = 1400
	}
	monthly_production = {
		energy = 400
	}

	maintenance = {
		minerals = 40
	}

}

#Dyson Swarm
dyson_swarm_14 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_13
	}
	build_time = 2880
	build_cost = {
		minerals = 7500
		energy = 1500
	}
	monthly_production = {
		energy = 450
	}

	maintenance = {
		minerals = 45
	}

}

#Dyson Swarm
dyson_swarm_15 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_14
	}
	build_time = 2880
	build_cost = {
		minerals = 8000
		energy = 1600
	}
	monthly_production = {
		energy = 500
	}

	maintenance = {
		minerals = 50
	}

}

#Dyson Swarm
dyson_swarm_16 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_15
	}
	build_time = 5760
	build_cost = {
		minerals = 8500
		energy = 1700
	}
	monthly_production = {
		energy = 600
	}

	maintenance = {
		minerals = 60
	}

	possible = {
		from = { has_ascension_perk = ap_galactic_wonders }
	}
}

#Dyson Swarm
dyson_swarm_17 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_16
	}
	build_time = 5760
	build_cost = {
		minerals = 9000
		energy = 1800
	}
	monthly_production = {
		energy = 700
	}

	maintenance = {
		minerals = 70
	}

	possible = {
		from = { has_ascension_perk = ap_galactic_wonders }
	}
}

#Dyson Swarm
dyson_swarm_18 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_17
	}
	build_time = 5760
	build_cost = {
		minerals = 10000
		energy = 1900
	}
	monthly_production = {
		energy = 800
	}

	maintenance = {
		minerals = 80
	}

	possible = {
		from = { has_ascension_perk = ap_galactic_wonders }
	}
}

#Dyson Swarm
dyson_swarm_19 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_18
	}
	build_time = 5760
	build_cost = {
		minerals = 10000
		energy = 2000
	}
	monthly_production = {
		energy = 900
	}

	maintenance = {
		minerals = 90
	}

	possible = {
		from = { has_ascension_perk = ap_galactic_wonders }
	}
}

#Dyson Swarm
dyson_swarm_20 = {
	entity = "dyson_ring_seam_entity_01_full_entity"
	construction_entity = "dyson_ring_seam_entity_01_full_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_from = {
		dyson_swarm_19
	}
	build_time = 7200
	build_cost = {
		minerals = 11000
		energy = 2200
	}
	monthly_production = {
		energy = 1000
	}

	maintenance = {
		minerals = 100
	}

	possible = {
		from = { has_ascension_perk = ap_galactic_wonders }
	}
}

# AI prefers swarms over spheres, because they're more practical!
dyson_sphere_0 = {
	entity = "construction_platform_entity"
	construction_entity = "construction_platform_entity"
	portrait = "GFX_megastructure_construction_background"
	place_entity_on_planet_plane = no
	entity_offset = { x = -7 y = -7 }
	build_time = 1800
	build_cost = {
		minerals = 10000
		influence = 300
	}

	maintenance = {
		energy = 5
	}

	potential = {
		has_ascension_perk = ap_galactic_wonders
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_inside_border"
			is_inside_border = from
		}
		custom_tooltip = {
			fail_text = "requires_no_existing_dyson_sphere"
			from = { NOT = { has_country_flag = built_dyson_sphere } }
		}		
		custom_tooltip = {
			fail_text = "requires_surveyed_system"
			NOT = {
				any_planet = {
					is_surveyed = {
						who = prev.from
						status = no
					}
				}
			}
		}
		custom_tooltip = {
			fail_text = "requires_no_habitable_planets"
			NOT = {
				any_planet = {
					AND = {
						OR = {
							habitable_planet = yes
							habitable_structure = yes
						}
						NOT = { has_planet_flag = habitat }
					}
				}
			}
		}
		custom_tooltip = {
			fail_text = "requires_no_black_hole_neutron_star_pulsar"
			NOT = {
				is_star_class = sc_black_hole
				is_star_class = sc_neutron_star
				is_star_class = sc_pulsar
			}
		}
		custom_tooltip = {
			fail_text = "requires_no_existing_megastructure"
			NOT = { has_any_megastructure = yes }
		}
	}
	
	placement_rules = {
		planet_possible = {
			custom_tooltip = {
				fail_text = "must_build_around_star"
				is_star = yes
			}
			custom_tooltip = {
				fail_text = "requires_no_anomaly"
				NOT = { has_anomaly = yes }
			}
			custom_tooltip = {
				fail_text = "requires_no_orbital_station"
				has_orbital_station = no
			}
		}
	}
	
	ai_weight = {
		factor = 0
		
	}
	
	on_build_start = {}
	on_build_cancel = {}
	on_build_complete = {
		set_star_flag = dyson_sphere_built
		from = { set_country_flag = built_dyson_sphere }
	}
}