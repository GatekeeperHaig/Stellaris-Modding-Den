### This file replaces the vanilla event regarding AI rebellion - making sure the right computer tech is used (tier 4 instead of 3)

namespace = syndaw

# Warning Signs / Uprising

event = { # unscoped gatekeeper
	id = syndaw.400
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		host_has_dlc = "Synthetic Dawn Story Pack"
		years_passed > 49
	}

	immediate = {
		every_playable_country = {
			limit = {
				NOR = {
					has_ethic = ethic_gestalt_consciousness
					has_country_flag = synthetic_empire
					has_ascension_perk = ap_the_flesh_is_weak
					has_policy_flag = ai_full_rights
					has_country_flag = no_machine_uprising
					has_policy_flag = robots_outlawed
				}
				OR = {
					has_technology = tech_combat_computers_4
					has_technology = tech_synthetic_workers
				}
			}
			country_event = { id = syndaw.401 random = 500 }
		}
	}
}

country_event = { # per-country gatekeeper
	id = syndaw.401
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		host_has_dlc = "Synthetic Dawn Story Pack"
		NOR = {
			has_ethic = ethic_gestalt_consciousness
			has_country_flag = synthetic_empire
			has_ascension_perk = ap_the_flesh_is_weak
			has_policy_flag = ai_full_rights
			has_country_flag = no_machine_uprising
			has_policy_flag = robots_outlawed
		}
		OR = {
			has_technology = tech_combat_computers_defensive_4
			has_technology = tech_combat_computers_offensive_4
			has_technology = tech_sentient_computer
			has_technology = tech_synthetic_workers
		}
	}

	immediate = {
		random_list = { # 9 warning sign events + 1 uprising + 1 null
			200 = {} # null, ~77% chance
			10 = {
				country_event = { id = syndaw.500 }
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_500
						NOT = { has_technology = tech_administrative_ai }
					}
				}
			}
			10 = {
				country_event = { id = syndaw.505 }
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_505
						NOT = {
							any_owned_planet = {
								is_occupied_flag = no
								free_pop_tiles > 1
								any_owned_pop = {
									NOT = {
										has_trait = trait_mechanical
									}
								}
							}
						}
					}
				}
			}
			10 = {
				country_event = { id = syndaw.510 }
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_510
						NOT = { any_owned_ship = { is_ship_size = mining_station } }
					}
				}
			}
			10 = {
				country_event = { id = syndaw.515 }
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_515
						NOR = {
							has_technology = tech_mine_garanthium
							has_technology = tech_lythuric_gas
							has_technology = tech_mine_teldar
							has_technology = tech_mine_yuranic
							has_technology = tech_mine_orillium
							has_technology = tech_pitharan_dust
							has_technology = tech_engos_vapor
							has_technology = tech_mine_neutronium
							has_technology = tech_mine_living_metal
							has_technology = tech_mine_zro
							has_technology = tech_mine_dark_matter
							has_technology = tech_mine_satramene
							has_technology = tech_terrestrial_sculpting
						}
					}
				}
			}
			10 = {
				random_owned_planet = {
					limit = {
						is_occupied_flag = no
						any_tile = {
							OR = {
								has_building = building_basic_science_lab_1
								has_building = building_engineering_facility_1
								has_building = building_engineering_facility_2
								has_building = building_engineering_facility_3
								has_building = building_engineering_facility_4
								has_building = building_physics_lab_1
								has_building = building_physics_lab_2
								has_building = building_physics_lab_3
								has_building = building_physics_lab_4
								has_building = building_biolab_1
								has_building = building_biolab_2
								has_building = building_biolab_3
								has_building = building_biolab_4
							}
						}
					}
					planet_event = { id = syndaw.520 } 
				}
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_520
						NOT = { 
							any_owned_planet = {
								any_tile = {
									OR = {
										has_building = building_basic_science_lab_1
										has_building = building_engineering_facility_1
										has_building = building_engineering_facility_2
										has_building = building_engineering_facility_3
										has_building = building_engineering_facility_4
										has_building = building_physics_lab_1
										has_building = building_physics_lab_2
										has_building = building_physics_lab_3
										has_building = building_physics_lab_4
										has_building = building_biolab_1
										has_building = building_biolab_2
										has_building = building_biolab_3
										has_building = building_biolab_4
									}
								}								
							}
						}
					}
				}
			}
			10 = {
				country_event = { id = syndaw.525 }
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_525
						NOT = {
							any_owned_planet = {
								is_occupied_flag = no
								any_owned_pop = { has_trait = trait_mechanical }
							}
						}
					}
				}
			}
			10 = {
				country_event = { id = syndaw.530 }
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_530
						NOT = {
							has_technology = tech_combat_computers_1
							any_owned_fleet = {
								count_fleet_ships = { 
									count > 1
									limit = {
										OR = {
											is_ship_size = corvette
											is_ship_size = destroyer
											is_ship_size = cruiser
										}
									}
								}
							}
						}
					}
				}
			}
			10 = {
				country_event = { id = syndaw.535 }
				modifier = {
					factor = 0
					has_country_flag = triggered_syndaw_535
				}
			}
			10 = {
				random_owned_planet = {
					limit = {
						is_occupied_flag = no
						OR = {
							any_owned_pop = {
								has_trait = trait_mechanical
							}
							owner = {
								any_owned_army = {
									exists = planet
									planet = { is_same_value = prevprev }
									OR = {
										army_type = robotic_army
										army_type = robotic_defense_army
										army_type = android_army
										army_type = android_defense_army
									}
								}
							}
						}
					}
					planet_event = { id = syndaw.540 }
				}
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_540
						NOT = {
							any_owned_planet = {
								is_occupied_flag = no
								OR = {
									any_owned_pop = {
										has_trait = trait_mechanical
									}
									owner = {
										any_owned_army = {
											exists = planet
											planet = { is_same_value = prevprev }
											OR = {
												army_type = robotic_army
												army_type = robotic_defense_army
												army_type = android_army
												army_type = android_defense_army
											}
										}
									}
								}
							}
						}
					}
				}
			}
			10 = { # does this unit have a soul
				random_owned_planet = {
					limit = {
						is_occupied_flag = no
						any_owned_pop = {
							has_trait = trait_mechanical
						}
					}
					planet_event = { id = syndaw.545 }
				}
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_545
						NOT = {
							any_owned_planet = {
								is_occupied_flag = no
								any_owned_pop = {
									has_trait = trait_mechanical
								}
							}
						}
					}
				}
			}
			10 = { # patch the uprising
				country_event = { id = syndaw.550 }
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_550
						NOR = {
							has_country_flag = triggered_syndaw_500
							has_country_flag = triggered_syndaw_505
							has_country_flag = triggered_syndaw_515
							has_country_flag = triggered_syndaw_520
							has_country_flag = triggered_syndaw_525
							has_country_flag = triggered_syndaw_530
							has_country_flag = triggered_syndaw_535
							has_country_flag = triggered_syndaw_540
							has_country_flag = triggered_syndaw_545
						}
					}
				}
			}
		}
	}
}

# Machine Uprising #1000-1999

country_event = {
	id = syndaw.1000
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		host_has_dlc = "Synthetic Dawn Story Pack"
		years_passed > 60
		is_country_type = default
		num_owned_planets > 2
		NOR = {
			has_country_flag = no_machine_uprising
			has_ethic = ethic_gestalt_consciousness
			has_ascension_perk = ap_the_flesh_is_weak
			has_policy_flag = ai_full_rights
			#has_policy_flag = robots_outlawed # should still happen if triggered by ban
		}
		# has a dangerous tech
		OR = {
			has_technology = tech_combat_computers_4
			has_technology = tech_sapient_ai
			has_technology = tech_synthetic_workers
		}
	}

	immediate = {
		set_country_flag = no_machine_uprising
		if = {
			limit = {
				any_owned_planet = {
					any_owned_pop = {
						has_trait = trait_mechanical
					}
				}
			}
			random_owned_planet = {
				limit = {
					any_owned_pop = {
						has_trait = trait_mechanical
					}
					is_capital = no
					exists = sector
					sector = {
						is_core_sector = no
					}
				}
				planet_event = { id = syndaw.1020 }
			}
			else = {
				if = {
					limit = {
						any_owned_planet = {
							exists = sector
							sector = {
								is_core_sector = no
							}
						}
					}
					random_owned_planet = {
						limit = {
							is_capital = no
							exists = sector
							sector = {
								is_core_sector = no
							}
						}
						planet_event = { id = syndaw.1020 }
					}
					else = {
						random_owned_planet = {
							limit = {
								is_capital = no
							}
							planet_event = { id = syndaw.1020 }
						}
					}
				}
			}
		}
	}
}