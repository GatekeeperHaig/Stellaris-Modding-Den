 ## this is the main resource spawning effect. It is called by the menu event in the after field.
cgm_spawn_engine = {
	if = { 
		limit = { NOT = { has_global_flag = cgm_prescripted_size_readjustment_disabled } }		
		prescripted_uninhabitable_planet_size_readjustment = yes
		prescripted_inhabitable_planet_size_readjustment = yes
		prescripted_asteroid_size_readjustment = yes
	}	
	if = {
		limit = { NOT = { has_global_flag = cgm_resources_disabled } }
		while = {
			limit = {
				NAND = {
					has_global_flag = unique_sr1 
					has_global_flag = unique_sr2 
					has_global_flag = unique_sr3 
					has_global_flag = unique_sr4 
					has_global_flag = unique_sr5 
					has_global_flag = unique_sr6 
					has_global_flag = unique_sr7 
					has_global_flag = unique_sr8 
					has_global_flag = unique_sr9 
				}
			}
			random_planet = {
				limit = {
					NOR = { 
						exists = owner
						exists = space_owner
					}
					habitable_planet = yes
					any_tile = { has_pop = no }
					solar_system = {
						NOR = {
							has_star_flag = empire_cluster
							has_star_flag = sol_system
							has_star_flag = deneb_system
							has_star_flag = custom_system
							has_star_flag = floating_system
							has_star_flag = crystal_system
							has_star_flag = city_system
							any_planet = { has_planet_flag = unique_sr }
							any_neighbor_system = { ignore_hyperlanes = no any_planet = { has_planet_flag = unique_sr } }
							any_neighbor_system = { ignore_hyperlanes = yes any_planet = { has_planet_flag = unique_sr } }
						}
					}
				}
				save_event_target_as = unique_resource_candidate
				cgm_pe_unique_sr_spawn_table = yes
			}
		}
	}
	if = { 
		limit = { NOT = { has_global_flag = cgm_no_capital_planet_resize } }
		every_playable_country = { 
			capital_scope = { 
				if = { 
					limit = { 
						is_homeworld = yes
						habitable_planet = yes
					}
					if = { 
						limit = { has_global_flag = cgm_very_large_capital_planet_size }
						while = { 
							limit = { planet_size < 23 }
							random_list = { 
								33.3 = { change_planet_size = 1 }
								33.3 = { change_planet_size = 2 }
								33.3 = { change_planet_size = 3 }
							}
						}
					}	
					else_if = { 
						limit = { has_global_flag = cgm_large_capital_planet_size }
						while = { 
							limit = { planet_size < 19 }
							random_list = { 
								33.3 = { change_planet_size = 1 }
								33.3 = { change_planet_size = 2 }
								33.3 = { change_planet_size = 3 }
							}
						}
					}					
					else_if = { 
						limit = { has_global_flag = cgm_small_capital_planet_size }
						while = { 
							limit = { planet_size > 15 }
							random_list = { 
								33.3 = { change_planet_size = -1 }
								33.3 = { change_planet_size = -2 }
								33.3 = { change_planet_size = -3 }
							}
						}
					}										
					else_if = { 
						limit = { has_global_flag = cgm_very_small_capital_planet_size }
						while = { 
							limit = { planet_size > 11 }
							random_list = { 
								33.3 = { change_planet_size = -1 }
								33.3 = { change_planet_size = -2 }
								33.3 = { change_planet_size = -3 }
							}
						}
					}															
				}
			}
		}	
	}				
	every_planet = {
		limit = { 
			has_global_flag = cgm_asteroid_colonization_enabled
			has_global_flag = cgm_prescripted_size_readjustment_disabled
			is_asteroid = yes
		}	
		prescripted_asteroid_size_readjustment = yes
	}		
	every_planet = {
		limit = {
			OR = {
				is_capital = no
				AND = { 
					exists = owner 
					owner = { is_ai = yes }
				}
			}
			habitable_structure = no
			planet_is_not_virtual = yes
			solar_system = {
				NOR = {
					has_star_flag = empire_home_system
					has_star_flag = sol_system
					has_star_flag = sol
					has_star_flag = deneb_system
					has_star_flag = custom_system
					has_star_flag = floating_system
					has_star_flag = crystal_system
					has_star_flag = city_system
				}
			}
		}
		if = { 
			limit = { OR = { new_worlds_enabled = yes planetary_diversity_enabled = yes } }
			
			shared_planet_modifier_spawn_table = yes
		}
		if = { 
			limit = {
				NOT = { has_global_flag = cgm_resources_disabled }
				is_colonizable = no
				has_strategic_resource = no
			}
			random_list = {
				96 = { }
				4 = {
					 #save_event_target_as = orbital_resource_candidate
					cgm_pe_orbital_sr_spawn_table = yes
					modifier = { factor = 0.25 has_global_flag = cgm_very_low_strategic_resources }
					modifier = { factor = 0.5 has_global_flag = cgm_low_strategic_resources }
					modifier = { factor = 1.5 has_global_flag = cgm_high_strategic_resources }
					modifier = { factor = 2 has_global_flag = cgm_very_high_strategic_resources }
				}
			}
		}	
		else_if = {
			limit = {
				NOT = { has_global_flag = cgm_resources_disabled }
				is_colonizable = no
				OR = {
					has_resource = { type = sr_pitharan amount > 0 }
					has_resource = { type = sr_engos amount > 0 }
					has_resource = { type = sr_satramene amount > 0 }
				}
			}
			if = {
				limit = { has_deposit_for = shipclass_mining_station }
				random_tile = { limit = { is_orbital_tile = yes } set_deposit = d_vast_energy_deposit }				
			}
			else = {
				random_tile = { limit = { is_orbital_tile = yes } set_deposit = d_rich_physics_deposit }
			}
		}	
		if = {
			limit = { OR = { is_colonizable = yes habitable_planet = yes } }
			while = { limit = { planet_size > 25 } change_planet_size = -1 }
			switch = {
				trigger = planet_size
				5 = { set_variable = { which = planet_size_var value = 5 } }
				6 = { set_variable = { which = planet_size_var value = 6 } }
				7 = { set_variable = { which = planet_size_var value = 7 } }
				8 = { set_variable = { which = planet_size_var value = 8 } }
				9 = { set_variable = { which = planet_size_var value = 9 } }
				10 = { set_variable = { which = planet_size_var value = 10 } }
				11 = { set_variable = { which = planet_size_var value = 11 } }
				12 = { set_variable = { which = planet_size_var value = 12 } }
				13 = { set_variable = { which = planet_size_var value = 13 } }
				14 = { set_variable = { which = planet_size_var value = 14 } }
				15 = { set_variable = { which = planet_size_var value = 15 } }
				16 = { set_variable = { which = planet_size_var value = 16 } }
				17 = { set_variable = { which = planet_size_var value = 17 } }
				18 = { set_variable = { which = planet_size_var value = 18 } }
				19 = { set_variable = { which = planet_size_var value = 19 } }
				20 = { set_variable = { which = planet_size_var value = 20 } }
				21 = { set_variable = { which = planet_size_var value = 21 } }
				22 = { set_variable = { which = planet_size_var value = 22 } }
				23 = { set_variable = { which = planet_size_var value = 23 } }
				24 = { set_variable = { which = planet_size_var value = 24 } }
				25 = { set_variable = { which = planet_size_var value = 25 } }
			}
			if = {
				limit = { NOT = { has_global_flag = no_planet_resize } }
				set_variable = { which = planet_resize_factor value = planet_size_var }
				random_list = {
					20 = {
						multiply_variable = { which = planet_resize_factor value = 1.3 }
						modifier = { factor = 0 has_global_flag = cgm_very_small_planet_size }
						modifier = { factor = 0 has_global_flag = cgm_small_planet_size }
						modifier = { factor = 1 has_global_flag = cgm_large_planet_size }
						modifier = { factor = 2 has_global_flag = cgm_very_large_planet_size }
					}
					20 = {
						multiply_variable = { which = planet_resize_factor value = 1.15 }
						modifier = { factor = 0 has_global_flag = cgm_very_small_planet_size }
						modifier = { factor = 0 has_global_flag = cgm_small_planet_size }
						modifier = { factor = 2 has_global_flag = cgm_large_planet_size }
						modifier = { factor = 1 has_global_flag = cgm_very_large_planet_size }
					}
					20 = {
						multiply_variable = { which = planet_resize_factor value = 1 }
						modifier = { factor = 0 has_global_flag = cgm_very_small_planet_size }
						modifier = { factor = 1 has_global_flag = cgm_small_planet_size }
						modifier = { factor = 1 has_global_flag = cgm_large_planet_size }
						modifier = { factor = 0 has_global_flag = cgm_very_large_planet_size }
					}
					20 = {
						multiply_variable = { which = planet_resize_factor value = 0.85 }
						modifier = { factor = 1 has_global_flag = cgm_very_small_planet_size }
						modifier = { factor = 2 has_global_flag = cgm_small_planet_size }
						modifier = { factor = 0 has_global_flag = cgm_large_planet_size }
						modifier = { factor = 0 has_global_flag = cgm_very_large_planet_size }
					}
					20 = {
						multiply_variable = { which = planet_resize_factor value = 0.7 }
						modifier = { factor = 2 has_global_flag = cgm_very_small_planet_size }
						modifier = { factor = 1 has_global_flag = cgm_small_planet_size }
						modifier = { factor = 0 has_global_flag = cgm_large_planet_size }
						modifier = { factor = 0 has_global_flag = cgm_very_large_planet_size }
					}
				}
				while = {
					limit = {
						check_variable = { which = planet_resize_factor value > planet_size_var }
						planet_size < 25
					}
					change_planet_size = 1
					change_variable = { which = planet_size_var value = 1 }
				}
				while = {
					limit = {
						check_variable = { which = planet_resize_factor value < planet_size_var }
						planet_size > 5
					}
					change_planet_size = -1
					change_variable = { which = planet_size_var value = -1 }
				}
			}
			if = {
				limit = { NOT = { has_global_flag = cgm_resources_disabled } }
				set_variable = { which = sr_points value = 0 }
				every_tile = {
					limit = { has_any_tile_strategic_resource = yes }
					prev = { change_variable = { which = sr_points value = -1 } }
				}
				random_list = {
					40 = {
						change_variable = { which = sr_points value = 0 }
						modifier = { factor = 1.5 has_global_flag = cgm_very_low_strategic_resources }
						modifier = { factor = 1.25 has_global_flag = cgm_low_strategic_resources }
						modifier = { factor = 0.75 has_global_flag = cgm_high_strategic_resources }
						modifier = { factor = 0.5 has_global_flag = cgm_very_high_strategic_resources }
					}
					30 = {
						change_variable = { which = sr_points value = 1 }
						modifier = { factor = 0.5 has_global_flag = cgm_very_low_strategic_resources }
						modifier = { factor = 0.75 has_global_flag = cgm_low_strategic_resources }
						modifier = { factor = 1.25 has_global_flag = cgm_high_strategic_resources }
						modifier = { factor = 1.5 has_global_flag = cgm_very_high_strategic_resources }
					}
					15 = {
						change_variable = { which = sr_points value = 2 }
						modifier = { factor = 0.5 has_global_flag = cgm_very_low_strategic_resources }
						modifier = { factor = 0.75 has_global_flag = cgm_low_strategic_resources }
						modifier = { factor = 1.25 has_global_flag = cgm_high_strategic_resources }
						modifier = { factor = 1.5 has_global_flag = cgm_very_high_strategic_resources }
					}
					10 = {
						change_variable = { which = sr_points value = 3 }
						modifier = { factor = 0.5 has_global_flag = cgm_very_low_strategic_resources }
						modifier = { factor = 0.75 has_global_flag = cgm_low_strategic_resources }
						modifier = { factor = 1.25 has_global_flag = cgm_high_strategic_resources }
						modifier = { factor = 1.5 has_global_flag = cgm_very_high_strategic_resources }
					}
					4 = {
						change_variable = { which = sr_points value = 4 }
						modifier = { factor = 0.5 has_global_flag = cgm_very_low_strategic_resources }
						modifier = { factor = 0.75 has_global_flag = cgm_low_strategic_resources }
						modifier = { factor = 1.25 has_global_flag = cgm_high_strategic_resources }
						modifier = { factor = 1.5 has_global_flag = cgm_very_high_strategic_resources }
					}
					1 = {
						change_variable = { which = sr_points value = 5 }
						modifier = { factor = 0.5 has_global_flag = cgm_very_low_strategic_resources }
						modifier = { factor = 0.75 has_global_flag = cgm_low_strategic_resources }
						modifier = { factor = 1.25 has_global_flag = cgm_high_strategic_resources }
						modifier = { factor = 1.5 has_global_flag = cgm_very_high_strategic_resources }
					}
				}
				if = {
					limit = { check_variable = { which = sr_points value > 0 } }
					while = {
						count = sr_points
						if = {
							limit = { any_tile = { has_deposit = no has_building = no } }
							random_tile = {
								limit = { has_deposit = no has_building = no }
								cgm_pe_planetary_sr_spawn_table = yes
							}
						}	
						else_if = {
							limit = { any_tile = { has_building = no has_regular_vanilla_deposit = yes } }
							random_tile = { limit = { has_building = no } cgm_pe_planetary_sr_spawn_table = yes }
						}	
						else_if = {
							limit = { any_tile = { has_regular_vanilla_deposit = yes } }
							random_tile = { limit = { has_regular_vanilla_deposit = yes } cgm_pe_planetary_sr_spawn_table = yes }
						}						
					}
				}
			}
			if = {
				limit = { NOT = { has_global_flag = cgm_tile_blockers_disabled } }
				every_tile = { 
					limit = { has_blocker = yes has_regular_vanilla_blocker = yes }
					remove_blocker = yes
					cgm_pe_tile_blocker_spawn_table = yes
				}	
				if = { 
					limit = { 
						exists = owner
						owner = { 
							OR = { 
								is_country_type = fallen_empire
								is_country_type = awakened_fallen_empire
							}
						}
						is_planet_class = pc_gaia
					}
					random_list = {
						50 = { }
						50 = { 
							random_tile = {
								limit = { has_building = no has_pop = no }
								if = { 
									limit = { has_blocker = yes }
									remove_blocker = yes
								}
								set_blocker = tb_fe_submerged_city
							}
						}
					}
				}	
				set_variable = { which = tb_points value = planet_size_var }
				random_list = {
					20 = {
						multiply_variable = { which = tb_points value = 0.8 }
						modifier = { factor = 0 has_global_flag = cgm_very_low_tile_blockers }
						modifier = { factor = 0.25 has_global_flag = cgm_low_tile_blockers }
						modifier = { factor = 0.75 has_global_flag = cgm_default_tile_blockers }
						modifier = { factor = 1.5 has_global_flag = cgm_high_tile_blockers }
						modifier = { factor = 2.5 has_global_flag = cgm_very_high_tile_blockers }
					}
					20 = {
						multiply_variable = { which = tb_points value = 0.65 }
						modifier = { factor = 0 has_global_flag = cgm_very_low_tile_blockers }
						modifier = { factor = 0.5 has_global_flag = cgm_low_tile_blockers }
						modifier = { factor = 1 has_global_flag = cgm_default_tile_blockers }
						modifier = { factor = 2 has_global_flag = cgm_high_tile_blockers }
						modifier = { factor = 1.5 has_global_flag = cgm_very_high_tile_blockers }
					}
					20 = {
						multiply_variable = { which = tb_points value = 0.5 }
						modifier = { factor = 0 has_global_flag = cgm_very_low_tile_blockers }
						modifier = { factor = 1.5 has_global_flag = cgm_low_tile_blockers }
						modifier = { factor = 2 has_global_flag = cgm_default_tile_blockers }
						modifier = { factor = 1.5 has_global_flag = cgm_high_tile_blockers }
						modifier = { factor = 0 has_global_flag = cgm_very_high_tile_blockers }
					}
					20 = {
						multiply_variable = { which = tb_points value = 0.35 }
						modifier = { factor = 1.5 has_global_flag = cgm_very_low_tile_blockers }
						modifier = { factor = 2 has_global_flag = cgm_low_tile_blockers }
						modifier = { factor = 1 has_global_flag = cgm_default_tile_blockers }
						modifier = { factor = 0.5 has_global_flag = cgm_high_tile_blockers }
						modifier = { factor = 0 has_global_flag = cgm_very_high_tile_blockers }
					}
					20 = {
						multiply_variable = { which = tb_points value = 0.2 }
						modifier = { factor = 2.5 has_global_flag = cgm_very_low_tile_blockers }
						modifier = { factor = 1.5 has_global_flag = cgm_low_tile_blockers }
						modifier = { factor = 0.75 has_global_flag = cgm_default_tile_blockers }
						modifier = { factor = 0.25 has_global_flag = cgm_high_tile_blockers }
						modifier = { factor = 0 has_global_flag = cgm_very_high_tile_blockers }
					}
				}
				divide_variable = { which = tb_points value = 1000 }
				multiply_variable = { which = tb_points value = 1000 }
				every_tile = {
					limit = { has_blocker = yes }
					prev = { change_variable = { which = tb_points value = -1 } }
				}
				if = {
					limit = { check_variable = { which = tb_points value > 0 } }
					while = {
						count = tb_points
						random_tile = {
							limit = { has_building = no has_blocker = no has_pop = no }
							cgm_pe_tile_blocker_spawn_table = yes
						}
					}
				}	
				else_if = {
					limit = { check_variable = { which = tb_points value < 0 } }
					while = {
						limit = {
							check_variable = { which = tb_points value < 0 }
							any_tile = { has_regular_vanilla_blocker = yes }
						}
						random_tile = { limit = { has_regular_vanilla_blocker = yes } remove_blocker = yes }
						change_variable = { which = tb_points value = 1 }
					}
				}	
			}
			if = {
				limit = { NOT = { has_global_flag = cgm_no_deposit_num_change } }
				set_variable = { which = dep_points value = planet_size_var }
				random_list = {
					20 = {
						multiply_variable = { which = dep_points value = 0.8 }
						modifier = { factor = 0 has_global_flag = cgm_very_low_deposits }
						modifier = { factor = 0.25 has_global_flag = cgm_low_deposits }
						modifier = { factor = 0.75 has_global_flag = cgm_default_deposits }
						modifier = { factor = 1.5 has_global_flag = cgm_high_deposits }
						modifier = { factor = 2.5 has_global_flag = cgm_very_high_deposits }
					}
					20 = {
						multiply_variable = { which = dep_points value = 0.65 }
						modifier = { factor = 0 has_global_flag = cgm_very_low_deposits }
						modifier = { factor = 0.5 has_global_flag = cgm_low_deposits }
						modifier = { factor = 1 has_global_flag = cgm_default_deposits }
						modifier = { factor = 2 has_global_flag = cgm_high_deposits }
						modifier = { factor = 1.5 has_global_flag = cgm_very_high_deposits }
					}
					20 = {
						multiply_variable = { which = dep_points value = 0.5 }
						modifier = { factor = 0 has_global_flag = cgm_very_low_deposits }
						modifier = { factor = 1.5 has_global_flag = cgm_low_deposits }
						modifier = { factor = 2 has_global_flag = cgm_default_deposits }
						modifier = { factor = 1.5 has_global_flag = cgm_high_deposits }
						modifier = { factor = 0 has_global_flag = cgm_very_high_deposits }
					}
					20 = {
						multiply_variable = { which = dep_points value = 0.35 }
						modifier = { factor = 1.5 has_global_flag = cgm_very_low_deposits }
						modifier = { factor = 2 has_global_flag = cgm_low_deposits }
						modifier = { factor = 1 has_global_flag = cgm_default_deposits }
						modifier = { factor = 0.5 has_global_flag = cgm_high_deposits }
						modifier = { factor = 0 has_global_flag = cgm_very_high_deposits }
					}
					20 = {
						multiply_variable = { which = dep_points value = 0.2 }
						modifier = { factor = 2.5 has_global_flag = cgm_very_low_deposits }
						modifier = { factor = 1.5 has_global_flag = cgm_low_deposits }
						modifier = { factor = 0.75 has_global_flag = cgm_default_deposits }
						modifier = { factor = 0.25 has_global_flag = cgm_high_deposits }
						modifier = { factor = 0 has_global_flag = cgm_very_high_deposits }
					}
				}
				divide_variable = { which = dep_points value = 1000 }
				multiply_variable = { which = dep_points value = 1000 }
				every_tile = {
					limit = { is_orbital_tile = no has_deposit = yes }
					prev = { change_variable = { which = dep_points value = -1 } }
				}
				if = {
					limit = { check_variable = { which = dep_points value > 0 } }
					while = {
						count = dep_points
						random_tile = {
							limit = {
								is_orbital_tile = no
								has_building = no
								has_deposit = no
								has_pop = no
							}
							cgm_shared_regular_deposit_spawn_table = yes
						}
					}
				}	
				else_if = {
					limit = { check_variable = { which = dep_points value < 0 } }
					while = {
						limit = {
							check_variable = { which = dep_points value < 0 }
							any_tile = { has_regular_vanilla_deposit = yes }
						}
						random_tile = { limit = { has_regular_vanilla_deposit = yes } clear_deposits = yes }
						change_variable = { which = dep_points value = 1 }
					}
				}				
			}
			if = { 
				limit = { NOT = { has_global_flag = cgm_no_deposit_size_change } } 
				every_tile = { 
					limit = { has_regular_vanilla_deposit = yes }
					cgm_shared_regular_deposit_spawn_table = yes
				}
			}	
		}
	}
}

 #there are 5 planet classes for terraforming currently implemented. Others will be added for other mods
 #pc_barren_terraforming
 #pc_barren_cold_terraforming
 #pc_toxic_terraforming
 #pc_molten_terraforming
 #pc_frozen_terraforming
 #this effect is called on planet scope in the terraforming links file.
cgm_set_terraformer = {
	while = { limit = { planet_size > 25 } change_planet_size = -1 }
	random_tile = {
		limit = { has_deposit = no has_blocker = no num_adjacent_tiles < 3 }
		set_building = building_terraformer_inactive
	}
	set_planet_flag = terraformer_inactive
	switch = {
		trigger = planet_size
		5 = { set_variable = { which = planet_size_var value = 5 } }
		6 = { set_variable = { which = planet_size_var value = 6 } }
		7 = { set_variable = { which = planet_size_var value = 7 } }
		8 = { set_variable = { which = planet_size_var value = 8 } }
		9 = { set_variable = { which = planet_size_var value = 9 } }
		10 = { set_variable = { which = planet_size_var value = 10 } }
		11 = { set_variable = { which = planet_size_var value = 11 } }
		12 = { set_variable = { which = planet_size_var value = 12 } }
		13 = { set_variable = { which = planet_size_var value = 13 } }
		14 = { set_variable = { which = planet_size_var value = 14 } }
		15 = { set_variable = { which = planet_size_var value = 15 } }
		16 = { set_variable = { which = planet_size_var value = 16 } }
		17 = { set_variable = { which = planet_size_var value = 17 } }
		18 = { set_variable = { which = planet_size_var value = 18 } }
		19 = { set_variable = { which = planet_size_var value = 19 } }
		20 = { set_variable = { which = planet_size_var value = 20 } }
		21 = { set_variable = { which = planet_size_var value = 21 } }
		22 = { set_variable = { which = planet_size_var value = 22 } }
		23 = { set_variable = { which = planet_size_var value = 23 } }
		24 = { set_variable = { which = planet_size_var value = 24 } }
		25 = { set_variable = { which = planet_size_var value = 25 } }
	}
	set_variable = { which = sr_points value = 0 }
	random_list = {
		80 = {
			change_variable = { which = sr_points value = 0 }
			modifier = { factor = 1.5 has_global_flag = cgm_very_low_strategic_resources }
			modifier = { factor = 1.25 has_global_flag = cgm_low_strategic_resources }
			modifier = { factor = 0.75 has_global_flag = cgm_high_strategic_resources }
			modifier = { factor = 0.5 has_global_flag = cgm_very_high_strategic_resources }
		}
		15 = {
			change_variable = { which = sr_points value = 1 }
			modifier = { factor = 0.5 has_global_flag = cgm_very_low_strategic_resources }
			modifier = { factor = 0.75 has_global_flag = cgm_low_strategic_resources }
			modifier = { factor = 1.25 has_global_flag = cgm_high_strategic_resources }
			modifier = { factor = 1.5 has_global_flag = cgm_very_high_strategic_resources }
		}
		5 = {
			change_variable = { which = sr_points value = 2 }
			modifier = { factor = 0.5 has_global_flag = cgm_very_low_strategic_resources }
			modifier = { factor = 0.75 has_global_flag = cgm_low_strategic_resources }
			modifier = { factor = 1.25 has_global_flag = cgm_high_strategic_resources }
			modifier = { factor = 1.5 has_global_flag = cgm_very_high_strategic_resources }
		}
	}
	if = {
		limit = { check_variable = { which = sr_points value > 0 } }
		while = {
			count = sr_points
			if = {
				limit = { any_tile = { has_deposit = no has_building = no } }
				random_tile = {
					limit = { has_deposit = no has_building = no }
					cgm_pe_planetary_sr_spawn_table = yes
				}
			}				
		}
	}
	set_variable = { which = tb_points value = planet_size_var }
	random_list = {
		33.3 = {
			multiply_variable = { which = tb_points value = 0.65 }
		}
		33.3 = {
			multiply_variable = { which = tb_points value = 0.5 }			
		}
		33.3 = {
			multiply_variable = { which = tb_points value = 0.35 }
		}
	}
	divide_variable = { which = tb_points value = 1000 }
	multiply_variable = { which = tb_points value = 1000 }
	while = {
		count = tb_points
		random_tile = {
			limit = { has_building = no has_blocker = no has_pop = no }
			if = { 
				limit = { prev = { is_planet_class_pc_barren_terraforming = yes } }
				random_list = {
					50 = { set_blocker = tb_pc_barren_terraforming_dust_steppe }
					50 = { set_blocker = tb_pc_barren_terraforming_inactive_volcano }
				}
			}
			else_if = { 
				limit = { prev = { is_planet_class_pc_barren_cold_terraforming = yes } }
				random_list = {
					50 = { set_blocker = tb_pc_barren_terraforming_rugged_land }
					50 = { set_blocker = tb_pc_barren_terraforming_wind_mountains }
				}					
			}	
			else_if = { 
				limit = { prev = { is_planet_class_pc_molten_terraforming = yes } }
				random_list = {
					50 = { set_blocker = tb_pc_molten_terraforming_magma_river }
					50 = { set_blocker = tb_pc_molten_terraforming_pyroclastic_terrain }
				}					
			}				
			else_if = { 
				limit = { prev = { is_planet_class_pc_toxic_terraforming = yes } }
				random_list = {
					50 = { set_blocker = tb_pc_toxic_sulphoric_flora }
					50 = { set_blocker = tb_pc_toxic_terraforming_noxious_concentrations }
				}					
			}		
			else_if = { 
				limit = { prev = { is_planet_class_pc_frozen_terraforming = yes } }
				random_list = {
					50 = { set_blocker = tb_pc_frozen_terraforming_deep_valley }
					50 = { set_blocker = tb_pc_frozen_terraforming_frozen_desolation }
				}					
			}					
			else_if = { 
				limit = { prev = { is_planet_class_pc_hothouse_terraforming = yes } }
				random_list = {
					50 = { set_blocker = tb_pc_hot_greenhouse_terraforming_rugged_terrain }
					50 = { set_blocker = tb_pc_hot_greenhouse_terraforming_stormfield }
				}					
			}					
			else_if = { 
				limit = { prev = { is_planet_class_pc_greenhouse_cold_terraforming = yes } }
				random_list = {
					50 = { set_blocker = tb_pc_cold_greenhouse_terraforming_rugged_land }
					50 = { set_blocker = tb_pc_cold_greenhouse_terraforming_sufuric_vents }
				}					
			}									
			else_if = { 
				limit = { prev = { is_planet_class_pc_greenhouse_hot_terraforming = yes } }
				random_list = {
					50 = { set_blocker = tb_pc_hot_greenhouse_terraforming_rugged_terrain }
					50 = { set_blocker = tb_pc_hot_greenhouse_terraforming_stormfield }
				}					
			}									
		}
	}
	set_variable = { which = dep_points value = planet_size_var }
	random_list = {
		20 = {
			multiply_variable = { which = dep_points value = 0.8 }
			modifier = { factor = 0 has_global_flag = cgm_very_low_deposits }
			modifier = { factor = 0.25 has_global_flag = cgm_low_deposits }
			modifier = { factor = 0.75 has_global_flag = cgm_default_deposits }
			modifier = { factor = 1.5 has_global_flag = cgm_high_deposits }
			modifier = { factor = 2.5 has_global_flag = cgm_very_high_deposits }
		}
		20 = {
			multiply_variable = { which = dep_points value = 0.65 }
			modifier = { factor = 0 has_global_flag = cgm_very_low_deposits }
			modifier = { factor = 0.5 has_global_flag = cgm_low_deposits }
			modifier = { factor = 1 has_global_flag = cgm_default_deposits }
			modifier = { factor = 2 has_global_flag = cgm_high_deposits }
			modifier = { factor = 1.5 has_global_flag = cgm_very_high_deposits }
		}
		20 = {
			multiply_variable = { which = dep_points value = 0.5 }
			modifier = { factor = 0 has_global_flag = cgm_very_low_deposits }
			modifier = { factor = 1.5 has_global_flag = cgm_low_deposits }
			modifier = { factor = 2 has_global_flag = cgm_default_deposits }
			modifier = { factor = 1.5 has_global_flag = cgm_high_deposits }
			modifier = { factor = 0 has_global_flag = cgm_very_high_deposits }
		}
		20 = {
			multiply_variable = { which = dep_points value = 0.35 }
			modifier = { factor = 1.5 has_global_flag = cgm_very_low_deposits }
			modifier = { factor = 2 has_global_flag = cgm_low_deposits }
			modifier = { factor = 1 has_global_flag = cgm_default_deposits }
			modifier = { factor = 0.5 has_global_flag = cgm_high_deposits }
			modifier = { factor = 0 has_global_flag = cgm_very_high_deposits }
		}
		20 = {
			multiply_variable = { which = dep_points value = 0.2 }
			modifier = { factor = 2.5 has_global_flag = cgm_very_low_deposits }
			modifier = { factor = 1.5 has_global_flag = cgm_low_deposits }
			modifier = { factor = 0.75 has_global_flag = cgm_default_deposits }
			modifier = { factor = 0.25 has_global_flag = cgm_high_deposits }
			modifier = { factor = 0 has_global_flag = cgm_very_high_deposits }
		}
	}
	divide_variable = { which = dep_points value = 1000 }
	multiply_variable = { which = dep_points value = 1000 }
	every_tile = {
		limit = { has_deposit = yes }
		prev = { change_variable = { which = dep_points value = -1 } }
	}
	if = {
		limit = { check_variable = { which = dep_points value > 0 } }
		while = {
			count = dep_points
			random_tile = {
				limit = { has_building = no has_deposit = no has_pop = no }
				cgm_shared_regular_deposit_spawn_table = yes
			}
		}
	}	
	else_if = {
		limit = { check_variable = { which = dep_points value < 0 } }
		while = {
			limit = {
				check_variable = { which = dep_points value < 0 }
				any_tile = { has_regular_vanilla_deposit = yes }
			}
			random_tile = { limit = { has_regular_vanilla_deposit = yes } clear_deposits = yes }
			change_variable = { which = dep_points value = 1 }
		}
	}
	set_planet_flag = cgm_terraforming_planet
	set_variable = { which = cgm_terraforming_years value = 0 }
	set_variable = { which = tb_points_transport value = tb_points }
	multiply_variable = { which = tb_points_transport value = 3 }
	set_variable = { which = planet_size_var_transport value = planet_size_var }
	multiply_variable = { which = planet_size_var_transport value = 2 }
	set_variable = { which = planet_terraforming_points value = planet_size_var_transport }
	change_variable = { which = planet_terraforming_points value = tb_points_transport }
	planet_event = { id = cgm_pe_terraforming_events.1 days = 360 }
}
 #the effects below run on tile scope

roll_terraformer_catastrophe = {
	random_list = { 
		0 = { 
			planet_event = { id = cgm_pe_terraforming_events.3 }	
			modifier = { add = 2.5 check_variable = { which = years_terraformer_inactive value = 1 } }
			modifier = { add = 5 check_variable = { which = years_terraformer_inactive value = 2 } }
			modifier = { add = 7.5 check_variable = { which = years_terraformer_inactive value = 3 } }
			modifier = { add = 10 check_variable = { which = years_terraformer_inactive value = 4 } }
			modifier = { add = 12.5 check_variable = { which = years_terraformer_inactive value = 5 } }
			modifier = { add = 15 check_variable = { which = years_terraformer_inactive value = 6 } }
			modifier = { add = 17.5 check_variable = { which = years_terraformer_inactive value = 7 } }
			modifier = { add = 20 check_variable = { which = years_terraformer_inactive value = 8 } }
			modifier = { add = 22.5 check_variable = { which = years_terraformer_inactive value = 9 } }
			modifier = { add = 25 check_variable = { which = years_terraformer_inactive value = 10 } }
			modifier = { add = 27.5 check_variable = { which = years_terraformer_inactive value = 11 } }
			modifier = { add = 30 check_variable = { which = years_terraformer_inactive value = 12 } }
			modifier = { add = 32.5 check_variable = { which = years_terraformer_inactive value = 13 } }
			modifier = { add = 35 check_variable = { which = years_terraformer_inactive value = 14 } }
			modifier = { add = 37.5 check_variable = { which = years_terraformer_inactive value = 15 } }
			modifier = { add = 40 check_variable = { which = years_terraformer_inactive value = 16 } }
			modifier = { add = 42.5 check_variable = { which = years_terraformer_inactive value = 17 } }
			modifier = { add = 45 check_variable = { which = years_terraformer_inactive value = 18 } }
			modifier = { add = 47.5 check_variable = { which = years_terraformer_inactive value = 19 } }
			modifier = { add = 50 check_variable = { which = years_terraformer_inactive value = 20 } }
			modifier = { add = 52.5 check_variable = { which = years_terraformer_inactive value = 21 } }
			modifier = { add = 55 check_variable = { which = years_terraformer_inactive value = 22 } }
			modifier = { add = 57.5 check_variable = { which = years_terraformer_inactive value = 23 } }
			modifier = { add = 60 check_variable = { which = years_terraformer_inactive value = 24 } }
			modifier = { add = 62.5 check_variable = { which = years_terraformer_inactive value = 25 } }
			modifier = { add = 65 check_variable = { which = years_terraformer_inactive value = 26 } }
			modifier = { add = 67.5 check_variable = { which = years_terraformer_inactive value = 27 } }
			modifier = { add = 70 check_variable = { which = years_terraformer_inactive value = 28 } }
			modifier = { add = 72.5 check_variable = { which = years_terraformer_inactive value = 29 } }
			modifier = { add = 75 check_variable = { which = years_terraformer_inactive value = 30 } }
			modifier = { add = 77.5 check_variable = { which = years_terraformer_inactive value = 31 } }
			modifier = { add = 80 check_variable = { which = years_terraformer_inactive value = 32 } }
			modifier = { add = 82.5 check_variable = { which = years_terraformer_inactive value = 33 } }
			modifier = { add = 85 check_variable = { which = years_terraformer_inactive value = 34 } }
			modifier = { add = 87.5 check_variable = { which = years_terraformer_inactive value = 35 } }
			modifier = { add = 90 check_variable = { which = years_terraformer_inactive value = 36 } }
			modifier = { add = 92.5 check_variable = { which = years_terraformer_inactive value = 37 } }
			modifier = { add = 95 check_variable = { which = years_terraformer_inactive value = 38 } }
			modifier = { add = 97.5 check_variable = { which = years_terraformer_inactive value = 39 } }
			modifier = { add = 100 check_variable = { which = years_terraformer_inactive value = 40 } }
			modifier = { add = 100 check_variable = { which = years_terraformer_inactive value > 40 } }
		}	
		100 = { 
			break = yes 
			modifier = { add = -2.5 check_variable = { which = years_terraformer_inactive value = 1 } }
			modifier = { add = -5 check_variable = { which = years_terraformer_inactive value = 2 } }
			modifier = { add = -7.5 check_variable = { which = years_terraformer_inactive value = 3 } }
			modifier = { add = -10 check_variable = { which = years_terraformer_inactive value = 4 } }
			modifier = { add = -12.5 check_variable = { which = years_terraformer_inactive value = 5 } }
			modifier = { add = -15 check_variable = { which = years_terraformer_inactive value = 6 } }
			modifier = { add = -17.5 check_variable = { which = years_terraformer_inactive value = 7 } }
			modifier = { add = -20 check_variable = { which = years_terraformer_inactive value = 8 } }
			modifier = { add = -22.5 check_variable = { which = years_terraformer_inactive value = 9 } }
			modifier = { add = -25 check_variable = { which = years_terraformer_inactive value = 10 } }
			modifier = { add = -27.5 check_variable = { which = years_terraformer_inactive value = 11 } }
			modifier = { add = -30 check_variable = { which = years_terraformer_inactive value = 12 } }
			modifier = { add = -32.5 check_variable = { which = years_terraformer_inactive value = 13 } }
			modifier = { add = -35 check_variable = { which = years_terraformer_inactive value = 14 } }
			modifier = { add = -37.5 check_variable = { which = years_terraformer_inactive value = 15 } }
			modifier = { add = -40 check_variable = { which = years_terraformer_inactive value = 16 } }
			modifier = { add = -42.5 check_variable = { which = years_terraformer_inactive value = 17 } }
			modifier = { add = -45 check_variable = { which = years_terraformer_inactive value = 18 } }
			modifier = { add = -47.5 check_variable = { which = years_terraformer_inactive value = 19 } }
			modifier = { add = -50 check_variable = { which = years_terraformer_inactive value = 20 } }
			modifier = { add = -52.5 check_variable = { which = years_terraformer_inactive value = 21 } }
			modifier = { add = -55 check_variable = { which = years_terraformer_inactive value = 22 } }
			modifier = { add = -57.5 check_variable = { which = years_terraformer_inactive value = 23 } }
			modifier = { add = -60 check_variable = { which = years_terraformer_inactive value = 24 } }
			modifier = { add = -62.5 check_variable = { which = years_terraformer_inactive value = 25 } }
			modifier = { add = -65 check_variable = { which = years_terraformer_inactive value = 26 } }
			modifier = { add = -67.5 check_variable = { which = years_terraformer_inactive value = 27 } }
			modifier = { add = -70 check_variable = { which = years_terraformer_inactive value = 28 } }
			modifier = { add = -72.5 check_variable = { which = years_terraformer_inactive value = 29 } }
			modifier = { add = -75 check_variable = { which = years_terraformer_inactive value = 30 } }
			modifier = { add = -77.5 check_variable = { which = years_terraformer_inactive value = 31 } }
			modifier = { add = -80 check_variable = { which = years_terraformer_inactive value = 32 } }
			modifier = { add = -82.5 check_variable = { which = years_terraformer_inactive value = 33 } }
			modifier = { add = -85 check_variable = { which = years_terraformer_inactive value = 34 } }
			modifier = { add = -87.5 check_variable = { which = years_terraformer_inactive value = 35 } }
			modifier = { add = -90 check_variable = { which = years_terraformer_inactive value = 36 } }
			modifier = { add = -92.5 check_variable = { which = years_terraformer_inactive value = 37 } }
			modifier = { add = -95 check_variable = { which = years_terraformer_inactive value = 38 } }
			modifier = { add = -97.5 check_variable = { which = years_terraformer_inactive value = 39 } }
			modifier = { add = -100 check_variable = { which = years_terraformer_inactive value = 40 } }
			modifier = { add = -100 check_variable = { which = years_terraformer_inactive value > 40 } }
		}
	}
}	
generate_catastrophe = { 
	set_variable = { which = pops_killed value = 0 }
	set_variable = { which = buildings_destroyed value = 0 }
	set_variable = { which = catastrophe_blockers_spawned value = 0 }
	if = { 
		limit = { any_tile = { has_building = yes has_pop = yes } }
		random_tile = { 
			limit = { has_terraformer = no has_building = yes has_pop = yes }
			kill_pop = yes
			remove_building = yes
			if = { 
				limit = { prev = { has_planet_flag = cgm_geothermal_tap } }
				set_blocker = tb_catastrophe_mega_gayser
			}
			else_if = { 
				limit = { prev = { has_planet_flag = cgm_deep_core_mining } }
				random_list = { 
					50 = { set_blocker = tb_catastrophe_erupting_volcano_1 }
					50 = { set_blocker = tb_catastrophe_erupting_volcano_2 }
				}	
			}
			else_if = { 
				limit = { prev = { has_planet_flag = cgm_tectonic_engineering } }
				set_blocker = tb_catastrophe_tectonic_fracture
			}	
			else_if = { 
				limit = { prev = { has_planet_flag = cgm_terraforming_planet } }
				set_blocker = tb_catastrophe_tectonic_fracture ##rework this later
			}					
			prev = { change_variable = { which = pops_killed value = 1 } }
			prev = { change_variable = { which = buildings_destroyed value = 1 } }
			prev = { change_variable = { which = catastrophe_blockers_spawned value = 1 } }				
			every_neighboring_tile = { 
				if = { 
					limit = { has_terraformer = no has_pop = yes has_building = yes }
					random_list = { 
						33.3 = { 
							kill_pop = yes 
							set_ruined = yes 
							prevprev = { change_variable = { which = pops_killed value = 1 } }
							prevprev = { change_variable = { which = buildings_destroyed value = 1 } }
						} 	
						33.3 = { 
							kill_pop = yes 
							remove_building = yes 
							set_blocker = tb_lava_flows
							prevprev = { change_variable = { which = pops_killed value = 1 } }
							prevprev = { change_variable = { which = buildings_destroyed value = 1 } }
							prevprev = { change_variable = { which = catastrophe_blockers_spawned value = 1 } }
						} 
						33.3 = { } 
					}	
				}	
				else_if = { 
					limit = { has_pop = yes has_building = no }
					random_list = { 
						33.3 = { 
							kill_pop = yes
							prevprev = { change_variable = { which = pops_killed value = 1 } }
						} 	
						33.3 = { 
							kill_pop = yes 
							set_blocker = tb_lava_flows
							prevprev = { change_variable = { which = pops_killed value = 1 } }
							prevprev = { change_variable = { which = catastrophe_blockers_spawned value = 1 } }
						} 
						33.3 = { } 
					}					
				}	
				else_if = { 
					limit = { has_terraformer = no has_pop = no has_building = yes }
					random_list = { 
						33.3 = { 
							set_ruined = yes
							prevprev = { change_variable = { which = buildings_destroyed value = 1 } }
						} 	
						33.3 = { 
							set_ruined = yes 
							set_blocker = tb_lava_flows
							prevprev = { change_variable = { which = buildings_destroyed value = 1 } }
							prevprev = { change_variable = { which = catastrophe_blockers_spawned value = 1 } }									
						} 
						33.3 = { } 
					}													
				}
				else_if = { 
					limit = { has_pop = no has_building = no has_blocker = yes }
					random_list = { 
						50 = { } 	
						50 = {
							remove_blocker = yes 
							set_blocker = tb_lava_flows
							prevprev = { change_variable = { which = catastrophe_blockers_spawned value = 1 } }									
						} 
					}													
				}								
				else = { 
					random_list = { 
						50 = { } 	
						50 = { 
							set_blocker = tb_lava_flows
							prevprev = { change_variable = { which = catastrophe_blockers_spawned value = 1 } }								
						} 
					}	
				}	
			}	
		}
	}
	else = {		
		random_tile = { 
			limit = { has_building = no has_pop = yes }
			kill_pop = yes
			if = { 
				limit = { prev = { has_planet_flag = cgm_geothermal_tap } }
				set_blocker = tb_catastrophe_mega_gayser
			}
			else_if = { 
				limit = { prev = { has_planet_flag = cgm_deep_core_mining } }
				random_list = { 
					50 = { set_blocker = tb_catastrophe_erupting_volcano_1 }
					50 = { set_blocker = tb_catastrophe_erupting_volcano_2 }
				}	
			}
			else_if = { 
				limit = { prev = { has_planet_flag = cgm_tectonic_engineering } }
				set_blocker = tb_catastrophe_tectonic_fracture
			}	
			else_if = { 
				limit = { prev = { has_planet_flag = cgm_terraforming_planet } }
				set_blocker = tb_catastrophe_tectonic_fracture ##rework this later
			}					
			prev = { change_variable = { which = pops_killed value = 1 } }
			prev = { change_variable = { which = buildings_destroyed value = 1 } }
			prev = { change_variable = { which = catastrophe_blockers_spawned value = 1 } }				
			every_neighboring_tile = { 
				if = { 
					limit = { has_terraformer = no has_pop = yes has_building = yes }
					random_list = { 
						33.3 = { 
							kill_pop = yes 
							set_ruined = yes 
							prevprev = { change_variable = { which = pops_killed value = 1 } }
							prevprev = { change_variable = { which = buildings_destroyed value = 1 } }
						} 	
						33.3 = { 
							kill_pop = yes 
							remove_building = yes 
							set_blocker = tb_lava_flows
							prevprev = { change_variable = { which = pops_killed value = 1 } }
							prevprev = { change_variable = { which = buildings_destroyed value = 1 } }
							prevprev = { change_variable = { which = catastrophe_blockers_spawned value = 1 } }
						} 
						33.3 = { } 
					}	
				}	
				else_if = { 
					limit = { has_pop = yes has_building = no }
					random_list = { 
						33.3 = { 
							kill_pop = yes
							prevprev = { change_variable = { which = pops_killed value = 1 } }
						} 	
						33.3 = { 
							kill_pop = yes 
							set_blocker = tb_lava_flows
							prevprev = { change_variable = { which = pops_killed value = 1 } }
							prevprev = { change_variable = { which = catastrophe_blockers_spawned value = 1 } }
						} 
						33.3 = { } 
					}					
				}	
				else_if = { 
					limit = { has_terraformer = no has_pop = no has_building = yes }
					random_list = { 
						33.3 = { 
							set_ruined = yes
							prevprev = { change_variable = { which = buildings_destroyed value = 1 } }
						} 	
						33.3 = { 
							set_ruined = yes 
							set_blocker = tb_lava_flows
							prevprev = { change_variable = { which = buildings_destroyed value = 1 } }
							prevprev = { change_variable = { which = catastrophe_blockers_spawned value = 1 } }									
						} 
						33.3 = { } 
					}													
				}
				else_if = { 
					limit = { has_pop = no has_building = no has_blocker = yes }
					random_list = { 
						50 = { } 	
						50 = {
							remove_blocker = yes 
							set_blocker = tb_lava_flows
							prevprev = { change_variable = { which = catastrophe_blockers_spawned value = 1 } }									
						} 
					}													
				}								
				else = { 
					random_list = { 
						50 = { } 	
						50 = { 
							set_blocker = tb_lava_flows
							prevprev = { change_variable = { which = catastrophe_blockers_spawned value = 1 } }								
						} 
					}	
				}	
			}	
		}
	}	
}

generate_asteroidal_planetoid = {
	remove_planet_flag = asteroidal_colonizable_candidate
	random_list = { 
		95 = { 
			if = { 
				limit = { 
					is_asteroid = yes
					NOT = { is_planet_class = pc_ice_asteroid }
				}		
				change_pc = pc_asteroidal_planetoid	
				if = { 
					limit = { planet_size = 6 } 
					set_variable = { which = planet_size_var value = 6 } 
				}
				else = { set_variable = { which = planet_size_var value = 5 } }
				set_variable = { which = tb_pc_asteroidal_mineral_ultra_rich_rock value = 0 } 
				set_variable = { which = tb_pc_asteroidal_mineral_rich_rock value = 0 } 
				set_variable = { which = tb_pc_asteroidal_mineral_energy_ultra_rich_rock value = 0 } 
				set_variable = { which = tb_pc_asteroidal_mineral_energy_rich_rock value = 0 } 
				set_variable = { which = tb_pc_asteroidal_mineral_regular_rock value = 0 } 
				every_tile = { 
					random_list = { 
						10 = { 
							set_blocker = tb_pc_asteroidal_mineral_ultra_rich_rock change_variable = { which = tb_pc_asteroidal_mineral_ultra_rich_rock value = 1 } 
							modifier = { 
								factor = 0
								NOT = { any_tile = { has_blocker = tb_pc_asteroidal_regular_rock } }
							}
						}
						10 = { 
							set_blocker = tb_pc_asteroidal_energy_ultra_rich_rock change_variable = { which = tb_pc_asteroidal_energy_ultra_rich_rock value = 1 }
							modifier = { 
								factor = 0
								NOT = { any_tile = { has_blocker = tb_pc_asteroidal_regular_rock } }
							}					
						}
						20 = { 
							set_blocker = tb_pc_asteroidal_mineral_rich_rock change_variable = { which = tb_pc_asteroidal_mineral_rich_rock value = 1 }
							modifier = { 
								factor = 0
								NOT = { any_tile = { has_blocker = tb_pc_asteroidal_regular_rock } }
							}					
						}
						20 = { 
							set_blocker = tb_pc_asteroidal_energy_rich_rock change_variable = { which = tb_pc_asteroidal_energy_rich_rock value = 1 }
							modifier = { 
								factor = 0
								NOT = { any_tile = { has_blocker = tb_pc_asteroidal_regular_rock } }
							}	
						}
						40 = { 
							set_blocker = tb_pc_asteroidal_regular_rock change_variable = { which = tb_pc_asteroidal_regular_rock value = 1 }
							modifier = { 
								add = 20
								prev = { 
									OR = { 
										check_variable = { which = tb_pc_asteroidal_mineral_ultra_rich_rock value > 0 } 
										check_variable = { which = tb_pc_asteroidal_mineral_rich_rock value > 0 } 
										check_variable = { which = tb_pc_asteroidal_mineral_energy_ultra_rich_rock value = 1 } 
										check_variable = { which = tb_pc_asteroidal_mineral_energy_rich_rock value = 1 } 
										check_variable = { which = tb_pc_asteroidal_mineral_regular_rock value < 2 } 						
									}
								}	
							}	
							modifier = { 
								add = 40
								prev = { 
									OR = { 
										check_variable = { which = tb_pc_asteroidal_mineral_ultra_rich_rock value > 1 } 
										check_variable = { which = tb_pc_asteroidal_mineral_rich_rock value > 1 } 
										check_variable = { which = tb_pc_asteroidal_mineral_energy_ultra_rich_rock value > 1 } 
										check_variable = { which = tb_pc_asteroidal_mineral_energy_rich_rock value > 1 } 
									}	
								}	
							}
						}					
					}
				}
				random_tile = { 
					limit = { has_blocker = tb_pc_asteroidal_mineral_regular_rock }
					remove_blocker = yes
				}
			}
			else_if = { 
				limit = { is_planet_class = pc_ice_asteroid }
				change_pc = pc_ice_asteroidal_planetoid	
				if = { 
					limit = { planet_size = 6 } 
					set_variable = { which = planet_size_var value = 6 } 
				}
				else = { set_variable = { which = planet_size_var value = 5 } }
				set_variable = { which = tb_pc_asteroidal_primordial_ice value = 0 } 
				every_tile = { 
					set_blocker = tb_pc_asteroidal_primordial_ice
				}
				random_tile = { remove_blocker = yes }
			}		
		}	
		5 = { 
			change_pc = pc_crystal_asteroidal_planetoid	
			if = { 
				limit = { planet_size = 6 } 
				set_variable = { which = planet_size_var value = 6 } 
			}
			else = { set_variable = { which = planet_size_var value = 5 } }
			set_variable = { which = tb_pc_asteroidal_anomaleous_crystal_formation_1 value = 0 } 
			set_variable = { which = tb_pc_asteroidal_anomaleous_crystal_formation_2 value = 0 } 
			set_variable = { which = tb_pc_asteroidal_regular_crystal_formation value = 0 } 
			every_tile = { 
				random_list = { 
					20 = { set_blocker = tb_pc_asteroidal_anomaleous_crystal_formation_1 change_variable = { which = tb_pc_asteroidal_anomaleous_crystal_formation_1 value = 1 } }
					20 = { set_blocker = tb_pc_asteroidal_anomaleous_crystal_formation_2 change_variable = { which = tb_pc_asteroidal_anomaleous_crystal_formation_2 value = 1 } }
					60 = { set_blocker = tb_pc_asteroidal_regular_crystal_formation change_variable = { which = tb_pc_asteroidal_regular_crystal_formation value = 1 } }					
				}
			}
			random_tile = { 
				limit = { has_blocker = tb_pc_asteroidal_regular_crystal_formation }
				remove_blocker = yes
			}		
		}			
	}	
}	

prescripted_asteroid_size_readjustment = {
	if = {
		limit = { is_planet_class = pc_dwarf_planet_asteroid }
		random_list = {
			33.3 = { set_planet_size = 8 }
			33.3 = { set_planet_size = 7 }
			33.3 = { set_planet_size = 6 }
		}	
	}
	else_if = {
		limit = { is_planet_class = pc_large_asteroid_moon }
		random_list = {
			30 = { set_planet_size = 6 }
			70 = { set_planet_size = 5 }
		}	
		set_planet_flag = asteroidal_colonizable_candidate
	}
	else_if = {
		limit = { is_planet_class = pc_small_asteroid_moon }
		random_list = {
			50 = { set_planet_size = 4 }
			50 = { set_planet_size = 3 }
		}	
	}
	else_if = {
		limit = { is_planet_class = pc_asteroid }
		random_list = {
			5 = { set_planet_size = 6 set_planet_flag = asteroidal_colonizable_candidate }
			10 = { set_planet_size = 5 set_planet_flag = asteroidal_colonizable_candidate }
			20 = { set_planet_size = 4 }
			35 = { set_planet_size = 3 }
			30 = { set_planet_size = 2 }
		}	
	}
	else_if = {
		limit = { is_planet_class = pc_ice_asteroid }
		random_list = {
			5 = { set_planet_size = 6 set_planet_flag = asteroidal_colonizable_candidate }
			10 = { set_planet_size = 5 set_planet_flag = asteroidal_colonizable_candidate }
			20 = { set_planet_size = 4 }
			35 = { set_planet_size = 3 }
			30 = { set_planet_size = 2 }
		}	
	}
	else_if = {
		limit = { is_planet_class = pc_crystal_asteroid }
		random_list = {
			30 = { set_planet_size = 6 }
			70 = { set_planet_size = 5 }
		}	
		set_planet_flag = asteroidal_colonizable_candidate
	}
	else_if = {
		limit = { is_planet_class = pc_crystal_asteroid_2 }
		random_list = {
			30 = { set_planet_size = 6 }
			70 = { set_planet_size = 5 }
		}	
		set_planet_flag = asteroidal_colonizable_candidate
	}
	else_if = { 
		limit = { is_colonizable = yes is_colony = no } 
		random_list = {
			5 = { 
				set_planet_size = 6 
				random_list = {
					70 = { change_pc = pc_asteroid }
					30 = { change_pc = pc_ice_asteroid }
				}	
				set_planet_flag = asteroidal_colonizable_candidate
			}
			10 = { 
				set_planet_size = 5 
				random_list = {
					70 = { change_pc = pc_asteroid }
					30 = { change_pc = pc_ice_asteroid }
				}					
				set_planet_flag = asteroidal_colonizable_candidate
			}
			85 = { }				
		}    		
	}	
}