namespace = cgm_planet_specialization	

planet_event = { 	
	id = cgm_planet_specialization.1
	is_triggered_only = yes	
	title = cgm_pe.planet_specialization_menu.title
	desc = cgm_pe.planet_specialization_menu.desc
	diplomatic = yes
	force_open = yes
	custom_gui = "planet_specialization_menu"	
	picture_event_data = { room = cgm_pe_menu_room }	
	
	option = { 
		name = cgm_pe.deep_core_mining.name
		custom_tooltip = cgm_pe.deep_core_mining.desc
		custom_gui = "cgm_pe_option"				
		trigger = { 			
			NOR = { 
				has_planet_flag = cgm_deep_core_mining				
				has_planet_flag = cgm_soil_enrichment
			}
		}
		allow = { 
			custom_tooltip = {
				fail_text = "requires_3_empty_tiles"
				count_tile = { 
					limit = { has_pop = no has_growing_pop = no has_building = no }
					count > 2
				}
			}	
			custom_tooltip = {
				fail_text = "requires_non_minerals_poor"
				NOT = { has_modifier = mineral_poor }				
			}			
			custom_tooltip = {
				fail_text = "requires_non_geothermal_tap"
				NOT = { has_planet_flag = cgm_geothermal_tap }
			}	
			custom_tooltip = {
				fail_text = "requires_non_tectonic_engineering"
				NOT = { has_planet_flag = cgm_tectonic_engineering }
			}						
			custom_tooltip = {
				fail_text = "requires_500_energy"
				owner = { energy > 499 }				
			}				
			custom_tooltip = {
				fail_text = "requires_50_influence"
				owner = { influence > 49 }				
			}			
		}		
		hidden_effect = { 
			set_planet_flag = cgm_deep_core_mining
			if = { 
				limit = { 
					NOR = { 
						has_modifier = cgm_deep_core_mining_stage_1
						has_modifier = cgm_deep_core_mining_stage_2
						has_modifier = cgm_deep_core_mining_stage_3
					}						
				}
				add_modifier = cgm_deep_core_mining_stage_0
			}				
			owner = { 
				add_energy = -500
				add_influence = -50
			}				
			planet_event = { id = cgm_planet_specialization.10 days = 1800 random = 1800 }
			if = { 
				limit = { NOT = { any_tile = { has_blocker = tb_planetary_specialization_deep_core_mining_engine } } }
				if = { 
					limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 4 } }
					random_tile = { 
						limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 4 }
						set_blocker = tb_planetary_specialization_deep_core_mining_engine
					}
				}	
				else_if = { 	
					limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 3 } }				
					random_tile = { 
						limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 3 }
						remove_blocker = yes
						set_blocker = tb_planetary_specialization_deep_core_mining_engine
					}						
				}	
				else_if = { 
					limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 2 } }
					random_tile = { 
						limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 2 }
						remove_blocker = yes
						set_blocker = tb_planetary_specialization_deep_core_mining_engine
					}						
				}
			}	
		}
	}	
	option = { 
		name = cgm_pe.geothermal_tap.name
		custom_tooltip = cgm_pe.geothermal_tap.desc
		custom_gui = "cgm_pe_option"				
		trigger = { 
			NOR = { 
				has_planet_flag = cgm_geothermal_tap
				has_planet_flag = cgm_soil_enrichment
			}
		}
		allow = { 
			custom_tooltip = {
				fail_text = "requires_3_empty_tiles"
				count_tile = { 
					limit = { has_pop = no has_growing_pop = no has_building = no }
					count > 2
				}
			}	
			custom_tooltip = {
				fail_text = "requires_non_weak_magnetic_field"
				NOT = { has_modifier = weak_magnetic_field }				
			}	
			custom_tooltip = {
				fail_text = "requires_non_tectonic_engineering"
				NOT = { has_planet_flag = cgm_tectonic_engineering }
			}						
			custom_tooltip = {
				fail_text = "requires_non_deep_core_mining"
				NOT = { has_planet_flag = cgm_deep_core_mining }
			}				
			custom_tooltip = {
				fail_text = "requires_500_energy"
				owner = { energy > 499 }				
			}				
			custom_tooltip = {
				fail_text = "requires_50_influence"
				owner = { influence > 49 }				
			}				
		}		
		hidden_effect = { 
			set_planet_flag = cgm_geothermal_tap
			if = { 
				limit = { 
					NOR = { 
						has_modifier = cgm_geothermal_tap_stage_1
						has_modifier = cgm_geothermal_tap_stage_2
						has_modifier = cgm_geothermal_tap_stage_3
					}						
				}
				add_modifier = cgm_geothermal_tap_stage_0
			}				
			owner = { 
				add_energy = -500
				add_influence = -50
			}				
			planet_event = { id = cgm_planet_specialization.20 days = 1800 random = 1800 }
			if = { 
				limit = { NOT = { any_tile = { has_blocker = tb_planetary_specialization_geothermal_tap_engine } } }
				if = { 
					limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 4 } }
					random_tile = { 
						limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 4 }
						set_blocker = tb_planetary_specialization_geothermal_tap_engine
					}
				}	
				else_if = { 	
					limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 3 } }				
					random_tile = { 
						limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 3 }
						remove_blocker = yes
						set_blocker = tb_planetary_specialization_geothermal_tap_engine
					}						
				}	
				else_if = { 
					limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 2 } }
					random_tile = { 
						limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 2 }
						remove_blocker = yes
						set_blocker = tb_planetary_specialization_geothermal_tap_engine
					}						
				}
			}	
		}
	}	
	option = { 
		name = cgm_pe.soil_enrichment.name
		custom_tooltip = cgm_pe.soil_enrichment.desc
		custom_gui = "cgm_pe_option"				
		trigger = { NOT = { has_planet_flag = cgm_soil_enrichment } }
		allow = { 
			custom_tooltip = {
				fail_text = "requires_3_empty_tiles"
				count_tile = { 
					limit = { has_pop = no has_growing_pop = no has_blocker = no has_building = no }
					count > 2
				}
			}	
			custom_tooltip = {
				fail_text = "requires_non_bleak_or_irradiated"
				NOT = { has_modifier = weak_magnetic_field }				
			}	
			custom_tooltip = {
				fail_text = "requires_non_deep_core_mining"
				NOT = { has_planet_flag = cgm_deep_core_mining }
			}				
			custom_tooltip = {
				fail_text = "requires_non_geothermal_tap"
				NOT = { has_planet_flag = cgm_geothermal_tap }
			}	
			custom_tooltip = {
				fail_text = "cannot_perform_soil_enrichemtn_when_tectonic_engineering_active"
				NOT = { has_planet_flag = cgm_tectonic_engineering }				
			}				
			custom_tooltip = {
				fail_text = "requires_500_minerals"
				owner = { energy > 499 }				
			}				
			custom_tooltip = {
				fail_text = "requires_500_energy"
				owner = { energy > 499 }				
			}							
			custom_tooltip = {
				fail_text = "requires_50_influence"
				owner = { influence > 49 }				
			}				
		}		
		hidden_effect = { 
			set_planet_flag = cgm_soil_enrichment
			add_modifier = cgm_soil_enrichment_stage_0
			owner = { 
				add_energy = -500
				add_minerals = -500
				add_influence = -50
			}					
			planet_event = { id = cgm_planet_specialization.30 days = 1800 random = 1800 }						
			if = { 
				limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 4 } }
				random_tile = { 
					limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 4 }
					set_blocker = tb_planetary_specialization_soil_enrichment_engine
				}
			}	
			else_if = { 	
				limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 3 } }				
				random_tile = { 
					limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 3 }
					set_blocker = tb_planetary_specialization_soil_enrichment_engine
				}					
			}	
			else_if = { 
				limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 2 } }
				random_tile = { 
					limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 2 }
					set_blocker = tb_planetary_specialization_soil_enrichment_engine
				}						
			}
		}
	}	
	option = { 
		name = cgm_pe.tectonic_engineering.name
		custom_tooltip = cgm_pe.tectonic_engineering.desc
		custom_gui = "cgm_pe_option"				
		trigger = { NOT = { has_planet_flag = cgm_tectonic_engineering } }
		allow = { 
			custom_tooltip = {
				fail_text = "requires_3_empty_tiles"
				count_tile = { 
					limit = { has_pop = no has_growing_pop = no has_blocker = no has_building = no }
					count > 2
				}
			}				
			custom_tooltip = {
				fail_text = "requires_non_unstable_tectonics"
				NOT = { has_modifier = unstable_tectonics }				
			}	
			custom_tooltip = {
				fail_text = "requires_non_deep_core_mining"
				NOT = { has_planet_flag = cgm_deep_core_mining }
			}				
			custom_tooltip = {
				fail_text = "requires_non_geothermal_tap"
				NOT = { has_planet_flag = cgm_geothermal_tap }
			}	
			custom_tooltip = {
				fail_text = "cannot_perform_tectonic_engineering_when_soil_enrichment_active"
				NOT = { has_planet_flag = cgm_soil_enrichment }				
			}							
			custom_tooltip = {
				fail_text = "requires_750_minerals"
				owner = { energy > 749 }				
			}				
			custom_tooltip = {
				fail_text = "requires_750_energy"
				owner = { energy > 749 }				
			}							
			custom_tooltip = {
				fail_text = "requires_50_influence"
				owner = { influence > 49 }				
			}				
			custom_tooltip = {
				fail_text = "requires_smaller_than_25_planet"
				planet_size < 25
			}				
		}		
		hidden_effect = { 
			set_planet_flag = cgm_tectonic_engineering
			add_modifier = cgm_tectonic_engineering		
			if = { 
				limit = { NOT = { check_variable = { which = cgm_tectonic_engineering value > 0 } } }
				set_variable = { which = cgm_tectonic_engineering value = 0 }
			}	
			owner = { 
				add_energy = -500
				add_minerals = -500
				add_influence = -50
			}										
			planet_event = { id = cgm_planet_specialization.40 days = 1800 random = 1800 }
		}
	}	
}	

planet_event = { 	
	id = cgm_planet_specialization.10
	is_triggered_only = yes
	hide_window = yes

	immediate = { 		
		if = { 
			limit = { has_modifier = cgm_deep_core_mining_stage_0 }
			random_list = { 
				99 = { 
					remove_modifier = cgm_deep_core_mining_stage_0
					add_modifier = cgm_deep_core_mining_stage_1
					planet_event = { id = cgm_planet_specialization.11 }
				}
				1 = { planet_event = { id = cgm_planet_specialization.12 } }
			}	
		}	
		else_if = { 
			limit = { has_modifier = cgm_deep_core_mining_stage_1 }
			random_list = {
				65 = { 
					remove_modifier = cgm_deep_core_mining_stage_1
					add_modifier = cgm_deep_core_mining_stage_2
					planet_event = { id = cgm_planet_specialization.11 }	
					modifier = { add = 10 owner = { has_ascension_perk = ap_world_shaper } }
				}
				35 = { 
					planet_event = { id = cgm_planet_specialization.12 }
					modifier = { factor = -0.5 owner = { has_technology = "tech_advanced_deep_core_mining" } }
				}	
			}	
		}
		else_if = { 
			limit = { has_modifier = cgm_deep_core_mining_stage_2 }
			random_list = { 
				45 = { 
					remove_modifier = cgm_deep_core_mining_stage_2
					add_modifier = cgm_deep_core_mining_stage_3
					planet_event = { id = cgm_planet_specialization.11 }	
					modifier = { add = 10 owner = { has_ascension_perk = ap_world_shaper } }
				}
				55 = { 
					planet_event = { id = cgm_planet_specialization.12 }
					modifier = { factor = -0.5 owner = { has_technology = "tech_advanced_deep_core_mining" } }
				}	
			}	
		}		
	}
}			

planet_event = { 	
	id = cgm_planet_specialization.11
	is_triggered_only = yes
	title = cgm_deep_core_mining_successful.title
	desc = cgm_deep_core_mining_successful.desc
	picture = GFX_evt_xyz
		
	option = { 
		name = further_increase_deep_core_mining_level.name
		custom_tooltip = further_increase_deep_core_mining_level.desc		
		allow = { 
			custom_tooltip = {
				fail_text = "deep_core_mining_at_maximal_level"
				NOT = { has_modifier = cgm_deep_core_mining_stage_3 }
			}
			if = { 
				limit = { has_modifier = cgm_deep_core_mining_stage_2 }
				custom_tooltip = {
					fail_text = "requires_advanced_deep_core_mining_tech"
					owner = { has_technology = "tech_advanced_deep_core_mining" }
				}	
			}	
		}		
		hidden_effect = { planet_event = { id = cgm_planet_specialization.40 days = 1800 random = 1800 } }
	}	
	option = { name = OK }		
}	

planet_event = { 	
	id = cgm_planet_specialization.12
	is_triggered_only = yes
	title = cgm_deep_core_mining_catastrophic_outcome.title
	desc = cgm_deep_core_mining_catastrophic_outcome.desc
	picture = GFX_evt_xyz
	
	immediate = { 
		random_tile = { 
			limit = { has_building = yes has_pop = yes }
			kill_pop = yes
			remove_building = yes
			random_list = { 
				50 = { set_blocker = tb_catastrophe_erupting_volcano_1 }
				50 = { set_blocker = tb_catastrophe_erupting_volcano_2 }
			}	
			every_neighboring_tile = { 
				if = { 
					limit = { has_pop = yes has_building = yes }
					random_list = { 
						33.3 = { kill_pop = yes set_ruined = yes } 	
						33.3 = { kill_pop = yes remove_building = yes set_blocker = tb_lava_flows } 
						33.3 = { } 
					}	
				}	
				else_if = { 
					limit = { has_pop = yes has_building = no }
					random_list = { 
						33.3 = { kill_pop = yes } 	
						33.3 = { kill_pop = yes set_blocker = tb_lava_flows } 
						33.3 = { } 
					}					
				}	
				else_if = { 
					limit = { has_pop = no has_building = yes }
					random_list = { 
						33.3 = { set_ruined = yes } 	
						33.3 = { set_ruined = yes set_blocker = tb_lava_flows } 
						33.3 = { } 
					}													
				}
				else_if = { 
					limit = { has_pop = no has_building = no has_blocker = yes }
					random_list = { 
						50 = { } 	
						50 = { remove_blocker = yes set_blocker = tb_lava_flows } 
					}													
				}								
				else = { 
					random_list = { 
						50 = { } 	
						50 = { set_blocker = tb_lava_flows } 
					}	
				}	
			}
		}
	}
	option = { 
		name = continue_deep_core_mining_level_increase_project.name
		custom_tooltip = continue_deep_core_mining_level_increase_project.desc		
		hidden_effect = { planet_event = { id = cgm_planet_specialization.10 days = 1800 random = 1800 } }
	}	
	option = { 
		name = cancel_deep_core_mining_level_increase_project.name
		custom_tooltip = cancel_deep_core_mining_level_increase_project.desc		
	}	
}

planet_event = { 	
	id = cgm_planet_specialization.20
	is_triggered_only = yes
	hide_window = yes

	immediate = { 		
		if = { 
			limit = { has_modifier = cgm_geothermal_tap_stage_0 }
			random_list = { 
				99 = { 
					remove_modifier = cgm_geothermal_tap_stage_0
					add_modifier = cgm_geothermal_tap_stage_1
					planet_event = { id = cgm_planet_specialization.21 }
				}
				1 = { planet_event = { id = cgm_planet_specialization.22 } }
			}	
		}	
		else_if = { 
			limit = { has_modifier = cgm_geothermal_tap_stage_1 }
			random_list = { 
				65 = { 
					remove_modifier = cgm_geothermal_tap_stage_1
					add_modifier = cgm_geothermal_tap_stage_2
					planet_event = { id = cgm_planet_specialization.21 }	
					modifier = { add = 10 owner = { has_ascension_perk = ap_world_shaper } }
				}
				35 = { 
					planet_event = { id = cgm_planet_specialization.22 }
					modifier = { factor = -0.5 owner = { has_technology = "tech_advanced_geothermal_tap" } }
				}	
			}	
		}
		else_if = { 
			limit = { has_modifier = cgm_geothermal_tap_stage_2 }
			random_list = { 
				45 = { 
					remove_modifier = cgm_geothermal_tap_stage_2
					add_modifier = cgm_geothermal_tap_stage_3
					planet_event = { id = cgm_planet_specialization.21 }	
					modifier = { add = 10 owner = { has_ascension_perk = ap_world_shaper } }
				}
				55 = { 
					planet_event = { id = cgm_planet_specialization.22 }
					modifier = { factor = -0.5 owner = { has_technology = "tech_advanced_geothermal_tap" } }
				}	
			}	
		}		
	}
}			

planet_event = { 	
	id = cgm_planet_specialization.21
	is_triggered_only = yes
	title = cgm_geothermal_tap_successful.title
	desc = cgm_geothermal_tap_successful.desc
	picture = GFX_evt_xyz
		
	option = { 
		name = further_increase_geothermal_tap_level.name
		custom_tooltip = further_increase_geothermal_tap_level.desc		
		allow = { 
			custom_tooltip = {
				fail_text = "geothermal_tap_at_maximal_level"
				NOT = { has_modifier = cgm_geothermal_tap_stage_3 }
			}
			if = { 
				limit = { has_modifier = cgm_geothermal_tap_stage_2 }
				custom_tooltip = {
					fail_text = "requires_advanced_geothermal_tap_tech"
					owner = { has_technology = "tech_advanced_geothermal_tap" }
				}	
			}	
		}		
		hidden_effect = { planet_event = { id = cgm_planet_specialization.40 days = 1800 random = 1800 } }
	}	
	option = { name = OK }		
}	

planet_event = { 	
	id = cgm_planet_specialization.22
	is_triggered_only = yes
	title = cgm_geothermal_tap_catastrophic_outcome.title
	desc = cgm_geothermal_tap_catastrophic_outcome.desc
	picture = GFX_evt_xyz
	
	immediate = { 
		random_tile = { 
			limit = { has_building = yes has_pop = yes }
			kill_pop = yes
			remove_building = yes
			set_blocker = tb_catastrophe_mega_gayser 
			every_neighboring_tile = { 
				if = { 
					limit = { has_pop = yes has_building = yes }
					random_list = { 
						33.3 = { kill_pop = yes set_ruined = yes } 	
						33.3 = { kill_pop = yes remove_building = yes set_blocker = tb_lava_flows } 
						33.3 = { } 
					}	
				}	
				else_if = { 
					limit = { has_pop = yes has_building = no }
					random_list = { 
						33.3 = { kill_pop = yes } 	
						33.3 = { kill_pop = yes set_blocker = tb_lava_flows } 
						33.3 = { } 
					}					
				}	
				else_if = { 
					limit = { has_pop = no has_building = yes }
					random_list = { 
						33.3 = { set_ruined = yes } 	
						33.3 = { set_ruined = yes set_blocker = tb_lava_flows } 
						33.3 = { } 
					}													
				}
				else_if = { 
					limit = { has_pop = no has_building = no has_blocker = yes }
					random_list = { 
						50 = { } 	
						50 = { remove_blocker = yes set_blocker = tb_lava_flows } 
					}													
				}								
				else = { 
					random_list = { 
						50 = { } 	
						50 = { set_blocker = tb_lava_flows } 
					}	
				}	
			}
		}
	}
	option = { 
		name = continue_geothermal_tap_level_increase_project.name
		custom_tooltip = continue_geothermal_tap_level_increase_project.desc		
		hidden_effect = { planet_event = { id = cgm_planet_specialization.20 days = 1800 random = 1800 } }
	}	
	option = { 
		name = cancel_geothermal_tap_level_increase_project.name
		custom_tooltip = cancel_geothermal_tap_level_increase_project.desc		
	}	
}
	
planet_event = { 	
	id = cgm_planet_specialization.40
	is_triggered_only = yes
	hide_window = yes
	
	trigger = { has_modifier = cgm_tectonic_engineering	}	
	
	immediate = { 
		if = { 
			limit = { check_variable = { which = cgm_tectonic_engineering value = 0 } }		
			change_planet_size = 1
			change_variable = { which = planet_size_var value = 1 }
			change_variable = { which = cgm_tectonic_engineering value = 1 }
			planet_event = { id = cgm_planet_specialization.41 }
		}	
		else_if = { 
			limit = { check_variable = { which = cgm_tectonic_engineering value = 1 } }	
			random_list = { 
				80 = { 
					change_planet_size = 1
					change_variable = { which = planet_size_var value = 1 }
					change_variable = { which = cgm_tectonic_engineering value = 1 }
					planet_event = { id = cgm_planet_specialization.41 }
					modifier = { add = 20 owner = { has_ascension_perk = ap_world_shaper } }
				}					
				20 = {
					if = { 
						limit = { check_variable = { which = cgm_tectonic_engineering_catastrophe value = 0 } }
						set_variable = { which = cgm_tectonic_engineering_catastrophe value = 1 } 						
					}	
					else = { change_variable = { which = cgm_tectonic_engineering_catastrophe value = 1 } }
					planet_event = { id = cgm_planet_specialization.42 } 									
					modifier = { add = 10 check_variable = { which = cgm_tectonic_engineering_catastrophe value = 1 } }
					modifier = { add = 20 check_variable = { which = cgm_tectonic_engineering_catastrophe value = 2 } }
					modifier = { add = 30 check_variable = { which = cgm_tectonic_engineering_catastrophe value = 3 } }
					modifier = { add = 40 check_variable = { which = cgm_tectonic_engineering_catastrophe value = 4 } }
					modifier = { factor = 0.5 owner = { has_technology = "advanced_tectonic_engineering" } }
				}
			}	
		}	
		else_if = { 
			limit = { check_variable = { which = cgm_tectonic_engineering value = 2 } }	
			random_list = { 
				60 = { 
					change_planet_size = 1
					change_variable = { which = planet_size_var value = 1 }
					change_variable = { which = cgm_tectonic_engineering value = 1 }
					planet_event = { id = cgm_planet_specialization.41 }
					modifier = { add = 20 owner = { has_ascension_perk = ap_world_shaper } }
				}
				40 = {
					if = { 
						limit = { check_variable = { which = cgm_tectonic_engineering_catastrophe value = 0 } }
						set_variable = { which = cgm_tectonic_engineering_catastrophe value = 1 } 						
					}	
					else = { change_variable = { which = cgm_tectonic_engineering_catastrophe value = 1 } }
					planet_event = { id = cgm_planet_specialization.42 } 		
					modifier = { add = 10 check_variable = { which = cgm_tectonic_engineering_catastrophe value = 1 } }
					modifier = { add = 20 check_variable = { which = cgm_tectonic_engineering_catastrophe value = 2 } }
					modifier = { add = 30 check_variable = { which = cgm_tectonic_engineering_catastrophe value = 3 } }
					modifier = { add = 40 check_variable = { which = cgm_tectonic_engineering_catastrophe value = 4 } }									
					modifier = { factor = 0.5 owner = { has_technology = "advanced_tectonic_engineering" } }
				}
			}						
		}	
		else_if = { 
			limit = { check_variable = { which = cgm_tectonic_engineering value = 3 } }	
			random_list = { 
				40 = { 
					change_planet_size = 1
					change_variable = { which = planet_size_var value = 1 }
					change_variable = { which = cgm_tectonic_engineering value = 1 }
					planet_event = { id = cgm_planet_specialization.41 }
					modifier = { add = 20 owner = { has_ascension_perk = ap_world_shaper } }
				}
				60 = {
					if = { 
						limit = { check_variable = { which = cgm_tectonic_engineering_catastrophe value = 0 } }
						set_variable = { which = cgm_tectonic_engineering_catastrophe value = 1 } 						
					}	
					else = { change_variable = { which = cgm_tectonic_engineering_catastrophe value = 1 } }
					planet_event = { id = cgm_planet_specialization.42 } 	
					modifier = { add = 10 check_variable = { which = cgm_tectonic_engineering_catastrophe value = 1 } }
					modifier = { add = 20 check_variable = { which = cgm_tectonic_engineering_catastrophe value = 2 } }
					modifier = { add = 30 check_variable = { which = cgm_tectonic_engineering_catastrophe value = 3 } }
					modifier = { add = 40 check_variable = { which = cgm_tectonic_engineering_catastrophe value = 4 } }											
					modifier = { factor = 0.5 owner = { has_technology = "advanced_tectonic_engineering" } }
				}										
			}	
		}	
		else_if = { 
			limit = { check_variable = { which = cgm_tectonic_engineering value = 4 } }									
			random_list = { 
				20 = { 
					change_planet_size = 1
					change_variable = { which = planet_size_var value = 1 }
					change_variable = { which = cgm_tectonic_engineering value = 1 }
					planet_event = { id = cgm_planet_specialization.41 }
					modifier = { add = 20 owner = { has_ascension_perk = ap_world_shaper } }
				}
				80 = {
					if = { 
						limit = { check_variable = { which = cgm_tectonic_engineering_catastrophe value = 0 } }
						set_variable = { which = cgm_tectonic_engineering_catastrophe value = 1 } 						
					}	
					else = { change_variable = { which = cgm_tectonic_engineering_catastrophe value = 1 } }
					planet_event = { id = cgm_planet_specialization.42 } 	
					modifier = { add = 10 check_variable = { which = cgm_tectonic_engineering_catastrophe value = 1 } }
					modifier = { add = 20 check_variable = { which = cgm_tectonic_engineering_catastrophe value = 2 } }
					modifier = { add = 30 check_variable = { which = cgm_tectonic_engineering_catastrophe value = 3 } }
					modifier = { add = 40 check_variable = { which = cgm_tectonic_engineering_catastrophe value = 4 } }													
					modifier = { factor = 0.5 owner = { has_technology = "advanced_tectonic_engineering" } }
				}										
			}
		}
	}		
}		

planet_event = { 	
	id = cgm_planet_specialization.41
	is_triggered_only = yes
	title = cgm_tectonic_engineering_planet_size_increased.title
	desc = cgm_tectonic_engineering_planet_size_increased.desc
	picture = GFX_evt_xyz
		
	option = { 
		name = continue_tectonic_engineering_project.name
		custom_tooltip = continue_tectonic_engineering_project.desc
		allow = { 
			custom_tooltip = {
				fail_text = "requires_smaller_than_25_planet"
				planet_size < 25
			}		
			custom_tooltip = {
				fail_text = "tectonic_engineering_cannot_be_performed_more_than_5_times"
				check_variable = { which = cgm_tectonic_engineering value < 5 }
			}				
		}
		hidden_effect = { planet_event = { id = cgm_planet_specialization.40 days = 1800 random = 1800 } }
	}	
	option = { 
		name = end_tectonic_engineering_project.name
		custom_tooltip = end_tectonic_engineering_project.desc
		hidden_effect = { 
			remove_modifier = cgm_tectonic_engineering	
		}
	}		
}	
planet_event = { 	
	id = cgm_planet_specialization.42
	is_triggered_only = yes
	title = cgm_tectonic_engineering_catastrophic_outcome.title
	desc = cgm_tectonic_engineering_catastrophic_outcome.desc
	picture = GFX_evt_xyz
	
	immediate = { 
		random_tile = { 
			limit = { has_building = yes has_pop = yes }
			kill_pop = yes
			remove_building = yes
			set_blocker = tb_catastrophe_tectonic_fracture
			every_neighboring_tile = { 
				if = { 
					limit = { has_pop = yes has_building = yes }
					random_list = { 
						33.3 = { kill_pop = yes set_ruined = yes } 	
						33.3 = { kill_pop = yes remove_building = yes set_blocker = tb_lava_flows } 
						33.3 = { } 
					}	
				}	
				else_if = { 
					limit = { has_pop = yes has_building = no }
					random_list = { 
						33.3 = { kill_pop = yes } 	
						33.3 = { kill_pop = yes set_blocker = tb_lava_flows } 
						33.3 = { } 
					}					
				}	
				else_if = { 
					limit = { has_pop = no has_building = yes }
					random_list = { 
						33.3 = { set_ruined = yes } 	
						33.3 = { set_ruined = yes set_blocker = tb_lava_flows } 
						33.3 = { } 
					}													
				}
				else_if = { 
					limit = { has_pop = no has_building = no has_blocker = yes }
					random_list = { 
						50 = { } 	
						50 = { remove_blocker = yes set_blocker = tb_lava_flows } 
					}													
				}								
				else = { 
					random_list = { 
						50 = { } 	
						50 = { set_blocker = tb_lava_flows } 
					}	
				}	
			}
		}
	}
	option = { 
		name = continue_tectonic_engineering_project.name
		custom_tooltip = continue_tectonic_engineering_project.desc
		allow = { 
			custom_tooltip = {
				fail_text = "requires_smaller_than_25_planet"
				planet_size < 25
			}		
		}
		hidden_effect = { planet_event = { id = cgm_planet_specialization.40 days = 1800 random = 1800 } }
	}	
	option = { 
		name = end_tectonic_engineering_project.name
		custom_tooltip = end_tectonic_engineering_project.desc
		allow = { 
			custom_tooltip = {
				fail_text = "requires_smaller_than_25_planet"
				planet_size < 25
			}		
		}
		hidden_effect = { 
			remove_modifier = cgm_tectonic_engineering	
		}
	}		
}