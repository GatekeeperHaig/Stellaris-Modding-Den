namespace = core_game_mechanics_and_ai_base

country_event = { 
	id = core_game_mechanics_and_ai_base.0
	hide_window = yes	
	fire_only_once = yes
	trigger = { 
		NOT = { has_global_flag = core_game_mechanics_and_ai }
		is_ai = no
	}
	immediate = { 
		set_global_flag = core_game_mechanics_and_ai
		set_country_flag = cgm_game_host	
		if = {
			limit = { NOT = { has_global_flag = cgm_game_start } }
			every_system = {
				system_star = { 
					set_variable = { which = num_of_hyperlane_connections value = 0 }
					save_event_target_as = hyperlane_check_star
					set_planet_flag = system_variable_repository
				}
				every_neighbor_system = { 
					ignore_hyperlanes = no 
					event_target:hyperlane_check_star = { change_variable = { which = num_of_hyperlane_connections value = 1 } }
				}				
			}
		}
	}
}	

#the event below opens the main menu for CGM - each CGM mod gets a unique option

country_event = { 
	id = core_game_mechanics_and_ai_base.1	
	is_triggered_only = yes
	title = cgm.main_menu.title
	desc = cgm.main_menu.desc
	diplomatic = yes
	custom_gui = "cgm_main_menu"
	force_open = yes

	picture_event_data = { room = cgm_menu_room }	

	trigger = { 		
		is_ai = no
		OR = {
			is_multiplayer = no
			AND = { 
				is_multiplayer = yes				
				has_country_flag = cgm_game_host
			}	
		}				
	}	
	
	immediate = { 
		set_global_flag = direct_build_enabled		
		#if = { 
		#	limit = { NOT = { has_global_flag = cgm_buildings_menu_fired } }
		#	every_playable_country = {
		#		limit = { is_ai = no }
		#		set_country_flag = cgm_disable_autobuild
		#		set_variable = { which = cgm_building_construction_percent value = 20 } #not used initially, but just to have a default value.
		#		set_country_flag = cgm_player_focus_as_ai
		#	}
		#	set_global_flag = cgm_disable_vanilla_building_AI
		#	every_playable_country = {
		#		limit = { is_ai = yes }
		#		set_country_flag = cgm_disable_vanilla_building_AI
		#	}			
		#	set_global_flag = cgm_buildings_menu_fired
		#}
	}	
	option = {
		name = cgm_buildings_preset.enable_new_building_content.name
		custom_gui = "cgm_option"
		custom_tooltip = cgm_buildings_preset.enable_new_building_content.desc
		trigger = { NOT = { has_global_flag = new_building_content_active } }			
		hidden_effect = { 
			set_global_flag = new_building_content_active	
			set_global_flag = overhauled_building_stats_active			
			hidden_effect = { 
				every_country = {
					limit = { 
						OR = {
							is_country_type = default
							is_country_type = fallen_empire
							is_country_type = awakened_fallen_empire
						}
					}	
					country_event = { id = cgm_building_operations.1 }
				}
				country_event = { id = core_game_mechanics_and_ai_base.1 }
			}	
		}
	}	
	option = {
		name = cgm_buildings_preset.keep_vanilla_building_content.name
		custom_gui = "cgm_option"
		custom_tooltip = cgm_buildings_preset.keep_vanilla_building_content.desc
		trigger = { 
			NOR = { 
				has_global_flag = new_building_content_active
				has_global_flag = vanilla_building_content_active
			}
		}	
		hidden_effect = { 
			set_global_flag = vanilla_building_content_active			
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}	
	option = {
		name = cgm_buildings_option.enable_overhauled_vanilla_building_stats.name
		custom_gui = "cgm_option"
		custom_tooltip = cgm_buildings_option.enable_overhauled_vanilla_building_stats.desc
		trigger = { 
			has_global_flag = vanilla_building_content_active
			NOT = { has_global_flag = overhauled_building_stats_active }
		}	
		hidden_effect = { 
			set_global_flag = overhauled_building_stats_active
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}		
	option = {
		name = cgm_buildings_option.disable_overhauled_vanilla_building_stats.name
		custom_gui = "cgm_option"
		custom_tooltip = cgm_buildings_option.disable_overhauled_vanilla_building_stats.desc
		trigger = { 
			has_global_flag = vanilla_building_content_active
			has_global_flag = overhauled_building_stats_active
		}	
		hidden_effect = { 
			remove_global_flag = overhauled_building_stats_active
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}	
	option = {
		name = cgm_ai_preset.cgm_ai_routines.name
		custom_gui = "cgm_option"
		custom_tooltip = cgm_ai_preset.cgm_ai_routines.desc
		trigger = { 
			OR = { 
				has_global_flag = new_building_content_active
				has_global_flag = vanilla_building_content_active
			}
			OR = { 
				NOT = { has_global_flag = cgm_disable_vanilla_building_AI }
				has_global_flag = cgm_disable_autobuild
			}			
		}	
		hidden_effect = { 
			set_global_flag = cgm_disable_vanilla_building_AI
			remove_global_flag = cgm_disable_autobuild
			every_country = {
        limit = {
        	OR = {
	          is_country_type = default
	          is_country_type = awakened_fallen_empire
        	}
          is_ai = yes
        }
        set_country_flag = cgm_disable_vanilla_building_AI
				remove_country_flag = cgm_disable_autobuild
      }
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}		
	option = {
		name = cgm_ai_preset.mixed_ai_routines.name
		custom_gui = "cgm_option"
		custom_tooltip = cgm_ai_preset.mixed_ai_routines.desc
		trigger = { 
			OR = { 
				has_global_flag = new_building_content_active
				has_global_flag = vanilla_building_content_active
			}
			OR = { 
				has_global_flag = cgm_disable_vanilla_building_AI
				NOT = { has_global_flag = cgm_disable_autobuild }
			}		
		}	
		hidden_effect = { 
			remove_global_flag = cgm_disable_vanilla_building_AI
			remove_global_flag = cgm_disable_autobuild
			every_country = {
        limit = {
        	OR = {
	          is_country_type = default
	          is_country_type = awakened_fallen_empire
        	}
          is_ai = yes
        }
        remove_country_flag = cgm_disable_vanilla_building_AI
				remove_country_flag = cgm_disable_autobuild
      }
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}
	option = {
		name = cgm_ai_preset.vanilla_ai_routines.name
		custom_gui = "cgm_option"
		custom_tooltip = cgm_ai_preset.vanilla_ai_routines.desc
		trigger = { 
			OR = { 
				has_global_flag = new_building_content_active
				has_global_flag = vanilla_building_content_active
			}
			NAND = { 
				has_global_flag = cgm_disable_vanilla_building_AI
				has_global_flag = cgm_disable_autobuild
			}			
		}	
		hidden_effect = { 
			remove_global_flag = cgm_disable_vanilla_building_AI
			set_global_flag = cgm_disable_autobuild
			every_country = {
        limit = {
        	OR = {
	          is_country_type = default
	          is_country_type = awakened_fallen_empire
        	}
          is_ai = yes
        }
        remove_country_flag = cgm_disable_vanilla_building_AI
				set_country_flag = cgm_disable_autobuild
      }
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}		
	  # option = {
  #   name = cgm_disable_vanilla_building_AI.name
  #   custom_gui = "cgm_option"
  #   custom_tooltip = cgm_disable_vanilla_building_AI.desc
  #   trigger = { 
  #     NOR = { 
  #       has_global_flag = cgm_disable_vanilla_building_AI 
  #       has_global_flag = cgm_disable_autobuild #prevent disabling both of them. That would kill AI fully 
  #     }     
  #   } 
  #   hidden_effect = { 
  #     set_global_flag = cgm_disable_vanilla_building_AI
  #     every_country = {
  #       limit = {
  #         is_country_type = default
  #         is_country_type = awakened_fallen_empire
  #       }
  #       set_country_flag = cgm_disable_vanilla_building_AI
  #     }     
  #     country_event = { id = core_game_mechanics_and_ai_base.1 }
  #   }
  # }   
  # option = {
  #   name = cgm_ai_enable_vanilla.name
  #   custom_gui = "cgm_option"
  #   custom_tooltip = cgm_ai_enable_vanilla.desc
  #   trigger = { 
  #     has_global_flag = cgm_disable_vanilla_building_AI 
  #   } 
  #   hidden_effect = { 
  #     remove_global_flag = cgm_disable_vanilla_building_AI
  #     every_country = {
  #       limit = {
  #         is_country_type = default
  #         is_country_type = awakened_fallen_empire
  #       }
  #       remove_country_flag = cgm_disable_vanilla_building_AI
  #     }     
  #     country_event = { id = core_game_mechanics_and_ai_base.1 }
  #   }
  # }   
  # option = {
  #   name = cgm_disable_autobuild.name
  #   custom_gui = "cgm_option"
  #   custom_tooltip = cgm_disable_autobuild.desc
  #   trigger = { 
  #     NOR = { 
  #       has_global_flag = cgm_disable_vanilla_building_AI #prevent disabling both of them. That would kill AI fully 
  #       has_global_flag = cgm_disable_autobuild 
  #     }     
  #   } 
  #   hidden_effect = { 
  #     set_global_flag = cgm_disable_autobuild
  #     every_country = {
  #       limit = {
  #         is_country_type = default
  #         is_country_type = awakened_fallen_empire
  #       }
  #       set_country_flag = cgm_disable_autobuild
  #     }     
  #     country_event = { id = core_game_mechanics_and_ai_base.1 }
  #   }
  # }   
  # option = {
  #   name = cgm_ai_enable_autobuild.name
  #   custom_gui = "cgm_option"
  #   custom_tooltip = cgm_ai_enable_autobuild.desc
  #   trigger = { 
  #     has_global_flag = cgm_disable_autobuild 
  #   } 
  #   hidden_effect = { 
  #     remove_global_flag = cgm_disable_autobuild
  #     every_country = {
  #       limit = {
  #         is_country_type = default
  #         is_country_type = awakened_fallen_empire
  #       }
  #       remove_country_flag = cgm_disable_autobuild
  #     }     
  #     country_event = { id = core_game_mechanics_and_ai_base.1 }
  #   }
  # }   
	option = {
		name = cgm_buildings_option.advanced_building_configuration.name
		custom_gui = "cgm_option"
		custom_tooltip = cgm_buildings_option.advanced_building_configuration.desc
		trigger = { 
			OR = {
				has_global_flag = vanilla_building_content_active
				has_global_flag = new_building_content_active
			}	
			#OR = { 
			#	has_global_flag = cgm_ai_routines
			#	has_global_flag = vanilla_ai_routines
			#	has_global_flag = mixed_ai_routines
			#}				
		}	
		hidden_effect = { 			
			country_event = { id = core_game_mechanics_and_ai_base.10 } 
		}
	}					
	option = {
		name = cgm_main_menu.close.name
		custom_gui = "cgm_option"
		custom_tooltip = cgm_main_menu.close.desc
		trigger = { 
			OR = {
				has_global_flag = vanilla_building_content_active
				has_global_flag = new_building_content_active
			}	
			#OR = { 
			#	has_global_flag = cgm_full_ai_routines
			#	has_global_flag = cgm_vanilla_ai_routines
			#	has_global_flag = cgm_mixed_ai_routines
			#}				
		}			
	}		
}