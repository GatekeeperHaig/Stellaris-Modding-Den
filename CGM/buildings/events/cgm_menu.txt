namespace = core_game_mechanics_and_ai_base
country_event = {
	id = core_game_mechanics_and_ai_base.0
	hide_window = yes
	fire_only_once = yes
	trigger = {
		NOT = { has_global_flag = core_game_mechanics_and_ai }
	}
	immediate = {
		set_global_flag = core_game_mechanics_and_ai
		set_country_flag = cgm_game_host
		if = {
			limit = { NOT = { has_global_flag = cgm_game_start } }
			every_system = {
				system_star = {
					set_variable = { which = num_of_hyperlane_connections value = 0 }
					save_event_target_as = hyperlane_check_star
					set_planet_flag = system_variable_repository
				}
				every_neighbor_system = {
					ignore_hyperlanes = no
					event_target:hyperlane_check_star = {
						change_variable = { which = num_of_hyperlane_connections value = 1 }
					}
				}
			}
		}
		set_global_flag = new_building_content_active
		set_global_flag = overhauled_building_stats_active
		set_global_flag = direct_build_enabled
		set_global_flag = cgm_disable_vanilla_building_AI
		every_playable_country = {
			limit = { is_ai = yes }
			set_country_flag = cgm_disable_vanilla_building_AI
		}
	}
}
 #the event below opens the main menu for CGM - each CGM mod gets a unique option
country_event = {
	id = core_game_mechanics_and_ai_base.1
	is_triggered_only = yes
	title = cgm.main_menu.title
	desc = cgm.main_menu.desc
	diplomatic = yes
	custom_gui = "cgm_main_menu"
	force_open = yes
	picture_event_data = { room = cgm_menu_room }
	trigger = {	
		OR = { 
			AND = {
				is_multiplayer = no
				is_ai = no
			}
			has_country_flag = cgm_game_host 
		}
	}

	
	### level 1 menus
	option = {
		name = cgm_buildings.default_settings.name		
		custom_tooltip = cgm_buildings.default_settings.desc
		trigger = { 
			has_global_flag = cgm_first_time_main_menu 
		}
		custom_gui = "cgm_option"
		hidden_effect = {	
			every_country = {
				limit = {
					OR = {
						is_country_type = default
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
						is_country_type = ascended_empire
					}
				}
				if = { 
					limit = { is_ai = yes } 
					set_country_flag = cgm_disable_vanilla_building_AI
					remove_country_flag = cgm_disable_autobuild					
				}					
				country_event = { id = cgm_building_operations.1 }
			}
			remove_global_flag = cgm_first_time_main_menu			
		}
	}	
	option = {
		name = cgm_buildings.advanced_configuration.name		
		custom_tooltip = cgm_buildings.advanced_configuration.desc
		trigger = { 
			has_global_flag = cgm_first_time_main_menu 
		}
		custom_gui = "cgm_option"
		hidden_effect = {	
			country_event = { id = core_game_mechanics_and_ai_base.1 }
			remove_global_flag = cgm_first_time_main_menu
		}
	}	
	### level 2 menus
	option = {
		name = cgm_buildings.configure_building_content.name		
		custom_tooltip = cgm_buildings.configure_building_content.desc
		trigger = { 
			NOT = { has_global_flag = cgm_first_time_main_menu }
			cgm_buildings_menu_triggers = no
		}
		custom_gui = "cgm_option"
		hidden_effect = {	
			set_timed_country_flag = { flag = cgm_buildings_building_content_configuration }
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}	
	option = {
		name = cgm_buildings.configure_building_overhaul.name		
		custom_tooltip = cgm_buildings.configure_building_overhaul.desc
		trigger = { 
			NOT = { has_global_flag = cgm_first_time_main_menu }
			cgm_buildings_menu_triggers = no
		}
		custom_gui = "cgm_option"
		hidden_effect = {	
			set_timed_country_flag = { flag = cgm_buildings_building_overhaul_configuration }
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}		
	option = {
		name = cgm_buildings.configure_ai.name		
		custom_tooltip = cgm_buildings.configure_ai.desc
		trigger = { 
			NOT = { has_global_flag = cgm_first_time_main_menu }
			cgm_buildings_menu_triggers = no
		}
		custom_gui = "cgm_option"
		hidden_effect = {	
			set_timed_country_flag = { flag = cgm_buildings_ai_configuration }
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}		
	option = {
		name = cgm_buildings.configure_direct_build.name		
		custom_tooltip = cgm_buildings.configure_direct_build.desc
		trigger = { 
			NOT = { has_global_flag = cgm_first_time_main_menu }
			cgm_buildings_menu_triggers = no
		}
		custom_gui = "cgm_option"
		hidden_effect = {	
			set_timed_country_flag = { flag = cgm_buildings_direct_build_configuration }
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}		
	option = {
		name = cgm_buildings.configure_building_modifiers.name		
		custom_tooltip = cgm_buildings.configure_building_modifiers.desc
		trigger = { 
			NOT = { has_global_flag = cgm_first_time_main_menu }
			cgm_buildings_menu_triggers = no
		}
		custom_gui = "cgm_option"
		hidden_effect = {	
			hidden_effect = { country_event = { id = core_game_mechanics_and_ai_base.10 } }
		}
	}				
	### level 3 menus 
	# buildin content
	option = {
		name = cgm_buildings.new_building_content_enabled.name		
		custom_tooltip = cgm_buildings.new_building_content_enabled.desc
		custom_gui = "cgm_option"
		trigger = { 
			has_country_flag = cgm_buildings_building_content_configuration
			NOT = { has_global_flag = cgm_first_time_main_menu }
		}	
		hidden_effect = {
			remove_global_flag = vanilla_building_content_active	
			remove_country_flag = cgm_buildings_building_content_configuration
			set_global_flag = new_building_content_active
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}
	option = {
		name = cgm_buildings.new_building_content_disabled.name		
		custom_tooltip = cgm_buildings.new_building_content_disabled.desc
		custom_gui = "cgm_option"
		trigger = { 
			has_country_flag = cgm_buildings_building_content_configuration
			NOT = { has_global_flag = cgm_first_time_main_menu }
		}	
		hidden_effect = {
			remove_global_flag = new_building_content_active
			set_global_flag = vanilla_building_content_active
			remove_country_flag = cgm_buildings_building_content_configuration
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}	
	option = {
		name = cgm_buildings.enable_overhauled_vanilla_building_stats.name		
		custom_tooltip = cgm_buildings.enable_overhauled_vanilla_building_stats.desc
		custom_gui = "cgm_option"
		trigger = {
			has_country_flag = cgm_buildings_building_overhaul_configuration
			NOT = { has_global_flag = cgm_first_time_main_menu }			
		}
		hidden_effect = {
			set_global_flag = overhauled_building_stats_active
			remove_country_flag = cgm_buildings_building_overhaul_configuration
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}
	option = {
		name = cgm_buildings.disable_overhauled_vanilla_building_stats.name		
		custom_tooltip = cgm_buildings.disable_overhauled_vanilla_building_stats.desc
		custom_gui = "cgm_option"
		trigger = {
			has_country_flag = cgm_buildings_building_overhaul_configuration
			NOT = { has_global_flag = cgm_first_time_main_menu }
		}
		hidden_effect = {
			remove_global_flag = overhauled_building_stats_active
			remove_country_flag = cgm_buildings_building_overhaul_configuration
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}	
	#direct build configuration
	option = {
		name = cgm_enable_direct_build.name
		custom_tooltip = cgm_enable_direct_build.desc
		custom_gui = "cgm_option"
		trigger = { 
			NOT = { has_global_flag = cgm_first_time_main_menu }
			has_country_flag = cgm_buildings_direct_build_configuration 
		}
		hidden_effect = {
			set_global_flag = direct_build_enabled
			remove_country_flag = cgm_buildings_direct_build_configuration
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}
	option = {
		name = cgm_disable_direct_build.name
		custom_tooltip = cgm_disable_direct_build.desc
		custom_gui = "cgm_option"
		trigger = { 
			NOT = { has_global_flag = cgm_first_time_main_menu }
			has_country_flag = cgm_buildings_direct_build_configuration 
		}
		hidden_effect = {
			remove_global_flag = direct_build_enabled
			remove_country_flag = cgm_buildings_direct_build_configuration
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}		
	# ai configuration
	option = {
		name = cgm_ai_preset.cgm_ai_routines.name
		custom_gui = "cgm_option"
		custom_tooltip = cgm_ai_preset.cgm_ai_routines.desc
		trigger = {
			NOT = { has_global_flag = cgm_first_time_main_menu }
			has_country_flag = cgm_buildings_ai_configuration
		}
		hidden_effect = {
			remove_global_flag = cgm_disable_autobuild
			set_global_flag = cgm_disable_vanilla_building_AI
			set_global_flag = disable_gai_build
			remove_country_flag = cgm_buildings_ai_configuration
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}
	option = {
		name = cgm_ai_preset.mixed_ai_routines.name
		custom_gui = "cgm_option"
		custom_tooltip = cgm_ai_preset.mixed_ai_routines.desc
		trigger = {
			NOT = { has_global_flag = cgm_first_time_main_menu }
			has_country_flag = cgm_buildings_ai_configuration
		}
		hidden_effect = {
			remove_global_flag = cgm_disable_autobuild
			remove_global_flag = cgm_disable_vanilla_building_AI
			set_global_flag = disable_gai_build
			remove_country_flag = cgm_buildings_ai_configuration
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}
	option = {
		name = cgm_ai_preset.vanilla_ai_routines.name
		custom_gui = "cgm_option"
		custom_tooltip = cgm_ai_preset.vanilla_ai_routines.desc
		trigger = {
			NOT = { has_global_flag = cgm_first_time_main_menu }
			has_country_flag = cgm_buildings_ai_configuration
		}
		hidden_effect = {
			remove_global_flag = cgm_disable_vanilla_building_AI
			set_global_flag = cgm_disable_autobuild
			remove_global_flag = disable_gai_build
			remove_country_flag = cgm_buildings_ai_configuration
			country_event = { id = core_game_mechanics_and_ai_base.1 }
		}
	}
	option = {
		name = cgm_buildings_main_menu_finish
		custom_gui = "cgm_option"
		trigger = {
			NOT = { has_global_flag = cgm_first_time_main_menu }
			cgm_buildings_menu_triggers = no
		}
		hidden_effect = { 
			every_country = {
				limit = {
					OR = {
						is_country_type = default
						is_country_type = ascended_empire
						is_country_type = awakened_fallen_empire
					}					
				}
				if = { 
					limit = { has_global_flag = new_building_content_active }
					country_event = { id = cgm_building_operations.1 days = 2 }
				}	
				if = { 
					limit = { is_ai = yes } 
					if = { 
						limit = { 
							has_global_flag = cgm_disable_vanilla_building_AI
							NOT = { 							
								has_global_flag = cgm_disable_autobuild
							}
						}						
						set_country_flag = cgm_disable_vanilla_building_AI
						remove_country_flag = cgm_disable_autobuild
					}	
					else_if = { 
						limit = { 
							NOT = { has_global_flag = cgm_disable_vanilla_building_AI }
							has_global_flag = cgm_disable_autobuild
						}						
						remove_country_flag = cgm_disable_vanilla_building_AI
						set_country_flag = cgm_disable_autobuild
					}					
					else_if = { 
						limit = { 
							NOR = { 
								has_global_flag = cgm_disable_vanilla_building_AI
								has_global_flag = cgm_disable_autobuild
							}
						}						
						remove_country_flag = cgm_disable_vanilla_building_AI
						remove_country_flag = cgm_disable_autobuild
					}	
				}	
			}	
		}	
	}
}
 #the event below is opened through a country edict by the game's host.
# country_event = {
# 	id = core_game_mechanics_and_ai_base.2
# 	is_triggered_only = yes
# 	title = cgm.edict_menu.title
# 	desc = cgm.edict_menu.desc
# 	diplomatic = yes
# 	custom_gui = "cgm_main_menu"
# 	force_open = yes
# 	picture_event_data = { room = cgm_menu_room }
# 	trigger = {	
# 		OR = { 
# 			AND = {
# 				is_multiplayer = no
# 				is_ai = no
# 			}
# 			has_country_flag = cgm_game_host 
# 		}
# 	}
# 	option = {
# 		name = cgm_buildings.configure_building_overhaul.name		
# 		custom_tooltip = cgm_buildings.configure_building_overhaul.desc
# 		trigger = { 			
# 			cgm_buildings_menu_triggers = no
# 		}
# 		custom_gui = "cgm_option"
# 		hidden_effect = {	
# 			set_timed_country_flag = { flag = cgm_buildings_building_overhaul_configuration days = 2 }
# 			country_event = { id = core_game_mechanics_and_ai_base.2 }
# 		}
# 	}		
# 	option = {
# 		name = cgm_buildings.configure_ai.name		
# 		custom_tooltip = cgm_buildings.configure_ai.desc
# 		trigger = { 			
# 			cgm_buildings_menu_triggers = no
# 		}
# 		custom_gui = "cgm_option"
# 		hidden_effect = {	
# 			set_timed_country_flag = { flag = cgm_buildings_ai_configuration days = 2 }
# 			country_event = { id = core_game_mechanics_and_ai_base.2 }
# 		}
# 	}		
# 	option = {
# 		name = cgm_buildings.configure_direct_build.name		
# 		custom_tooltip = cgm_buildings.configure_direct_build.desc
# 		trigger = { 			
# 			cgm_buildings_menu_triggers = no
# 		}
# 		custom_gui = "cgm_option"
# 		hidden_effect = {	
# 			set_timed_country_flag = { flag = cgm_buildings_direct_build_configuration days = 2 }
# 			country_event = { id = core_game_mechanics_and_ai_base.2 }
# 		}
# 	}		
# 	option = {
# 		name = cgm_buildings.configure_building_modifiers.name		
# 		custom_tooltip = cgm_buildings.configure_building_modifiers.desc
# 		trigger = { 			
# 			cgm_buildings_menu_triggers = no
# 		}
# 		custom_gui = "cgm_option"
# 		hidden_effect = {	
# 			hidden_effect = { country_event = { id = core_game_mechanics_and_ai_base.10 } }
# 		}
# 	}				
# 	### level 3 menus 
# 	# buildin content
# 	option = {
# 		name = cgm_buildings.enable_overhauled_vanilla_building_stats.name		
# 		custom_tooltip = cgm_buildings.enable_overhauled_vanilla_building_stats.desc
# 		custom_gui = "cgm_option"
# 		trigger = {
# 			has_country_flag = cgm_buildings_building_overhaul_configuration						
# 		}
# 		hidden_effect = {
# 			set_global_flag = overhauled_building_stats_active
# 			remove_country_flag = cgm_buildings_building_overhaul_configuration
# 			country_event = { id = core_game_mechanics_and_ai_base.2 }
# 		}
# 	}
# 	option = {
# 		name = cgm_buildings.disable_overhauled_vanilla_building_stats.name		
# 		custom_tooltip = cgm_buildings.disable_overhauled_vanilla_building_stats.desc
# 		custom_gui = "cgm_option"
# 		trigger = {
# 			has_country_flag = cgm_buildings_building_overhaul_configuration			
# 		}
# 		hidden_effect = {
# 			remove_global_flag = overhauled_building_stats_active
# 			remove_country_flag = cgm_buildings_building_overhaul_configuration
# 			country_event = { id = core_game_mechanics_and_ai_base.2 }
# 		}
# 	}	
# 	#direct build configuration
# 	option = {
# 		name = cgm_enable_direct_build.name
# 		custom_tooltip = cgm_enable_direct_build.desc
# 		custom_gui = "cgm_option"
# 		trigger = { 			
# 			has_country_flag = cgm_buildings_direct_build_configuration 
# 		}
# 		hidden_effect = {
# 			set_global_flag = direct_build_enabled
# 			remove_country_flag = cgm_buildings_direct_build_configuration
# 			country_event = { id = core_game_mechanics_and_ai_base.2 }
# 		}
# 	}
# 	option = {
# 		name = cgm_disable_direct_build.name
# 		custom_tooltip = cgm_disable_direct_build.desc
# 		custom_gui = "cgm_option"
# 		trigger = { 			
# 			has_country_flag = cgm_buildings_direct_build_configuration 
# 		}
# 		hidden_effect = {
# 			remove_global_flag = direct_build_enabled
# 			remove_country_flag = cgm_buildings_direct_build_configuration
# 			country_event = { id = core_game_mechanics_and_ai_base.2 }
# 		}
# 	}		
# 	# ai configuration
# 	option = {
# 		name = cgm_ai_preset.cgm_ai_routines.name
# 		custom_gui = "cgm_option"
# 		custom_tooltip = cgm_ai_preset.cgm_ai_routines.desc
# 		trigger = {			
# 			has_country_flag = cgm_buildings_ai_configuration
# 		}
# 		hidden_effect = {
# 			remove_global_flag = cgm_disable_autobuild
# 			set_global_flag = cgm_disable_vanilla_building_AI
# 			set_global_flag = disable_gai_build
# 			remove_country_flag = cgm_buildings_ai_configuration
# 			country_event = { id = core_game_mechanics_and_ai_base.2 }
# 		}
# 	}
# 	option = {
# 		name = cgm_ai_preset.mixed_ai_routines.name
# 		custom_gui = "cgm_option"
# 		custom_tooltip = cgm_ai_preset.mixed_ai_routines.desc
# 		trigger = {			
# 			has_country_flag = cgm_buildings_ai_configuration
# 		}
# 		hidden_effect = {
# 			remove_global_flag = cgm_disable_autobuild
# 			remove_global_flag = cgm_disable_vanilla_building_AI
# 			remove_country_flag = cgm_buildings_ai_configuration
# 			set_global_flag = disable_gai_build
# 			country_event = { id = core_game_mechanics_and_ai_base.2 }
# 		}
# 	}
# 	option = {
# 		name = cgm_ai_preset.vanilla_ai_routines.name
# 		custom_gui = "cgm_option"
# 		custom_tooltip = cgm_ai_preset.vanilla_ai_routines.desc
# 		trigger = {			
# 			has_country_flag = cgm_buildings_ai_configuration
# 		}
# 		hidden_effect = {
# 			remove_global_flag = cgm_disable_vanilla_building_AI
# 			set_global_flag = cgm_disable_autobuild
# 			remove_country_flag = cgm_buildings_ai_configuration
# 			remove_global_flag = disable_gai_build
# 			country_event = { id = core_game_mechanics_and_ai_base.2 }
# 		}
# 	}
# 	option = {
# 		name = OK		
# 		trigger = { cgm_buildings_menu_triggers = no }
# 		hidden_effect = { 
# 			every_country = {
# 				limit = {
# 					OR = {
# 						is_country_type = default
# 						is_country_type = ascended_empire
# 						is_country_type = awakened_fallen_empire
# 					}					
# 				}
# 				if = { 
# 					limit = { is_ai = yes } 
# 					if = { 
# 						limit = { 
# 							has_global_flag = cgm_disable_vanilla_building_AI
# 							NOT = { 							
# 								has_global_flag = cgm_disable_autobuild
# 							}
# 						}						
# 						set_country_flag = cgm_disable_vanilla_building_AI
# 						remove_country_flag = cgm_disable_autobuild
# 					}	
# 					else_if = { 
# 						limit = { 
# 							NOT = { has_global_flag = cgm_disable_vanilla_building_AI }
# 							has_global_flag = cgm_disable_autobuild
# 						}						
# 						remove_country_flag = cgm_disable_vanilla_building_AI
# 						set_country_flag = cgm_disable_autobuild
# 					}					
# 					else_if = { 
# 						limit = { 
# 							NOR = { 
# 								has_global_flag = cgm_disable_vanilla_building_AI
# 								has_global_flag = cgm_disable_autobuild
# 							}
# 						}						
# 						remove_country_flag = cgm_disable_vanilla_building_AI
# 						remove_country_flag = cgm_disable_autobuild
# 					}	
# 				}	
# 			}	
# 		}	
# 	}
# }