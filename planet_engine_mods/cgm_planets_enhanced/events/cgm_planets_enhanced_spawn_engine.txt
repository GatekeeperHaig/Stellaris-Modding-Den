namespace = cgm_planets_enhanced_spawn_engine

planet_event = { 
	id = cgm_planets_enhanced_spawn_engine.1
	hide_window = yes
	is_triggered_only = yes	
	
	immediate = {
		if = {
			limit = { 
				OR = { 
					is_colonizable = no
					uninhabitable_regular_planet = yes
				}	
			}
			random_list = {
				87.5 = { }
				12.5 = { cgm_pe_orbital_sr_spawn_table = yes } #uninhabitable planets only	
			}	
		}			 			
		else = { 
			if = {
				limit = { 
					OR = { 
						is_colonizable = yes
						habitable_planet = yes
					}
				}
				random_list = { 
					32.5 = { set_variable = { which = sr_points value = 0 } }
					32.5 = { set_variable = { which = sr_points value = 1 } }
					20 = { set_variable = { which = sr_points value = 2 } }
					12.5 = { set_variable = { which = sr_points value = 3 } }
					5 = { set_variable = { which = sr_points value = 4 } }
					2.5 = { set_variable = { which = sr_points value = 5 } }
				}					
				while = { 
					limit = { 
						is_special_planet = no
						OR = { 
							NOT = { has_global_flag = unique_sr1 }
							NOT = { has_global_flag = unique_sr2 }
							NOT = { has_global_flag = unique_sr3 }
							NOT = { has_global_flag = unique_sr4 }
							NOT = { has_global_flag = unique_sr5 }
							NOT = { has_global_flag = unique_sr6 }
							NOT = { has_global_flag = unique_sr7 }
							NOT = { has_global_flag = unique_sr8 }
							NOT = { has_global_flag = unique_sr9 }
							NOT = { has_global_flag = unique_sr10 }
						}	
						NOT = { 
							solar_system = { 
								any_planet = { has_planet_flag = unique_sr }
							}					
						}						
					}	
					cgm_pe_unique_sr_spawn_table = yes	
				}				
				while = {
					limit = { check_variable = { which = sr_points value > 0 } } 
					if = {
						limit = { any_tile = { has_deposit = no } }
						random_tile = { 
							limit = { has_deposit = no }
							cgm_pe_planetary_sr_spawn_table = yes						
						}
						else = { 
							random_tile = { 
								limit = { has_regular_vanilla_deposit = yes }
								cgm_pe_planetary_sr_spawn_table = yes
							}	
						}	
					}						
					change_variable = { which = sr_points value = -1 }
				}					
			}
		}	
	}	
}	
	
planet_event = { 
	id = ex_spawn_engine_10.5
	hide_window = yes
	is_triggered_only = yes	

	immediate = {
		every_planet = {
			limit = { 
				is_colonizable = yes
				is_colony = no
				solar_system = {
					NOR = {
						has_star_flag = sol_system
						has_star_flag = sol
						has_star_flag = deneb_system
						has_star_flag = custom_system
						has_star_flag = crystal_system
						has_star_flag = floating_system					
					}
				}	
			}
			if = {
				limit = { has_global_flag = reduce_habitable_planets_by_25_percent }
				random_list = {
					75 = { }
					#25 = { habitable_to_uninhabitable_conversion_table = yes }
				}
			}
			if = {
				limit = { has_global_flag = reduce_habitable_planets_by_50_percent }
				random_list = {
					50 = { }
					#50 = { habitable_to_uninhabitable_conversion_table = yes }
				}
			}			
			if = {
				limit = { has_global_flag = reduce_habitable_planets_by_75_percent }
				random_list = {
					25 = { }
					#75 = { habitable_to_uninhabitable_conversion_table = yes }
				}
			}						
		}
	}
}	
