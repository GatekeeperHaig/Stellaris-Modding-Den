namespace = ex_planets_enhanced_events

planet_event = { #this event fires upon terraforming completion, to see what it does look in scripted effects
	id = ex_planets_enhanced_events.1
	hide_window = yes	
	is_triggered_only = yes
	
	immediate = {
		remove_negative_planet_modifiers = yes
		add_positive_planet_modifier = yes
		if = { limit = { NOT = { has_planet_flag = ex_size_increased } } roll_size_increase = yes }		
	}
}

country_event = { #this event fires when a megastructure is built/upgraded, checking for ringworld
	id = ex_planets_enhanced_events.2
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {	root = { any_owned_planet = { is_planet_class = pc_ringworld_habitable NOT = { has_planet_flag = modifier_added } } } }
	
	immediate = { 
		root = {
			every_owned_planet = {
				limit = { is_planet_class = pc_ringworld_habitable NOT = { has_planet_flag = modifier_added } }
				add_modifier = { modifier = "ex_ring_world" days = -1 } 
			}	
		}
	}	
}	

event = { #this event fires only once, on a monthly pulse, adding/removing strategic resources and planet modifiers
	id = ex_planets_enhanced_events.3
	hide_window = yes
	is_triggered_only = yes
	#fire_only_once = yes
	
	trigger = { NOT = { has_global_flag = ex_resources_and_modifiers_rolled } }
	
	immediate = { 
		set_unique_deposit_1 = yes			
		set_unique_deposit_2 = yes
		set_unique_deposit_3 = yes
		set_unique_deposit_4 = yes
		set_unique_deposit_5 = yes
		set_unique_deposit_6 = yes
		every_planet = { #this removes the vanilla resources that were changed into planetary resources and replaces them with regular deposits to make sure research/mining stations in orbit keep operating }				
			limit = { has_strategic_resource = yes }
			if = { 
				limit = { 
					OR = {								
						has_deposit = d_engos_deposit
						has_deposit = d_pitharan_deposit
					}
				}	
				random_tile = { limit = { is_orbital_tile = yes } set_deposit = d_vast_society_deposit }
			}	
			if = { 
				limit = { 
					has_deposit = d_satramene_deposit
				}	
				random_tile = { limit = { is_orbital_tile = yes } set_deposit = d_vast_energy_deposit }
			}						
		}	
		every_planet = { #this rolls the new orbital strategic resources as well as the changed vanilla resources
			limit = {	
				solar_system = {
					NOR = {
						has_star_flag = empire_home_system
						has_star_flag = sol_system
						has_star_flag = deneb_system
					}				
				}			
				is_colonizable = no
				has_orbital_strategic_resource = no
				NOR = {
					has_deposit = "d_immense_mineral_deposit"
					has_deposit = "d_immense_energy_deposit"
					has_deposit = "d_immense_society_deposit"
					has_deposit = "d_immense_physics_deposit"
					has_deposit = "d_immense_engineering_deposit"							
					is_planet_class = pc_shielded
					is_planet_class = pc_infested
					is_planet_class = pc_shrouded
					is_planet_class = pc_ai
				}
			}	
			planet_event = { id = ex_planets_enhanced_events.4 } 			
		}	
		every_planet = { #this rolls the new planetary strategic resources as well as the changed vanilla resources
			limit = {	
				solar_system = {
					NOR = {
						has_star_flag = empire_home_system
						has_star_flag = sol_system
						has_star_flag = deneb_system
					}				
				}					
				is_colonizable = yes						
				NOR = {
					is_planet_class = pc_ringworld_habitable
					is_planet_class = pc_habitat			
				}
			}
			planet_event = { id = ex_planets_enhanced_events.5 } 	
		}	
		every_planet = { #this adds the special planet modifiers
			limit = {
				OR = {
					is_planet_class = pc_ringworld_habitable
					is_planet_class = pc_nuked
					is_planet_class = pc_gaia
				}	
				NOT = { has_planet_flag = modifier_added }
			}								
			if = {
				limit = { is_planet_class = pc_ringworld_habitable }			
				add_modifier = { modifier = "ex_ring_world" days = -1 } 													
			}	
			if = {
				limit = { is_planet_class = pc_gaia }			
				add_modifier = { modifier = "ex_gaia_world" days = -1 } 														
			}			
			if = {
				limit = { is_planet_class = pc_nuked }
				random_list = {
					30 = { add_modifier = { modifier = ex_tw } }		
					30 = { add_modifier = { modifier = ex_necropolis } }
					20 = { add_modifier = { modifier = ex_tw } add_modifier = { modifier = ex_necropolis } }
					20 = { } #this means no modifier will be applied
				}	
			}	
			set_planet_flag = modifier_added
		}					
		set_global_flag = ex_resources_and_modifiers_rolled		
	}		
}		


planet_event = { #this event sets orbital deposits
	id = ex_planets_enhanced_events.4
	hide_window = yes
	is_triggered_only = yes	

	immediate = { roll_orbital_sr_deposit = yes }
}	

planet_event = { #this event sets planetary deposits
	id = ex_planets_enhanced_events.5
	hide_window = yes
	is_triggered_only = yes	

	immediate = { 
		set_variable = { which = sr_count value = 0 }
		count_strategic_resources = yes
		set_planetary_deposits = yes 
	}	
}	