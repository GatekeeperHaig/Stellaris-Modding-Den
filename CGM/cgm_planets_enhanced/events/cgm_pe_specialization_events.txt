namespace = cgm_planet_specialization_menu	

@standard_deep_core_mining_energy_cost = 1000
@standard_deep_core_mining_influence_cost = 50

planet_event = { 	
	id = cgm_planet_specialization_menu.1
	is_triggered_only = yes	
	title = cgm_pe.planet_specialization_menu.title
	desc = cgm_pe.planet_specialization_menu.desc
	diplomatic = yes
	force_open = yes
	custom_gui = "planet_specialization_menu"	
	picture_event_data = { room = cgm_pe_menu_room }	
	
	option = { 
		name = cgm_pe.deep_core_mining.name
		custom_tooltip = cgm_pe.deep_core_mining.desc
		custom_gui = "cgm_pe_option"				
		trigger = { 
			is_artificial_planet = no
			NOR = { 
				has_planet_flag = cgm_deep_core_mining
				has_planet_flag = cgm_advanced_deep_core_mining
				has_planet_flag = cgm_geothermal_tap
				has_planet_flag = cgm_advanced_geothermal_tap
				has_planet_flag = cgm_tectonic_engineering
				has_planet_flag = cgm_advanced_tectonic_engineering
				has_planet_flag = cgm_soil_enrichment
				has_planet_flag = cgm_advanced_soil_enrichment
				has_planet_flag = cgm_ecological_preserve
				has_planet_flag = cgm_geophysics_test_site
			}
		}
		allow = { 
			custom_tooltip = {
				fail_text = "requires_3_empty_tiles"
				count_tile = { 
					limit = { has_pop = no has_growing_pop = no has_blocker = no has_building = no }
					count > 2
				}
			}	
			custom_tooltip = {
				fail_text = "requires_non_minerals_poor"
				NOT = { has_modifier = mineral_poor }				
			}			
			custom_tooltip = {
				fail_text = "requires_1000_energy"
				owner = { energy > 999 }				
			}				
			custom_tooltip = {
				fail_text = "requires_50_influence"
				owner = { influence > 49 }				
			}						
		}		
		hidden_effect = { 
			set_planet_flag = cgm_deep_core_mining
			add_modifier = cgm_deep_core_mining
			owner = { 
				energy = -1000
				influence = -50
			}	
			if = { 
				limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 4 } }
				random_tile = { 
					limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 4 }
					set_blocker = tb_planetary_specialization_deep_core_mining_engine
				}
				else = { 	
					if = { 
						limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 3 } }				
						random_tile = { 
							limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 3 }
							remove_blocker = yes
							set_blocker = tb_planetary_specialization_deep_core_mining_engine
						}						
						else = { 
							if = { 
								limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 2 } }
								random_tile = { 
									limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 2 }
									remove_blocker = yes
									set_blocker = tb_planetary_specialization_deep_core_mining_engine
								}						
							}
						}
					}
				}	
			}			
		}
	}	
	option = { 
		name = cgm_pe.geothermal_tap.name
		custom_tooltip = cgm_pe.geothermal_tap.desc
		custom_gui = "cgm_pe_option"				
		trigger = { 
			is_artificial_planet = no
			NOR = { 
				has_planet_flag = cgm_deep_core_mining
				has_planet_flag = cgm_advanced_deep_core_mining
				has_planet_flag = cgm_geothermal_tap
				has_planet_flag = cgm_advanced_geothermal_tap
				has_planet_flag = cgm_tectonic_engineering
				has_planet_flag = cgm_advanced_tectonic_engineering
				has_planet_flag = cgm_soil_enrichment
				has_planet_flag = cgm_advanced_soil_enrichment
				has_planet_flag = cgm_ecological_preserve
				has_planet_flag = cgm_geophysics_test_site
			}
		}
		allow = { 
			custom_tooltip = {
				fail_text = "requires_3_empty_tiles"
				count_tile = { 
					limit = { has_pop = no has_growing_pop = no has_blocker = no has_building = no }
					count > 2
				}
			}	
			custom_tooltip = {
				fail_text = "requires_non_weak_magnetic_field"
				NOT = { has_modifier = weak_magnetic_field }				
			}	
			custom_tooltip = {
				fail_text = "requires_1000_energy"
				owner = { energy > 999 }				
			}				
			custom_tooltip = {
				fail_text = "requires_50_influence"
				owner = { influence > 49 }				
			}				
		}		
		hidden_effect = { 
			set_planet_flag = cgm_geothermal_tap
			add_modifier = cgm_geothermal_tap
			owner = { 
				energy = -1000
				influence = -50
			}				
			if = { 
				limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 4 } }
				random_tile = { 
					limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 4 }
					set_blocker = tb_planetary_specialization_geothermal_fracking_engine
				}
				else = { 	
					if = { 
						limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 3 } }				
						random_tile = { 
							limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 3 }
							set_blocker = tb_planetary_specialization_geothermal_fracking_engine
						}						
						else = { 
							if = { 
								limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 2 } }
								random_tile = { 
									limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 2 }
									set_blocker = tb_planetary_specialization_geothermal_fracking_engine
								}						
							}
						}
					}
				}	
			}			
		}
	}	
	option = { 
		name = cgm_pe.soil_enrichment.name
		custom_tooltip = cgm_pe.soil_enrichment.desc
		custom_gui = "cgm_pe_option"				
		trigger = { 
			is_artificial_planet = no
			NOR = { 
				has_planet_flag = cgm_deep_core_mining
				has_planet_flag = cgm_advanced_deep_core_mining
				has_planet_flag = cgm_geothermal_tap
				has_planet_flag = cgm_advanced_geothermal_tap
				has_planet_flag = cgm_tectonic_engineering
				has_planet_flag = cgm_advanced_tectonic_engineering
				has_planet_flag = cgm_soil_enrichment
				has_planet_flag = cgm_advanced_soil_enrichment
				has_planet_flag = cgm_ecological_preserve
				has_planet_flag = cgm_geophysics_test_site
			}
		}
		allow = { 
			custom_tooltip = {
				fail_text = "requires_3_empty_tiles"
				count_tile = { 
					limit = { has_pop = no has_growing_pop = no has_blocker = no has_building = no }
					count > 2
				}
			}	
			custom_tooltip = {
				fail_text = "requires_non_bleak_or_irradiated"
				NOT = { has_modifier = weak_magnetic_field }				
			}	
			custom_tooltip = {
				fail_text = "requires_500_minerals"
				owner = { energy > 499 }				
			}				
			custom_tooltip = {
				fail_text = "requires_500_energy"
				owner = { energy > 499 }				
			}							
			custom_tooltip = {
				fail_text = "requires_50_influence"
				owner = { influence > 49 }				
			}				
		}		
		hidden_effect = { 
			set_planet_flag = cgm_soil_enrichment
			add_modifier = cgm_geothermal_tap
			owner = { 
				energy = -500
				minerals = -500
				influence = -50
			}				
			if = { 
				limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 4 } }
				random_tile = { 
					limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 4 }
					set_blocker = tb_planetary_specialization_soil_enrichment_engine
				}
				else = { 	
					if = { 
						limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 3 } }				
						random_tile = { 
							limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 3 }
							set_blocker = tb_planetary_specialization_soil_enrichment_engine
						}						
						else = { 
							if = { 
								limit = { any_tile = { has_building = no has_pop = no has_any_tile_strategic_resource = no num_adjacent_tiles = 2 } }
								random_tile = { 
									limit = { has_building = no has_pop = no has_any_tile_strategic_resource = no has_blocker = no num_adjacent_tiles = 2 }
									set_blocker = tb_planetary_specialization_soil_enrichment_engine
								}						
							}
						}
					}
				}	
			}			
		}
	}		
}	