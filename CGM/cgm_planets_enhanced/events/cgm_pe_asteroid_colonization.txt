namespace = cgm_asteroid_colonization

ship_event = {
	id = cgm_asteroid_colonization.1
	is_triggered_only = yes
	location = from
	title = cgm_asteroidal_planet_found.name
	desc = {
		trigger = {
			success_text = {			
				text = cgm_asteroidal_planet_found.desc
				from = { is_planet_class = pc_asteroidal_planetoid }
			}	
			success_text = {			
				text = cgm_ice_asteroidal_planet_found.desc
				from = { is_planet_class = pc_ice_asteroidal_planetoid }
			}		
			success_text = {			
				text = cgm_crystal_asteroidal_planet_found.desc
				from = { is_planet_class = pc_crystal_asteroidal_planetoid }			
			}				
		}	
	}		
	picture = "GFX_evt_mining_station"		
	immediate = { 
		from = { generate_asteroidal_planetoid = yes } 
	}		
	option = { name = OK } 
}	
planet_event = { 
	id = cgm_asteroid_colonization.2
	hide_window = yes
	is_triggered_only = yes
	
	immediate = { 
		if = { 
			limit = { is_planet_class = pc_asteroidal_planetoid }
			set_variable = { which = tb_pc_asteroidal_mineral_ultra_rich_rock_new value = 0 } 
			set_variable = { which = tb_pc_asteroidal_mineral_rich_rock_new value = 0 } 
			set_variable = { which = tb_pc_asteroidal_energy_ultra_rich_rock_new value = 0 } 
			set_variable = { which = tb_pc_asteroidal_energy_rich_rock_new value = 0 } 
			set_variable = { which = tb_pc_asteroidal_carbometallic_rock_new value = 0 } 		
			every_tile = { 
				if = { limit = { has_blocker = tb_pc_asteroidal_carbometallic_rock } prev = { change_variable = { which = tb_pc_asteroidal_carbometallic_rock_new value = 1 } } }
				else_if = { limit = { has_blocker = tb_pc_asteroidal_mineral_rich_rock } prev = { change_variable = { which = tb_pc_asteroidal_mineral_rich_rock_new value = 1 } } }
				else_if = { limit = { has_blocker = tb_pc_asteroidal_energy_rich_rock } prev = { change_variable = { which =	tb_pc_asteroidal_energy_rich_rock_new value = 1 } } }
				else_if = { limit = { has_blocker = tb_pc_asteroidal_mineral_ultra_rich_rock } prev = { change_variable = { which =  tb_pc_asteroidal_mineral_ultra_rich_rock_new value = 1 } } }
				else_if = { limit = { has_blocker = tb_pc_asteroidal_energy_ultra_rich_rock } prev = { change_variable = { which = tb_pc_asteroidal_energy_ultra_rich_rock_new  value = 1 } } }
			}
			if = { 
				limit = { NOT = { check_variable = { which = tb_pc_asteroidal_carbometallic_rock_new value = tb_pc_asteroidal_carbometallic_rock } } }
				set_variable = { which = tb_pc_asteroidal_carbometallic_rock value = tb_pc_asteroidal_carbometallic_rock_new }
				add_modifier = { modifier = pc_asteroidal_carbometallic_rock_mined days = 3600 }
			}									
			else_if = { 
				limit = { NOT = { check_variable = { which = tb_pc_asteroidal_mineral_rich_rock_new value = tb_pc_asteroidal_mineral_rich_rock } } }
				set_variable = { which = tb_pc_asteroidal_mineral_rich_rock value = tb_pc_asteroidal_mineral_rich_rock_new }
				add_modifier = { modifier = pc_asteroidal_mineral_rich_rock_mined days = 3600 }
			}						
			else_if = { 
				limit = { NOT = { check_variable = { which = tb_pc_asteroidal_energy_rich_rock_new value = tb_pc_asteroidal_energy_rich_rock } } }
				set_variable = { which = tb_pc_asteroidal_energy_rich_rock value = tb_pc_asteroidal_energy_rich_rock_new }
				add_modifier = { modifier = pc_asteroidal_energy_rich_rock_mined days = 3600 }
			}									
			else_if = { 
				limit = { NOT = { check_variable = { which = tb_pc_asteroidal_mineral_ultra_rich_rock_new value = tb_pc_asteroidal_mineral_ultra_rich_rock } } }
				set_variable = { which = tb_pc_asteroidal_mineral_ultra_rich_rock value = tb_pc_asteroidal_mineral_ultra_rich_rock_new }
				add_modifier = { modifier = pc_asteroidal_mineral_ultra_rich_rock_mined days = 3600 }
			}	
			else_if = { 
				limit = { NOT = { check_variable = { which = tb_pc_asteroidal_energy_ultra_rich_rock_new value = tb_pc_asteroidal_energy_ultra_rich_rock } } }
				set_variable = { which = tb_pc_asteroidal_energy_ultra_rich_rock value = tb_pc_asteroidal_energy_ultra_rich_rock_new }
				add_modifier = { modifier = pc_asteroidal_energy_ultra_rich_rock_mined days = 3600 }
			}			
		}
		else_if = { 
			limit = { is_planet_class = pc_ice_asteroidal_planetoid }		
			set_variable = { which = tb_pc_ice_asteroidal_primordial_ice_new value = 0 } 
			set_variable = { which = tb_pc_ice_asteroidal_frozen_exotic_matter_new value = 0 } 
			every_tile = {
				if = { 
					limit = { has_blocker = tb_pc_ice_asteroidal_primordial_ice } prev = { change_variable = { which = tb_pc_ice_asteroidal_primordial_ice_new value = 1 } } 					
				}
				else_if = { 
					limit = { has_blocker = tb_pc_ice_asteroidal_frozen_exotic_matter } prev = { change_variable = { which = tb_pc_ice_asteroidal_frozen_exotic_matter_new value = 1 } } 
				}				
			}
			if = { 
				limit = { NOT = { check_variable = { which = tb_pc_ice_asteroidal_primordial_ice_new value = tb_pc_ice_asteroidal_primordial_ice } } }
				set_variable = { which = tb_pc_ice_asteroidal_primordial_ice value = tb_pc_ice_asteroidal_primordial_ice_new }
				add_modifier = { modifier = pc_ice_asteroidal_primordial_ice_mined days = 3600 }
			}					
			else_if = { 
				limit = { NOT = { check_variable = { which = tb_pc_ice_asteroidal_frozen_exotic_matter_new value = tb_pc_ice_asteroidal_frozen_exotic_matter } } }
				set_variable = { which = tb_pc_ice_asteroidal_frozen_exotic_matter value = tb_pc_ice_asteroidal_frozen_exotic_matter_new }
				add_modifier = { modifier = pc_ice_asteroidal_frozen_exotic_matter_mined days = 3600 }
			}			
		}	
		else_if = { 
			limit = { is_planet_class = pc_crystal_asteroidal_planetoid }
			add_modifier = { modifier = pc_crystal_asteroidal_subspace_crystal_formation_mined days = 3600 }
		}	
	}
}	

ship_event = { 
	id = cgm_asteroid_colonization.2
	hide_window = yes
	is_triggered_only = yes
	
	trigger = { 
		has_global_flag = cgm_asteroid_colonization_enabled
		from = { 
			has_planet_flag = asteroidal_candidate 
			OR = { 
				is_planet_class = pc_asteroid
				is_planet_class = pc_ice_asteroid			
				is_planet_class = pc_large_asteroid_moon
				is_planet_class = pc_small_asteroid_moon
				is_planet_class = pc_dwarf_planet_asteroid
			}				
		} 
	}
	
	immediate = { 
		random_list = { 
			0 = { 
				if = { 
					limit = { owner = { is_ai = no } }
					from = { 
						add_anomaly = cgm_colonizable_asteroidal_category
						remove_planet_flag = asteroidal_candidate
					}
				}
				else = { 
					from = { 
						add_anomaly = cgm_colonizable_asteroidal_category
						remove_planet_flag = asteroidal_candidate
					} 
				}		
				modifier = { 
					add = 20
					has_global_flag = cgm_very_low_colonizable_asteroids
				}								
				modifier = { 
					add = 35
					has_global_flag = cgm_low_colonizable_asteroids
				}				
				modifier = { 
					add = 50
					has_global_flag = cgm_default_colonizable_asteroids
				}	
				modifier = { 
					add = 65
					has_global_flag = cgm_high_colonizable_asteroids
				}					
				modifier = { 
					add = 80
					has_global_flag = cgm_very_high_colonizable_asteroids
				}		
			}
			0 = { 
				remove_planet_flag = asteroidal_candidate
				modifier = { 
					add = 80
					has_global_flag = cgm_very_low_colonizable_asteroids
				}								
				modifier = { 
					add = 65
					has_global_flag = cgm_low_colonizable_asteroids
				}				
				modifier = { 
					add = 50
					has_global_flag = cgm_default_colonizable_asteroids
				}	
				modifier = { 
					add = 35
					has_global_flag = cgm_default_colonizable_asteroids
				}					
				modifier = { 
					add = 20
					has_global_flag = cgm_default_colonizable_asteroids
				}			
			}
		}
	}	
}