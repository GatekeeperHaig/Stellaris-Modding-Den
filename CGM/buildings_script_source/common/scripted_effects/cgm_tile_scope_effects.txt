 ### Effects in this file are ran on tile scope.
check_neighboring_adj_bonus_buildings = {
	check_neighboring_adj_bonus_buildings_APIs = yes
	every_neighboring_tile = {
		if = {
			limit = { has_building = building_hyperstorage_facility_1 }
			prevprev = {
				change_variable = { which = minerals_weight value = @hyperstorage_t1_adjacency_bonus }
				change_variable = { which = food_weight value = @hyperstorage_t1_adjacency_bonus }
				change_variable = { which = energy_weight value = @hyperstorage_t1_adjacency_bonus }
			}
		}
		else = {
			if = {
				limit = { has_building = building_hyperstorage_facility_2 }
				prevprev = {
					change_variable = { which = minerals_weight value = @hyperstorage_t2_adjacency_bonus }
					change_variable = { which = food_weight value = @hyperstorage_t2_adjacency_bonus }
					change_variable = { which = energy_weight value = @hyperstorage_t2_adjacency_bonus }
				}
			}
			else = {
				if = {
					limit = { has_building = building_hyperstorage_facility_3 }
					prevprev = {
						change_variable = { which = minerals_weight value = @hyperstorage_t3_adjacency_bonus }
						change_variable = { which = food_weight value = @hyperstorage_t3_adjacency_bonus }
						change_variable = { which = energy_weight value = @hyperstorage_t3_adjacency_bonus }
					}
				}
			}
		}
	}
	if = {
		limit = { prev = { is_habitat = no } }
		if = {
			limit = { prev.owner = { is_machine_empire = no } }
			every_neighboring_tile = {
				if = {
					limit = { has_building = building_capital_1 }
					prevprev = {
						change_variable = { which = minerals_weight value = 1 }
						change_variable = { which = food_weight value = 1 }
						change_variable = { which = energy_weight value = 1 }
						change_variable = { which = engineering_research_weight value = 1 }
						change_variable = { which = society_research_weight value = 1 }
						change_variable = { which = physics_research_weight value = 1 }
					}
				}
				else = {
					if = {
						limit = { has_building = building_capital_2 }
						prevprev = {
							change_variable = { which = minerals_weight value = 2 }
							change_variable = { which = food_weight value = 2 }
							change_variable = { which = energy_weight value = 2 }
							change_variable = { which = engineering_research_weight value = 2 }
							change_variable = { which = society_research_weight value = 2 }
							change_variable = { which = physics_research_weight value = 2 }
						}
					}
					else = {
						if = {
							limit = { has_building = building_capital_3 }
							prevprev = {
								change_variable = { which = minerals_weight value = 3 }
								change_variable = { which = food_weight value = 3 }
								change_variable = { which = energy_weight value = 3 }
								change_variable = { which = engineering_research_weight value = 3 }
								change_variable = { which = society_research_weight value = 3 }
								change_variable = { which = physics_research_weight value = 3 }
							}
						}
					}
				}
			}
		}
		else = {
			every_neighboring_tile = {
				if = {
					limit = { has_building = building_machine_capital_1 }
					prevprev = {
						change_variable = { which = minerals_weight value = 1 }
						change_variable = { which = food_weight value = 1 }
						change_variable = { which = energy_weight value = 1 }
						change_variable = { which = engineering_research_weight value = 1 }
						change_variable = { which = society_research_weight value = 1 }
						change_variable = { which = physics_research_weight value = 1 }
					}
				}
				else = {
					if = {
						limit = { has_building = building_machine_capital_2 }
						prevprev = {
							change_variable = { which = minerals_weight value = 2 }
							change_variable = { which = food_weight value = 2 }
							change_variable = { which = energy_weight value = 2 }
							change_variable = { which = engineering_research_weight value = 2 }
							change_variable = { which = society_research_weight value = 2 }
							change_variable = { which = physics_research_weight value = 2 }
						}
					}
					else = {
						if = {
							limit = { has_building = building_machine_capital_3 }
							prevprev = {
								change_variable = { which = minerals_weight value = 3 }
								change_variable = { which = food_weight value = 3 }
								change_variable = { which = energy_weight value = 3 }
								change_variable = { which = engineering_research_weight value = 3 }
								change_variable = { which = society_research_weight value = 3 }
								change_variable = { which = physics_research_weight value = 3 }
							}
						}
					}
				}
			}
		}
	}
	else = {
		if = {
			limit = { has_building = building_hab_capital }
			prevprev = {
				change_variable = { which = minerals_weight value = 1 }
				change_variable = { which = food_weight value = 1 }
				change_variable = { which = energy_weight value = 1 }
				change_variable = { which = engineering_research_weight value = 1 }
				change_variable = { which = society_research_weight value = 1 }
				change_variable = { which = physics_research_weight value = 1 }
			}
		}
		else = {
			if = {
				limit = { has_building = building_machine_capital_3 }
				prevprev = {
					change_variable = { which = minerals_weight value = 3 }
					change_variable = { which = food_weight value = 3 }
					change_variable = { which = energy_weight value = 3 }
					change_variable = { which = engineering_research_weight value = 3 }
					change_variable = { which = society_research_weight value = 3 }
					change_variable = { which = physics_research_weight value = 3 }
				}
			}
			else = {
				if = {
					limit = { has_building = building_capital_3 }
					prevprev = {
						change_variable = { which = minerals_weight value = 3 }
						change_variable = { which = food_weight value = 3 }
						change_variable = { which = energy_weight value = 3 }
						change_variable = { which = engineering_research_weight value = 3 }
						change_variable = { which = society_research_weight value = 3 }
						change_variable = { which = physics_research_weight value = 3 }
					}
				}
			}
		}
	}
	if = {
		limit = { prev = { is_artificial = yes } }
		every_neighboring_tile = {
			limit = {
				has_resource = { type = sr_megastructure_node amount > 0 }
			}
			if = {
				limit = {
					has_resource = { type = sr_megastructure_node amount = 1 }
				}
				if = {
					limit = { has_building = building_energy_matter_converter_1_1 }
					prevprev = {
						change_variable = { which = minerals_weight value = @megastructure_unique_t1_1_adjacency_bonus }
					}
				}
				else = {
					if = {
						limit = { has_building = building_energy_matter_converter_2_1 }
						prevprev = {
							change_variable = { which = minerals_weight value = @megastructure_unique_t2_1_adjacency_bonus }
						}
					}
					else = {
						if = {
							limit = { has_building = building_energy_matter_converter_3_1 }
							prevprev = {
								change_variable = { which = minerals_weight value = @megastructure_unique_t3_1_adjacency_bonus }
							}
						}
						else = {
							if = {
								limit = { has_building = building_energy_conduit_1_1 }
								prevprev = {
									change_variable = { which = energy_weight value = @megastructure_unique_t1_1_adjacency_bonus }
								}
							}
							else = {
								if = {
									limit = { has_building = building_energy_conduit_2_1 }
									prevprev = {
										change_variable = { which = energy_weight value = @megastructure_unique_t2_1_adjacency_bonus }
									}
								}
								else = {
									if = {
										limit = { has_building = building_energy_conduit_3_1 }
										prevprev = {
											change_variable = { which = energy_weight value = @megastructure_unique_t2_1_adjacency_bonus }
										}
									}
									else = {
										if = {
											limit = { has_building = building_food_replicator_1_1 }
											prevprev = {
												change_variable = { which = food_weight value = @megastructure_unique_t1_1_adjacency_bonus }
											}
										}
										else = {
											if = {
												limit = { has_building = building_food_replicator_2_1 }
												prevprev = {
													change_variable = { which = food_weight value = @megastructure_unique_t2_1_adjacency_bonus }
												}
											}
											else = {
												if = {
													limit = { has_building = building_food_replicator_3_1 }
													prevprev = {
														change_variable = { which = food_weight value = @megastructure_unique_t3_1_adjacency_bonus }
													}
												}
												else = {
													if = {
														limit = { has_building = building_computational_array_1_1 }
														prevprev = {
															change_variable = { which = society_research_weight value = @megastructure_unique_t1_1_adjacency_bonus }
															change_variable = { which = physics_research_weight value = @megastructure_unique_t1_1_adjacency_bonus }
															change_variable = { which = engineering_research_weight value = @megastructure_unique_t1_1_adjacency_bonus }
														}
													}
													else = {
														if = {
															limit = { has_building = building_computational_array_2_1 }
															prevprev = {
																change_variable = { which = society_research_weight value = @megastructure_unique_t2_1_adjacency_bonus }
																change_variable = { which = physics_research_weight value = @megastructure_unique_t2_1_adjacency_bonus }
																change_variable = { which = engineering_research_weight value = @megastructure_unique_t2_1_adjacency_bonus }
															}
														}
														else = {
															if = {
																limit = { has_building = building_computational_array_3_1 }
																prevprev = {
																	change_variable = { which = society_research_weight value = @megastructure_unique_t3_1_adjacency_bonus }
																	change_variable = { which = physics_research_weight value = @megastructure_unique_t3_1_adjacency_bonus }
																	change_variable = { which = engineering_research_weight value = @megastructure_unique_t3_1_adjacency_bonus }
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
			else = {
				if = {
					limit = {
						has_resource = { type = sr_megastructure_node amount = 2 }
					}
					if = {
						limit = { has_building = building_energy_matter_converter_1_2 }
						prevprev = {
							change_variable = { which = minerals_weight value = @megastructure_unique_t1_2_adjacency_bonus }
						}
					}
					else = {
						if = {
							limit = { has_building = building_energy_matter_converter_2_2 }
							prevprev = {
								change_variable = { which = minerals_weight value = @megastructure_unique_t2_2_adjacency_bonus }
							}
						}
						else = {
							if = {
								limit = { has_building = building_energy_matter_converter_3_2 }
								prevprev = {
									change_variable = { which = minerals_weight value = @megastructure_unique_t3_2_adjacency_bonus }
								}
							}
							else = {
								if = {
									limit = { has_building = building_energy_conduit_1_2 }
									prevprev = {
										change_variable = { which = energy_weight value = @megastructure_unique_t1_2_adjacency_bonus }
									}
								}
								else = {
									if = {
										limit = { has_building = building_energy_conduit_2_2 }
										prevprev = {
											change_variable = { which = energy_weight value = @megastructure_unique_t2_2_adjacency_bonus }
										}
									}
									else = {
										if = {
											limit = { has_building = building_energy_conduit_3_2 }
											prevprev = {
												change_variable = { which = energy_weight value = @megastructure_unique_t3_2_adjacency_bonus }
											}
										}
										else = {
											if = {
												limit = { has_building = building_food_replicator_1_2 }
												prevprev = {
													change_variable = { which = food_weight value = @megastructure_unique_t1_2_adjacency_bonus }
												}
											}
											else = {
												if = {
													limit = { has_building = building_food_replicator_2_2 }
													prevprev = {
														change_variable = { which = food_weight value = @megastructure_unique_t2_2_adjacency_bonus }
													}
												}
												else = {
													if = {
														limit = { has_building = building_food_replicator_3_2 }
														prevprev = {
															change_variable = { which = food_weight value = @megastructure_unique_t3_2_adjacency_bonus }
														}
													}
													else = {
														if = {
															limit = { has_building = building_computational_array_1_2 }
															prevprev = {
																change_variable = { which = society_research_weight value = @megastructure_unique_t1_2_adjacency_bonus }
																change_variable = { which = physics_research_weight value = @megastructure_unique_t1_2_adjacency_bonus }
																change_variable = { which = engineering_research_weight value = @megastructure_unique_t1_2_adjacency_bonus }
															}
														}
														else = {
															if = {
																limit = { has_building = building_computational_array_2_2 }
																prevprev = {
																	change_variable = { which = society_research_weight value = @megastructure_unique_t2_2_adjacency_bonus }
																	change_variable = { which = physics_research_weight value = @megastructure_unique_t2_2_adjacency_bonus }
																	change_variable = { which = engineering_research_weight value = @megastructure_unique_t2_2_adjacency_bonus }
																}
															}
															else = {
																if = {
																	limit = { has_building = building_computational_array_3_2 }
																	prevprev = {
																		change_variable = { which = society_research_weight value = @megastructure_unique_t3_2_adjacency_bonus }
																		change_variable = { which = physics_research_weight value = @megastructure_unique_t3_2_adjacency_bonus }
																		change_variable = { which = engineering_research_weight value = @megastructure_unique_t3_2_adjacency_bonus }
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				else = {
					if = {
						limit = {
							has_resource = { type = sr_megastructure_node amount = 3 }
						}
						if = {
							limit = { has_building = building_energy_matter_converter_1_3 }
							prevprev = {
								change_variable = { which = minerals_weight value = @megastructure_unique_t1_3_adjacency_bonus }
							}
						}
						else = {
							if = {
								limit = { has_building = building_energy_matter_converter_2_3 }
								prevprev = {
									change_variable = { which = minerals_weight value = @megastructure_unique_t2_3_adjacency_bonus }
								}
							}
							else = {
								if = {
									limit = { has_building = building_energy_matter_converter_3_3 }
									prevprev = {
										change_variable = { which = minerals_weight value = @megastructure_unique_t3_3_adjacency_bonus }
									}
								}
								else = {
									if = {
										limit = { has_building = building_energy_conduit_1_3 }
										prevprev = {
											change_variable = { which = energy_weight value = @megastructure_unique_t1_3_adjacency_bonus }
										}
									}
									else = {
										if = {
											limit = { has_building = building_energy_conduit_2_3 }
											prevprev = {
												change_variable = { which = energy_weight value = @megastructure_unique_t2_3_adjacency_bonus }
											}
										}
										else = {
											if = {
												limit = { has_building = building_energy_conduit_3_3 }
												prevprev = {
													change_variable = { which = energy_weight value = @megastructure_unique_t3_3_adjacency_bonus }
												}
											}
											else = {
												if = {
													limit = { has_building = building_food_replicator_1_3 }
													prevprev = {
														change_variable = { which = food_weight value = @megastructure_unique_t1_3_adjacency_bonus }
													}
												}
												else = {
													if = {
														limit = { has_building = building_food_replicator_2_3 }
														prevprev = {
															change_variable = { which = food_weight value = @megastructure_unique_t2_3_adjacency_bonus }
														}
													}
													else = {
														if = {
															limit = { has_building = building_food_replicator_3_3 }
															prevprev = {
																change_variable = { which = food_weight value = @megastructure_unique_t3_3_adjacency_bonus }
															}
														}
														else = {
															if = {
																limit = { has_building = building_computational_array_1_3 }
																prevprev = {
																	change_variable = { which = society_research_weight value = @megastructure_unique_t1_3_adjacency_bonus }
																	change_variable = { which = physics_research_weight value = @megastructure_unique_t1_3_adjacency_bonus }
																	change_variable = { which = engineering_research_weight value = @megastructure_unique_t1_3_adjacency_bonus }
																}
															}
															else = {
																if = {
																	limit = { has_building = building_computational_array_2_3 }
																	prevprev = {
																		change_variable = { which = society_research_weight value = @megastructure_unique_t2_3_adjacency_bonus }
																		change_variable = { which = physics_research_weight value = @megastructure_unique_t2_3_adjacency_bonus }
																		change_variable = { which = engineering_research_weight value = @megastructure_unique_t2_3_adjacency_bonus }
																	}
																}
																else = {
																	if = {
																		limit = { has_building = building_computational_array_3_3 }
																		prevprev = {
																			change_variable = { which = society_research_weight value = @megastructure_unique_t3_3_adjacency_bonus }
																			change_variable = { which = physics_research_weight value = @megastructure_unique_t3_3_adjacency_bonus }
																			change_variable = { which = engineering_research_weight value = @megastructure_unique_t3_3_adjacency_bonus }
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
}
check_adj_bonus_blockers = {
	every_neighboring_tile = {
		limit = { 
			has_blocker = yes
			NOR = { #take out the very common blockers that do nothing anyway
				has_blocker = tb_mountain_range
				has_blocker = tb_active_volcano
				has_blocker = tb_dangerous_wildlife
				has_blocker = tb_dense_jungle
				has_blocker = tb_quicksand_basin
				has_blocker = tb_noxious_swamp
				has_blocker = tb_massive_glacier
				has_blocker = tb_toxic_kelp
				has_blocker = tb_deep_sinkhole
			}
		}
		if = {
			limit = { has_blocker = tb_wandering_forest_reserve }
			prev = {
				change_variable = { which = society_research_weight value = 3 }
			}
		}
		else_if = {
			limit = { has_blocker = tb_tribal_settlement }
			prev = {
				change_variable = { which = society_research_weight value = 1 }
			}
		}
		else = {
			check_neighboring_adj_bonus_blockers_APIs = yes
		}
	}
}
