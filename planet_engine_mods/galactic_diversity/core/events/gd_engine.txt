namespace = gdengine

event = {
	id = gdengine.00
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	immediate = { 
		set_global_flag = galactic_diversity
		every_planet = { 
			if = { 			
				limit = { is_gas_giant = yes has_moon = yes }
				every_moon = { set_planet_flag = gas_giant_moon }
			}
			if = { 			
				limit = { is_asteroid = yes }
				new_worlds_adjust_asteroids_size = yes
			}
			
		}
		every_planet = { 
			if = {
				limit = {
					NOR = { 
						AND = { 
							exists = owner 
							owner = { is_country_type = default }
							OR = { 
								is_capital = yes
								is_homeworld = yes
							}
						}	
						AND = { 
							exists = owner 
							NAND = { 
								owner = { is_country_type = primitive } 
								any_owned_pop = { is_robot_pop = no } 
							}
						}	
						solar_system = {
							OR = {
								any_system_planet = { exists = owner owner = { is_country_type = default } is_capital = yes }
								has_star_flag = cgm_ignored_system
								has_star_flag = sol_system
								has_star_flag = custom_system
								has_star_flag = floating_system
								has_star_flag = pdcrystal_system
								has_star_flag = city_system
								has_star_flag = graveyard_system
								has_star_flag = mushroom_system
								has_star_flag = biolumen_system
								has_star_flag = technoorganic_system
								has_star_flag = archive_system
								has_star_flag = empire_home_system
								has_star_flag = primitive_sol
								has_star_flag = eilistraee_system
								has_star_flag = tulshar_system
								has_star_flag = elven_system
								has_star_flag = lunari_system
								has_star_flag = elven_ring_system
								has_star_flag = AI_hub
								has_star_flag = AI_lair
								has_star_flag = sentinel_system
								has_star_flag = vechtar_zavonia_system
								has_star_flag = toxic_moon_system
								has_star_flag = shattered_world_system
								has_star_flag = hostile_system
								has_star_flag = high_energy_system
								has_star_flag = superflare_system
								has_star_flag = ruined_empire
								has_star_flag = crystal_system
								has_star_flag = sealed_system
								has_star_flag = marauder_system
								has_star_flag = ruined_matter_decompressor_system
								has_star_flag = ruined_strategic_coordination_center_system
								has_star_flag = ruined_interstellar_assembly_system
								has_star_flag = precursor_system
								has_star_flag = hyacinth_system
								
							}
						}
					}						
				}	
				# these events occur one after the other.
				planet_event = { id = gdengine.01 days = 1 } # REMOVE VANILLA MODIFIERS
				planet_event = { id = gdengine.02 days = 1 } # UNINHABITABLE SPAWNER / SIZE ADJUSTMENT
				planet_event = { id = gdengine.03 days = 2 } # SPAWN HABITABLE WORLDS
				planet_event = { id = gdengine.04 days = 3 } # ORBITAL RESOURCE SPAWNER
				
			}
		}
	}
}

planet_event = {
	id = gdengine.01 # REMOVE VANILLA MODIFIERS
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	
	immediate = {
		if = {
			limit = {
				OR = {
					has_modifier = "tidal_locked"
					has_modifier = "low_gravity"
					has_modifier = "high_gravity"
					has_modifier = "mineral_rich"
					has_modifier = "ultra_rich"
					has_modifier = "mineral_poor"
				}
			}
			remove_modifier = "tidal_locked"
			remove_modifier = "low_gravity"
			remove_modifier = "high_gravity"
			remove_modifier = "mineral_rich"
			remove_modifier = "ultra_rich"
			remove_modifier = "mineral_poor"
		}
	}
}

planet_event = {
	id = gdengine.02 # UNINHABITABLE SPAWNER / SIZE ADJUSTMENT
	hide_window = yes
	is_triggered_only = yes
	#fire_only_once = yes
	
	immediate = {
			if = { 
				limit = { 
					AND = {
						uninhabitable_planet = yes
						NOT = { has_planet_flag = gpm_is_wondrous_planet }
					}
				}
				new_worlds_adjust_uninhabitable_planet_size = yes
				new_worlds_adjust_gas_giant_planet_size = yes
				uninhabitable_planets_spawn_table = yes
				reroll_modifier = yes
			}
			
			planet_event = { id = gdengine.05 days = 3 } # SPAWN TERRAFORMING CANDIDATE MODIFIER
			planet_event = { id = gdengine.06 days = 3 } # SPAWN ROCKY SUBTERRANEAN CANDIDATE MODIFIER
			planet_event = { id = gdengine.07 days = 3 } # SPAWN ICY SUBTERRANEAN CANDIDATE MODIFIER
	}
}

planet_event = {
	id = gdengine.03 # SPAWN POTENTIALLY HABITABLE WORLDS
	hide_window = yes
	is_triggered_only = yes
	#fire_only_once = yes
	
	immediate = {
		if = {
			limit = {
				OR = {
					has_planet_flag = eco_hot_planet
					has_planet_flag = eco_temp_planet
					has_planet_flag = eco_cold_planet
				}
			}
			random_list = {
			
				0 = {
					remove_vanilla_planet_modifiers = yes
					spawn_super_terrestrial = yes
					modifier = { factor = 0.05 solar_system = { any_system_planet = { filtered_habitable_planet = yes } } } 
					modifier = { factor = 0.00 OR = { planet_size < 15 planet_size > 22 } }
				}
				10 = {
					remove_vanilla_planet_modifiers = yes
					spawn_terrestrial = yes
					modifier = { factor = 0.33 solar_system = { any_system_planet = { filtered_habitable_planet = yes } } } 
					modifier = { factor = 0.00 OR = { planet_size < 15 planet_size > 22 } }
				}
				0 = {
					remove_vanilla_planet_modifiers = yes
					spawn_oceanic = yes
					modifier = { factor = 0.33 solar_system = { any_system_planet = { filtered_habitable_planet = yes } } } 
					modifier = { factor = 0.00 OR = { planet_size < 15 planet_size > 22 } }
				}
				0 = {
					remove_vanilla_planet_modifiers = yes
					spawn_marginal = yes
					modifier = { factor = 0.66 solar_system = { any_system_planet = { filtered_habitable_planet = yes } } } 
					modifier = { factor = 0.00 OR = { planet_size < 15 planet_size > 22 } }
				}
				0 = {
					remove_vanilla_planet_modifiers = yes
					spawn_sub_marginal = yes
					modifier = { factor = 0.95 solar_system = { any_system_planet = { filtered_habitable_planet = yes } } } 
					modifier = { factor = 0.00 OR = { planet_size < 15 planet_size > 22 } }
				}
				0 = {
					#Do nothing / remain uninhabitable
					modifier = { factor = 0.33 has_global_flag = habitable_very_high_expectations }
					modifier = { factor = 0.66 has_global_flag = habitable_high_expectations }
					modifier = { factor = 1.50 has_global_flag = habitable_low_expectations }
					modifier = { factor = 2.00 has_global_flag = habitable_very_low_expectations }
				}
			}
		}
	}
}

planet_event = {
	id = gdengine.04 # ORBITAL RESOURCE SPAWNER
	hide_window = yes
	is_triggered_only = yes
	#fire_only_once = yes
	
	immediate = {
			if = { 
				limit = {
					AND = {
						OR = {
							uninhabitable_planet = yes
							is_star = yes
						}
						NOR = {
							has_deposit = d_trade_value_1
							has_deposit = d_trade_value_2
							has_deposit = d_trade_value_3
							has_deposit = d_trade_value_4
							has_deposit = d_trade_value_5
							has_deposit = d_trade_value_6
							has_deposit = d_trade_value_7
							has_deposit = d_trade_value_8
							has_deposit = d_trade_value_9
							has_deposit = d_trade_value_10
							has_deposit = d_engineering_6
							has_deposit = d_engineering_7
							has_deposit = d_engineering_8
							has_deposit = d_engineering_9
							has_deposit = d_engineering_10
							has_deposit = d_physics_6
							has_deposit = d_physics_7
							has_deposit = d_physics_8
							has_deposit = d_physics_9
							has_deposit = d_physics_10
							has_deposit = d_society_6
							has_deposit = d_society_7
							has_deposit = d_society_8
							has_deposit = d_society_9
							has_deposit = d_society_10
							has_deposit = d_energy_6
							has_deposit = d_energy_7
							has_deposit = d_energy_8
							has_deposit = d_energy_9
							has_deposit = d_energy_10
							has_deposit = d_minerals_6
							has_deposit = d_minerals_7
							has_deposit = d_minerals_8
							has_deposit = d_minerals_9
							has_deposit = d_minerals_10
							has_deposit = d_alloys_3
							has_deposit = d_alloys_4
							has_deposit = d_alloys_5
							has_deposit = d_vast_unity_deposit
							has_deposit = d_nanites_deposit
							has_deposit = d_guardian_dragon_hoard
						}
					}
				}
				clear_deposits = yes
				nw_orbital_resource_spawn_table = yes
			}
	}
}

planet_event = {
	id = gdengine.05 # SPAWN TERRAFORMING CANDIDATE MODIFIER
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	#Terraforming Candidate
	immediate = {
		every_planet = { 
			limit = {  
				OR = {
					is_planet_class = pc_barren
					is_planet_class = pc_hot_reducing
					is_planet_class = pc_cold_reducing
				}
				not = { has_modifier = terraforming_candidate }	
				planet_size > 9
				planet_size < 26	
				solar_system = {
					NOR = {
						is_star_class = sc_black_hole
						is_star_class = sc_neutron_star
						is_star_class = sc_pulsar
					}
				}
			}	
			random_list = {
				6 = {
					modifier = { factor = 1.50 has_moon = yes }
					modifier = { factor = 1.25 is_gas_giant_moon = yes }
					modifier = { factor = 0.50 is_moon = yes NOT = { is_gas_giant_moon = yes } }
					modifier = { factor = 0.25 orbits_hot_star = yes }
					add_modifier = { modifier = terraforming_candidate days = -1 }
				}
				94 = { }	
			}
		}
	}
	#Defrost Candidate
	immediate = {
		every_planet = { 
			limit = {  
				AND = {
					is_planet_class = pc_frozen
					NOT = { orbits_cold_star = yes }
				}
				not = { has_modifier = defrost_candidate }	
				planet_size > 9
				planet_size < 26	
				solar_system = {
					NOR = {
						is_star_class = sc_black_hole
						is_star_class = sc_neutron_star
						is_star_class = sc_pulsar
					}
				}
			}	
			random_list = {
				5 = {
					modifier = { factor = 1.25 has_moon = yes }
					modifier = { factor = 2.00 is_gas_giant_moon = yes }
					modifier = { factor = 1.00 is_moon = yes NOT = { is_gas_giant_moon = yes } }
					modifier = { factor = 0.75 orbits_hot_star = yes }
					add_modifier = { modifier = defrost_candidate days = -1 }
				}
				95 = { }	
			}
		}
	}
	#Detox Candidate
	immediate = {
		every_planet = { 
			limit = {  
				AND = {
					is_planet_class = pc_toxic
					NOT = { orbits_cold_star = yes }
				}
				not = { has_modifier = detox_candidate }	
				planet_size > 9
				planet_size < 26	
				solar_system = {
					NOR = {
						is_star_class = sc_black_hole
						is_star_class = sc_neutron_star
						is_star_class = sc_pulsar
					}
				}
			}	
			random_list = {
				5 = {
					modifier = { factor = 1.25 has_moon = yes }
					modifier = { factor = 2.00 is_gas_giant_moon = yes }
					modifier = { factor = 1.00 is_moon = yes NOT = { is_gas_giant_moon = yes } }
					modifier = { factor = 0.75 orbits_hot_star = yes }
					add_modifier = { modifier = detox_candidate days = -1 }
				}
				95 = { }	
			}
		}
	}
}

planet_event = {
	id = gdengine.06 # SPAWN ROCKY SUBTERRANEAN CANDIDATE MODIFIER
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	#Rocky Subterranean Candidate
	immediate = {
		every_planet = { 
			limit = {  
				is_planet_class = pc_barren_cold
				not = { has_modifier = subterranean_rocky_candidate }	
				planet_size > 6
				planet_size < 16	
			}	
			random_list = {
				7 = {
					modifier = { factor = 1.50 is_moon = yes NOT = { is_gas_giant_moon = yes } }
					modifier = { factor = 0.50 is_gas_giant_moon = yes }
					modifier = {
						factor = 0.25 solar_system = { any_system_planet = { habitable_planet = yes } }
					}
					add_modifier = { modifier = subterranean_rocky_candidate days = -1 }
				}
				93 = { }	
			}
		}
	}
}

planet_event = {
	id = gdengine.07 # SPAWN ICY SUBTERRANEAN CANDIDATE MODIFIER
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	#Icy Subterranean Candidate
	immediate = {
		every_planet = { 
			limit = {  
				is_planet_class = pc_frozen
				not = { has_modifier = subterranean_icy_candidate }	
				planet_size > 6
				planet_size < 16	
			}	
			random_list = {
				7 = {
					modifier = { factor = 2 is_gas_giant_moon = yes }
					modifier = {
						factor = 0.25 solar_system = { any_system_planet = { habitable_planet = yes } }
					}
					add_modifier = { modifier = subterranean_icy_candidate days = -1 }
				}
				97 = { }	
			}
		}
	}
}


country_event = {
    id = gdengine.09 # SOL START QUERY
	title = gdengine.09.name
	desc = gdengine.09.desc
	picture = GFX_evt_drilling_for_gas
	show_sound = event_default
	location = root

	is_triggered_only = yes

	trigger = {
		owner = { is_ai = no }
		solar_system = { has_star_flag = sol_system }
	}

	option = {
		name = gdengine.09.a
        every_planet = {
            if = {
                limit = {
                    solar_system = { has_star_flag = sol }
                    is_planet_class = pc_hot_reducing       
                    NOT = { has_planet_flag = "pdvenusnoterraform" }
				}
                set_planet_flag = "pdvenusnoterraform"
            }
		}
		every_planet = {
            if = {
                limit = {
                    solar_system = { has_star_flag = sol }
                    is_planet_class = pc_cold_reducing       
                    NOT = { has_planet_flag = "pdtitannoterraform" }
				}
                set_planet_flag = "pdtitannoterraform"
            }
		}
	}

	option = {
		name = gdengine.09.b
        every_planet = {
            if = {
                limit = {
                    solar_system = { has_star_flag = sol }
                    is_planet_class = pc_hot_reducing       
                    NOT = { has_planet_flag = "pdvenus" }
				}
                add_modifier = { modifier = "terraforming_candidate" days = -1 }
                set_planet_flag = "pdvenus"
            }
		}
		every_planet = {
            if = {
                limit = {
                    solar_system = { has_star_flag = sol }
                    is_planet_class = pc_cold_reducing       
                    NOT = { has_planet_flag = "pdtitannoterraform" }
				}
                set_planet_flag = "pdtitannoterraform"
            }
		}
	}
	
	option = {
		name = gdengine.09.c
		every_planet = {
            if = {
                limit = {
                    solar_system = { has_star_flag = sol }
                    is_planet_class = pc_hot_reducing       
                    NOT = { has_planet_flag = "pdvenusnoterraform" }
				}
                set_planet_flag = "pdvenusnoterraform"
            }
		}
        every_planet = {
            if = {
                limit = {
                    solar_system = { has_star_flag = sol }
                    is_planet_class = pc_cold_reducing
                    NOT = { has_planet_flag = "pdtitan" }
				}
                add_modifier = { modifier = "terraforming_candidate" days = -1 }
                set_planet_flag = "pdtitan"
            }
		}
	}

	option = {
		name = gdengine.09.d
		every_planet = {
			if = {
				limit = {
					solar_system = { has_star_flag = sol }
					is_planet_class = pc_cold_reducing
					NOT = { has_planet_flag = "pdtitan" }
				}
				add_modifier = { modifier = "terraforming_candidate" days = -1 }
				set_planet_flag = "pdtitan"
	      	}
		}
	    every_planet = {
            if = {
                limit = {
					solar_system = { has_star_flag = sol }
                    is_planet_class = pc_hot_reducing
                    NOT = { has_planet_flag = "pdvenus" }
				}
                add_modifier = { modifier = "terraforming_candidate" days = -1 }
                set_planet_flag = "pdvenus"
			}
		}	
	}		
}

event = {
		id = gdengine.14 # SPAWN GPM modifiers on Sol planets
		hide_window = yes
		is_triggered_only = yes
		fire_only_once = yes
		immediate = {
			# VENUS
			every_planet = {
				limit = { 
					has_global_flag = has_guillis_planet_modifiers_mod
					solar_system = { has_star_flag = sol }
					is_planet_class = pc_hot_reducing
				}
				add_modifier = {
					modifier = "Dense_Atmospheres"
					days = -1
				}
			}
			# MARS
			every_planet = {
				limit = { 
					has_global_flag = has_guillis_planet_modifiers_mod
					solar_system = { has_star_flag = sol }
					is_planet_class = pc_desolate
				}
				add_modifier = {
					modifier = "weak_magnetic_field_2"
					days = -1
				}
				add_modifier = {
					modifier = "Water_Pockets"
					days = -1
				}
			}
			# EUROPA
			every_planet = {
				limit = { 
					has_global_flag = has_guillis_planet_modifiers_mod
					solar_system = { has_star_flag = sol }
					is_planet_class = pc_frozen
					has_planet_flag = sol_europa
				}
				add_modifier = {
					modifier = "Cryogeysers"
					days = -1
				}
				add_modifier = {
					modifier = "Deep_Aquifer"
					days = -1
				}
			}
			# LUNA
			every_planet = {
				limit = { 
					has_global_flag = has_guillis_planet_modifiers_mod
					solar_system = { has_star_flag = sol }
					is_planet_class = pc_underground_rocky
				}
				
			}
		}
}