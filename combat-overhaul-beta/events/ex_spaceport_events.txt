namespace = ex_spaceport_events

event = { #this event fires on game start 
	id = ex_spaceport_events.0
	hide_window = yes
	is_triggered_only = yes

	immediate = { 
		every_country = { 
			limit = {
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
			}	
			every_owned_planet = { 				
				limit = { has_spaceport = yes }				
				planet_event = { id = ex_spaceport_events.10 }														
			}	
		}
	}	
}

ship_event = { #this event fires the moment a spaceport is built
	id = ex_spaceport_events.1
	hide_window = yes
	is_triggered_only = yes

	immediate = { 
		from = { 
			remove_spaceport_flags_and_modifiers = yes
			planet_event = { id = ex_spaceport_events.10 }
		}
	} 		
}

country_event = { #this event fires whenever a new technology is researched
	id = ex_spaceport_events.2
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_owned_planet = {
			limit = { has_spaceport = yes }	
			update_spaceport_weapon_modifiers = yes		
		}
	}
}	

country_event = { #this event is triggered when a spaceport is destroyed (not dismantled).
	id = ex_spaceport_events.3
	hide_window = yes
	is_triggered_only = yes
	trigger = {	fromfrom = { is_ship_size = orbital_station } }			
    immediate = { fromfrom = { orbit = { planet = {	remove_spaceport_flags_and_modifiers = yes } } } }
}
				
country_event = { #this event is triggered when a spaceport is dismantled.
	id = ex_spaceport_events.4
	hide_window = yes
	is_triggered_only = yes
	trigger = { from = { is_ship_size = orbital_station } }	
	immediate = { from = { orbit = { planet = {	remove_spaceport_flags_and_modifiers = yes } } } }
}	

event = { #this event fires on a monthly pulse
	id = ex_spaceport_events.6
	hide_window = yes
	is_triggered_only = yes

	immediate = { 
		every_country = { 
			limit = {
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
			}	
			every_owned_planet = { 				
				if = { limit = { has_spaceport = no	NOT = { has_planet_flag = spaceport_flags_removed } has_spaceport_level_flag = yes } remove_spaceport_flags_and_modifiers = yes	}
				if = { limit = { has_spaceport = yes has_planet_flag = spaceport_flags_removed } planet_event = { id = ex_spaceport_events.10 } }
				if = { limit = { has_spaceport = yes } 
					update_spaceport_weapon_modifiers = yes					
					if = { 
						limit = { has_free_spaceport_module_slot = yes } 
						if = { limit = { NOT = { has_spaceport_module = module_under_construction } is_automation_enabled = yes	} planet_event = { id = ex_spaceport_events.10 }	
						else = { if = { limit = { is_spaceport_module_slot_free = 1 has_no_spaceport_level_flag = yes }	planet_event = { id = ex_spaceport_events.10 }
						else = { if = {	limit = { is_spaceport_module_slot_free = 2 no_spaceport_level_flag_2_and_higher = yes } planet_event = { id = ex_spaceport_events.10 }
						else = { if = { limit = { is_spaceport_module_slot_free = 3 no_spaceport_level_flag_3_and_higher = yes } planet_event = { id = ex_spaceport_events.10 }
						else = { if = {	limit = { is_spaceport_module_slot_free = 4 no_spaceport_level_flag_4_and_higher = yes } planet_event = { id = ex_spaceport_events.10 }
						else = { if = {	limit = { is_spaceport_module_slot_free = 5 no_spaceport_level_flag_5_and_higher = yes } planet_event = { id = ex_spaceport_events.10 }
						else = { if = {	limit = { is_spaceport_module_slot_free = 6 no_spaceport_level_flag_6_and_higher = yes } planet_event = { id = ex_spaceport_events.10 }
						else = { if = {	limit = { is_spaceport_module_slot_free = 7 no_spaceport_level_flag_7_and_higher = yes } planet_event = { id = ex_spaceport_events.10 }
						else = { if = {	limit = { is_spaceport_module_slot_free = 8 no_spaceport_level_flag_8_and_higher = yes } planet_event = { id = ex_spaceport_events.10 }
						else = { if = { limit = { is_spaceport_module_slot_free = 9 no_spaceport_level_flag_9 = yes } planet_event = { id = ex_spaceport_events.10 }
}}}}}}}}}}}}}}}}}}}}}}}}}

planet_event = { # this event runs on every tick (day), checking and adding/removing planet flags/modifiers as necessary. 
	id = ex_spaceport_events.10
	hide_window = yes
	is_triggered_only = yes
	
	#trigger = { 
	#	#NOT = { has_planet_flag = level_check_delay }
	#	has_owner = yes
	#	has_spaceport = yes		
	#	has_free_spaceport_module_slot = yes		
	#}
	
	immediate = {
		if = { limit = { has_planet_flag = spaceport_flags_removed } remove_planet_flag = spaceport_flags_removed }
		if = {
			limit = { is_spaceport_module_slot_free = 9	}
			if = { 
				limit = { 
					NOT = { has_planet_flag = ex_spaceport_9 }
				}
				set_planet_flag = ex_spaceport_9
				update_spaceport_modifiers = yes
			}			
			if = { limit = { NOT = { has_planet_flag = slot_9_free } } set_planet_flag = slot_9_free }
			planet_event = { id = ex_spaceport_events.100 }				
		}	
		if = {
			limit = { is_spaceport_module_slot_free = 8	}
			if = { 
				limit = { 
					NOR = { 
						has_planet_flag = ex_spaceport_8 
						has_planet_flag = ex_spaceport_9
					}
				}
				set_planet_flag = ex_spaceport_8
				update_spaceport_modifiers = yes
			}			
			if = { limit = { NOT = { has_planet_flag = slot_8_free } } set_planet_flag = slot_8_free }
			planet_event = { id = ex_spaceport_events.100 }				
		}	
		if = {
			limit = { is_spaceport_module_slot_free = 7	}
			if = { 
				limit = { 
					NOR = { 
						has_planet_flag = ex_spaceport_7 
						has_planet_flag = ex_spaceport_8 
						has_planet_flag = ex_spaceport_9
					}
				}
				set_planet_flag = ex_spaceport_7
				update_spaceport_modifiers = yes
			}			
			if = { limit = { NOT = { has_planet_flag = slot_7_free } } set_planet_flag = slot_7_free }
			planet_event = { id = ex_spaceport_events.100 }				
		}		
		if = {
			limit = { is_spaceport_module_slot_free = 6	}
			if = { 
				limit = { 
					NOR = { 
						has_planet_flag = ex_spaceport_6 
						has_planet_flag = ex_spaceport_7 
						has_planet_flag = ex_spaceport_8 
						has_planet_flag = ex_spaceport_9
					}
				}
				set_planet_flag = ex_spaceport_6
				update_spaceport_modifiers = yes
			}			
			if = { limit = { NOT = { has_planet_flag = slot_6_free } } set_planet_flag = slot_6_free }
			planet_event = { id = ex_spaceport_events.100 }				
		}	
		if = {
			limit = { is_spaceport_module_slot_free = 5	}
			if = { 
				limit = { 
					NOR = { 
						has_planet_flag = ex_spaceport_5 
						has_planet_flag = ex_spaceport_6 
						has_planet_flag = ex_spaceport_7 
						has_planet_flag = ex_spaceport_8 
						has_planet_flag = ex_spaceport_9
					}
				}
				set_planet_flag = ex_spaceport_5
				update_spaceport_modifiers = yes
			}			
			if = { limit = { NOT = { has_planet_flag = slot_5_free } } set_planet_flag = slot_5_free }	
			planet_event = { id = ex_spaceport_events.100 }				
		}	
		if = {
			limit = { is_spaceport_module_slot_free = 4	}
			if = { 
				limit = { 
					NOR = { 
						has_planet_flag = ex_spaceport_4
						has_planet_flag = ex_spaceport_5 
						has_planet_flag = ex_spaceport_6 
						has_planet_flag = ex_spaceport_7 
						has_planet_flag = ex_spaceport_8 
						has_planet_flag = ex_spaceport_9
					}
				}
				set_planet_flag = ex_spaceport_4
				update_spaceport_modifiers = yes				
			}			
			if = { limit = { NOT = { has_planet_flag = slot_4_free } } set_planet_flag = slot_4_free  }
			planet_event = { id = ex_spaceport_events.100 }				
		}	
		if = {
			limit = { is_spaceport_module_slot_free = 3	}
			if = { 
				limit = { 
					NOR = { 
						has_planet_flag = ex_spaceport_3
						has_planet_flag = ex_spaceport_4
						has_planet_flag = ex_spaceport_5 
						has_planet_flag = ex_spaceport_6 
						has_planet_flag = ex_spaceport_7 
						has_planet_flag = ex_spaceport_8 
						has_planet_flag = ex_spaceport_9
					}
				}
				set_planet_flag = ex_spaceport_3	
				update_spaceport_modifiers = yes
			}			
			if = { limit = { NOT = { has_planet_flag = slot_3_free } } set_planet_flag = slot_3_free }
			planet_event = { id = ex_spaceport_events.100 }	
		}	
		if = {
			limit = { is_spaceport_module_slot_free = 2	}
			if = { 
				limit = { 
					NOR = { 
						has_planet_flag = ex_spaceport_2
						has_planet_flag = ex_spaceport_3
						has_planet_flag = ex_spaceport_4
						has_planet_flag = ex_spaceport_5 
						has_planet_flag = ex_spaceport_6 
						has_planet_flag = ex_spaceport_7 
						has_planet_flag = ex_spaceport_8 
						has_planet_flag = ex_spaceport_9
					}
				}
				set_planet_flag = ex_spaceport_2
				update_spaceport_modifiers = yes					
			}			
			if = { limit = { NOT = { has_planet_flag = slot_2_free } } set_planet_flag = slot_2_free }
			planet_event = { id = ex_spaceport_events.100 }	
		}
		if = {
			limit = { is_spaceport_module_slot_free = 1	}
			set_base_weapon = yes
			if = { 
				limit = { 
					NOR = { 
						has_planet_flag = ex_spaceport_1
						has_planet_flag = ex_spaceport_2
						has_planet_flag = ex_spaceport_3
						has_planet_flag = ex_spaceport_4
						has_planet_flag = ex_spaceport_5 
						has_planet_flag = ex_spaceport_6 
						has_planet_flag = ex_spaceport_7 
						has_planet_flag = ex_spaceport_8 
						has_planet_flag = ex_spaceport_9
					}
				}
				set_planet_flag = ex_spaceport_1	
				update_spaceport_modifiers = yes				
			}			
		}	
	}
}	

#the events below are spaceport development automation events.

planet_event = { #this event checks the spaceport type, compares to the edict and replaces the spaceport itself as needed. 
	id = ex_spaceport_events.100
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = { 
			limit = { 
				sector_controlled = yes
				owner = { has_policy_flag = sector_automation }
			}
			if = { #### economic spaceports
				limit = {
					owner = {
						OR = {
							has_policy_flag = sector_specialized_economic_module_construction
							has_policy_flag = sector_mixed_economic_emphasis_module_construction
						}
					}
				}	
				if = {
					limit = { 
						has_economic_spaceport = yes					
						owner = { has_policy_flag = sector_specialized_economic_module_construction }
					}				
					scrap_stardock_modules = yes
					scrap_defensive_modules = yes
					flag_modules = yes
					check_module_flags = yes
					flag_module_slots = yes
					construct_module = yes
					break = yes						
				}	
				if = {
					limit = { 
						has_economic_spaceport = yes					
						owner = { has_policy_flag = sector_mixed_economic_emphasis_module_construction }
					}				
					scrap_stardock_modules = yes					
					flag_modules = yes
					check_module_flags = yes
					flag_module_slots = yes
					construct_module = yes
					break = yes						
				}
				if = {
					limit = { 
						has_economic_spaceport = no					
						owner = { has_policy_flag = sector_specialized_economic_module_construction }
					}
					check_base_weapon = yes
					scrap_stardock_modules = yes
					scrap_defensive_modules = yes
					spaceport = { dismantle = yes }
					clear_slot_flag = yes
					rebuild_spaceport_economic = yes
					rebuild_economic_modules = yes
					flag_module_slots = yes					
					flag_modules = yes
					check_module_flags = yes				
					construct_module = yes
					break = yes		
				}	
				if = {
					limit = { 
						has_economic_spaceport = no					
						owner = { has_policy_flag = sector_mixed_economic_emphasis_module_construction }
					}
					check_base_weapon = yes
					scrap_stardock_modules = yes					
					spaceport = { dismantle = yes }
					clear_slot_flag = yes
					rebuild_spaceport_economic = yes
					rebuild_economic_modules = yes
					rebuild_defensive_modules = yes
					flag_module_slots = yes					
					flag_modules = yes
					check_module_flags = yes				
					construct_module = yes
					break = yes		
				}					
			}
			if = { #### defensive spaceports
				limit = {
					owner = {
						OR = {
							has_policy_flag = sector_specialized_defensive_module_construction
							has_policy_flag = sector_mixed_defensive_emphasis_module_construction
						}
					}
				}	
				if = {
					limit = { 
						has_defensive_spaceport = yes					
						owner = { has_policy_flag = sector_specialized_defensive_module_construction }
					}				
					scrap_stardock_modules = yes
					scrap_economic_modules = yes
					flag_modules = yes
					check_module_flags = yes
					flag_module_slots = yes
					construct_module = yes
					break = yes						
				}	
				if = {
					limit = { 
						has_defensive_spaceport = yes					
						owner = { has_policy_flag = sector_mixed_defensive_emphasis_module_construction }
					}				
					scrap_stardock_modules = yes					
					flag_modules = yes
					check_module_flags = yes
					flag_module_slots = yes
					construct_module = yes
					break = yes						
				}
				if = {
					limit = { 
						has_defensive_spaceport = no					
						owner = { has_policy_flag = sector_specialized_defensive_module_construction }
					}
					check_base_weapon = yes
					scrap_stardock_modules = yes
					scrap_economic_modules = yes
					spaceport = { dismantle = yes }
					clear_slot_flag = yes
					rebuild_spaceport_defensive = yes
					rebuild_defensive_modules = yes
					flag_module_slots = yes					
					flag_modules = yes
					check_module_flags = yes				
					construct_module = yes
					break = yes		
				}	
				if = {
					limit = { 
						has_defensive_spaceport = no					
						owner = { has_policy_flag = sector_mixed_defensive_emphasis_module_construction }
					}
					check_base_weapon = yes
					scrap_stardock_modules = yes					
					spaceport = { dismantle = yes }
					clear_slot_flag = yes
					rebuild_spaceport_defensive = yes
					rebuild_economic_modules = yes
					rebuild_defensive_modules = yes
					flag_module_slots = yes					
					flag_modules = yes
					check_module_flags = yes				
					construct_module = yes
					break = yes		
				}					
			}			
		}	
		if = { 
			limit = { 
				sector_controlled = no
				owner = { 
					OR = {
						has_policy_flag = core_automation
						has_policy_flag = core_edicts
					}
				}	
			}
			if = { #### economic spaceports
				limit = {
					OR = {
						owner = {
							OR = {
								has_policy_flag = core_specialized_economic_module_construction
								has_policy_flag = core_mixed_economic_emphasis_module_construction
							}
						}	
						OR = {
							has_planet_flag = spaceport_automation_economic_specialized	
							has_planet_flag = spaceport_automation_economic_mixed
						}	
					}
				}	
				if = {
					limit = { 
						has_economic_spaceport = yes					
						OR = {
							owner = { has_policy_flag = core_specialized_economic_module_construction }
							has_planet_flag = spaceport_automation_economic_specialized
						}	
					}				
					scrap_stardock_modules = yes
					scrap_defensive_modules = yes
					flag_modules = yes
					check_module_flags = yes
					flag_module_slots = yes
					construct_module = yes
					break = yes						
				}	
				if = {
					limit = { 
						has_economic_spaceport = yes					
						OR = {
							owner = { has_policy_flag = core_mixed_economic_emphasis_module_construction }
							has_planet_flag = spaceport_automation_economic_mixed
						}	
					}				
					scrap_stardock_modules = yes					
					flag_modules = yes
					check_module_flags = yes
					flag_module_slots = yes
					construct_module = yes
					break = yes						
				}
				if = {
					limit = { 
						has_economic_spaceport = no					
						OR = {
							owner = { has_policy_flag = core_specialized_economic_module_construction }
							has_planet_flag = spaceport_automation_economic_specialized
						}	
					}
					check_base_weapon = yes
					scrap_stardock_modules = yes
					scrap_defensive_modules = yes
					spaceport = { dismantle = yes }
					clear_slot_flag = yes
					rebuild_spaceport_economic = yes
					rebuild_economic_modules = yes
					flag_module_slots = yes					
					flag_modules = yes
					check_module_flags = yes				
					construct_module = yes
					break = yes		
				}	
				if = {
					limit = { 
						has_economic_spaceport = no					
						OR = {
							owner = { has_policy_flag = core_mixed_economic_emphasis_module_construction }
							has_planet_flag = spaceport_automation_economic_mixed
						}	
					}
					check_base_weapon = yes
					scrap_stardock_modules = yes					
					spaceport = { dismantle = yes }
					clear_slot_flag = yes
					rebuild_spaceport_economic = yes
					rebuild_economic_modules = yes
					rebuild_defensive_modules = yes
					flag_module_slots = yes					
					flag_modules = yes
					check_module_flags = yes				
					construct_module = yes
					break = yes		
				}					
			}
			if = { #### defensive spaceports
				limit = {
					OR = {
						owner = {
							OR = {
								has_policy_flag = core_specialized_defensive_module_construction
								has_policy_flag = core_mixed_defensive_emphasis_module_construction
							}
						}	
						OR = {
							has_planet_flag = spaceport_automation_defensive_specialized	
							has_planet_flag = spaceport_automation_defensive_mixed
						}	
					}
				}	
				if = {
					limit = { 
						has_defensive_spaceport = yes					
						OR = {
							owner = { has_policy_flag = core_specialized_defensive_module_construction }
							has_planet_flag = spaceport_automation_defensive_specialized
						}	
					}				
					scrap_stardock_modules = yes
					scrap_economic_modules = yes
					flag_modules = yes
					check_module_flags = yes
					flag_module_slots = yes
					construct_module = yes
					break = yes						
				}	
				if = {
					limit = { 
						has_defensive_spaceport = yes					
						OR = {
							owner = { has_policy_flag = core_mixed_defensive_emphasis_module_construction }
							has_planet_flag = spaceport_automation_defensive_mixed
						}	
					}				
					scrap_stardock_modules = yes					
					flag_modules = yes
					check_module_flags = yes
					flag_module_slots = yes
					construct_module = yes
					break = yes						
				}
				if = {
					limit = { 
						has_defensive_spaceport = no					
						OR = {
							owner = { has_policy_flag = core_specialized_defensive_module_construction }
							has_planet_flag = spaceport_automation_defensive_specialized
						}	
					}
					check_base_weapon = yes
					scrap_stardock_modules = yes
					scrap_economic_modules = yes
					spaceport = { dismantle = yes }
					clear_slot_flag = yes
					rebuild_spaceport_defensive = yes
					rebuild_defensive_modules = yes
					flag_module_slots = yes					
					flag_modules = yes
					check_module_flags = yes				
					construct_module = yes
					break = yes		
				}	
				if = {
					limit = { 
						has_defensive_spaceport = no					
						OR = {
							owner = { has_policy_flag = core_mixed_defensive_emphasis_module_construction }
							has_planet_flag = spaceport_automation_defensive_mixed
						}	
					}
					check_base_weapon = yes
					scrap_stardock_modules = yes					
					spaceport = { dismantle = yes }
					clear_slot_flag = yes
					rebuild_spaceport_defensive = yes
					rebuild_economic_modules = yes
					rebuild_defensive_modules = yes
					flag_module_slots = yes					
					flag_modules = yes
					check_module_flags = yes				
					construct_module = yes
					break = yes		
				}					
			}								
			if = { #### stardock spaceports
				limit = {
					OR = {
						owner = {
							has_policy_flag = core_specialized_stardock_module_construction
						}	
						has_planet_flag = spaceport_automation_stardock_specialized	
					}
				}	
				if = {
					limit = { 
						has_stardock_spaceport = yes					
					}				
					scrap_defensive_modules = yes
					scrap_economic_modules = yes
					flag_modules = yes
					check_module_flags = yes
					flag_module_slots = yes
					construct_module = yes
					break = yes						
				}	
				if = {
					limit = { 
						has_stardock_spaceport = no					
					}
					check_base_weapon = yes
					scrap_defensive_modules = yes
					scrap_economic_modules = yes
					spaceport = { dismantle = yes }
					clear_slot_flag = yes
					rebuild_spaceport_stardock = yes
					rebuild_stardock_modules = yes
					flag_module_slots = yes					
					flag_modules = yes
					check_module_flags = yes				
					construct_module = yes
					break = yes		
				}	
			}					
		}				
	}
}

planet_event = { #this event is WIP HERE
	id = ex_spaceport_events.101
	hide_window = yes
	is_triggered_only = yes
	
	immediate = { 
		if = {
			limit = { sector_controlled = yes }
			if = { 
				limit = { owner = { has_policy_flag = sector_specialized_economic_module_construction } }
				roll_economic_module = yes
				if = {
					limit = { has_free_spaceport_module_slot = yes }
					clear_slot_flag = yes
					flag_module_slots = yes
					if = {
						limit = {
							NOR = {
								has_planet_flag = spaceport_automation_disable_local			
								owner = { has_policy_flag = spaceport_automation_disabled }
							}
						}	
						planet_event = { id = ex_spaceport_events.100 }
						else = { break = yes }		
					}	
					break = yes
					else = { break = yes }	
				}
			}	
			if = { 
				limit = { owner = { has_policy_flag = sector_mixed_economic_emphasis_module_construction } }
				random_list = {
					75 = { roll_economic_module = yes }
					25 = { roll_defensive_module = yes }
				}	
				if = {
					limit = { has_free_spaceport_module_slot = yes }
					clear_slot_flag = yes
					flag_module_slots = yes
					if = {
						limit = {
							NOR = {
								has_planet_flag = spaceport_automation_disable_local			
								owner = { has_policy_flag = spaceport_automation_disabled }
							}
						}	
						planet_event = { id = ex_spaceport_events.100 }
						else = { break = yes }		
					}	
					break = yes
					else = { break = yes }	
				}
			}	
			if = { 
				limit = { owner = { has_policy_flag = sector_specialized_defensive_module_construction } }
				roll_defensive_module = yes
				if = {
					limit = { has_free_spaceport_module_slot = yes }
					clear_slot_flag = yes
					flag_module_slots = yes
					if = {
						limit = {
							NOR = {
								has_planet_flag = spaceport_automation_disable_local			
								owner = { has_policy_flag = spaceport_automation_disabled }
							}
						}	
						planet_event = { id = ex_spaceport_events.100 }
						else = { break = yes }		
					}	
					break = yes
					else = { break = yes }	
				}
			}
			if = { 
				limit = { owner = { has_policy_flag = sector_mixed_defensive_emphasis_module_construction } }
				random_list = {
					25 = { roll_economic_module = yes }
					75 = { roll_defensive_module = yes }
				}	
				if = {
					limit = { has_free_spaceport_module_slot = yes }
					clear_slot_flag = yes
					flag_module_slots = yes
					if = {
						limit = {
							NOR = {
								has_planet_flag = spaceport_automation_disable_local			
								owner = { has_policy_flag = spaceport_automation_disabled }
							}
						}	
						planet_event = { id = ex_spaceport_events.100 }
						else = { break = yes }		
					}	
					break = yes
					else = { break = yes }	
				}
			}			
		}
		if = {
			limit = { sector_controlled = no }
			if = { 
				limit = { 
					OR = {
						owner = { has_policy_flag = core_specialized_economic_module_construction }
						has_planet_flag = spaceport_automation_economic_specialized
					}	
				}
				roll_economic_module = yes
				if = {
					limit = { has_free_spaceport_module_slot = yes }
					clear_slot_flag = yes
					flag_module_slots = yes
					if = {
						limit = {
							NOR = {
								has_planet_flag = spaceport_automation_disable_local			
								owner = { has_policy_flag = spaceport_automation_disabled }
							}
						}	
						planet_event = { id = ex_spaceport_events.100 }
						else = { break = yes }		
					}	
					break = yes
					else = { break = yes }	
				}
			}	
			if = { 
				limit = { 
					OR = {
						owner = { has_policy_flag = core_mixed_economic_emphasis_module_construction }
						has_planet_flag = spaceport_automation_economic_mixed
					}	
				}
				random_list = {
					75 = { roll_economic_module = yes }
					25 = { roll_defensive_module = yes }
				}	
				if = {
					limit = { has_free_spaceport_module_slot = yes }
					clear_slot_flag = yes
					flag_module_slots = yes
					if = {
						limit = {
							NOR = {
								has_planet_flag = spaceport_automation_disable_local			
								owner = { has_policy_flag = spaceport_automation_disabled }
							}
						}	
						planet_event = { id = ex_spaceport_events.100 }
						else = { break = yes }		
					}	
					break = yes
					else = { break = yes }	
				}
			}	
			if = { 
				limit = { 
					OR = {
						owner = { has_policy_flag = core_specialized_defensive_module_construction }
						has_planet_flag = spaceport_automation_defensive_specialized
					}	
				}
				roll_defensive_module = yes
				if = {
					limit = { has_free_spaceport_module_slot = yes }
					clear_slot_flag = yes
					flag_module_slots = yes
					if = {
						limit = {
							NOR = {
								has_planet_flag = spaceport_automation_disable_local			
								owner = { has_policy_flag = spaceport_automation_disabled }
							}
						}	
						planet_event = { id = ex_spaceport_events.100 }
						else = { break = yes }		
					}	
					break = yes
					else = { break = yes }	
				}
			}
			if = { 
				limit = { 
					OR = {
						owner = { has_policy_flag = core_mixed_defensive_emphasis_module_construction }
						has_planet_flag = spaceport_automation_defensive_mixed
					}	
				}
				random_list = {
					25 = { roll_economic_module = yes }
					75 = { roll_defensive_module = yes }
				}	
				if = {
					limit = { has_free_spaceport_module_slot = yes }
					clear_slot_flag = yes
					flag_module_slots = yes
					if = {
						limit = {
							NOR = {
								has_planet_flag = spaceport_automation_disable_local			
								owner = { has_policy_flag = spaceport_automation_disabled }
							}
						}	
						planet_event = { id = ex_spaceport_events.100 }
						else = { break = yes }		
					}	
					break = yes
					else = { break = yes }	
				}
			}
			if = { 
				limit = { 
					OR = {
						owner = { has_policy_flag = core_specialized_stardock_module_construction }
						has_planet_flag = spaceport_automation_stardock_specialized
					}	
				}
				roll_stardock_module = yes
				if = {
					limit = { has_free_spaceport_module_slot = yes }
					clear_slot_flag = yes
					flag_module_slots = yes
					if = {
						limit = {
							NOR = {
								has_planet_flag = spaceport_automation_disable_local			
								owner = { has_policy_flag = spaceport_automation_disabled }
							}
						}	
						planet_event = { id = ex_spaceport_events.100 }
						else = { break = yes }		
					}	
					break = yes
					else = { break = yes }	
				}
			}
		}	
	}
}