namespace = cgm_planets_enhanced_spawn_engine

country_event = { 
	id = cgm_planets_enhanced_spawn_engine.0
	hide_window = yes
	fire_only_once = yes
	trigger = { 
		NOT = { has_global_flag = planets_enhanced_active }
		is_ai = no
	}
	immediate = { 
		set_global_flag = planets_enhanced_active
		if = { 
			limit = { NOT = { has_country_flag = cgm_game_host } }
			set_country_flag = cgm_game_host	
		}	
		every_megastructure = {
			limit = { 
				OR = {
					is_megastructure_type = dyson_sphere_ruined
					is_megastructure_type = think_tank_ruined
					is_megastructure_type = spy_orb_ruined
					is_megastructure_type = gateway_ruined
				}
				exists = orbit				
			}
			orbit.planet = { set_planet_flag = has_ruined_megastructure } 
		}
		every_planet = {
			if = { 
				limit = { is_star = yes }		
				if = { 
					limit = { solar_system = { NOT = { any_planet = { NOT = { is_same_value = root } has_planet_flag = system_star_1 } } } }
					set_planet_flag = system_star_1				
					else = {
						if = { 
							limit = { solar_system = { NOT = { any_planet = { NOT = { is_same_value = root } has_planet_flag = system_star_2 } } } }
							set_planet_flag = system_star_2						
							else = {
								if = { 
									limit = { solar_system = { NOT = { any_planet = { NOT = { is_same_value = root } has_planet_flag = system_star_3 } } } }
									set_planet_flag = system_star_3						
								}
							}
						}
					}				
				}	
			}			
			if = {
				limit = { 
					is_gas_giant = yes
					has_moon = yes
					any_moon = { NOT = { has_planet_flag = gas_giant_moon } }
				}				
				every_moon = { 
					limit = { NOT = { has_planet_flag = gas_giant_moon } }
					set_planet_flag = gas_giant_moon
				}	
			}
		}	
		country_event = { id = cgm_planets_enhanced_spawn_engine.1 }	
	}
}	

country_event = { 
	id = cgm_planets_enhanced_spawn_engine.1
	hide_window = yes
	is_triggered_only = yes	
	

		}	
	}	
}