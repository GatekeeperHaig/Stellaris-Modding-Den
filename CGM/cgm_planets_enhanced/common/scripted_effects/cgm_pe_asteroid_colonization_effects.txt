generate_asteroidal_planetoid = {
	if = { 
		limit = { 
			NOT = { 
				is_planet_class = pc_ice_asteroid
			}
		}		
		change_pc = pc_asteroidal_planetoid	
		while = { 
			limit = { planet_size > 8 } 
			change_planet_size = -1
		}	
		while = { 
			limit = { planet_size < 5 } 
			change_planet_size = 1
		}				
		switch = {
			trigger = planet_size
			5 = { set_variable = { which = planet_size_var value = 5 } }
			6 = { set_variable = { which = planet_size_var value = 6 } }
			7 = { set_variable = { which = planet_size_var value = 7 } }
			8 = { set_variable = { which = planet_size_var value = 8 } }
		}	
		set_variable = { which = tb_pc_asteroidal_mineral_ultra_rich_rock value = 0 } 
		set_variable = { which = tb_pc_asteroidal_mineral_rich_rock value = 0 } 
		set_variable = { which = tb_pc_asteroidal_energy_ultra_rich_rock value = 0 } 
		set_variable = { which = tb_pc_asteroidal_energy_rich_rock value = 0 } 
		set_variable = { which = tb_pc_asteroidal_carbometallic_rock value = 0 } 
		every_tile = { 
			random_list = { 
				10 = { 
					set_blocker = tb_pc_asteroidal_mineral_ultra_rich_rock 
					prev = { change_variable = { which = tb_pc_asteroidal_mineral_ultra_rich_rock value = 1 } }
					modifier = { 
						factor = 0
						NOT = { prev = { any_tile = { has_blocker = tb_pc_asteroidal_carbometallic_rock } } }
					}
				}
				10 = { 
					set_blocker = tb_pc_asteroidal_energy_ultra_rich_rock 
					prev = { change_variable = { which = tb_pc_asteroidal_energy_ultra_rich_rock value = 1 } }
					modifier = { 
						factor = 0
						NOT = { prev = { any_tile = { has_blocker = tb_pc_asteroidal_carbometallic_rock } } }
					}					
				}
				20 = { 
					set_blocker = tb_pc_asteroidal_mineral_rich_rock 
					prev = { change_variable = { which = tb_pc_asteroidal_mineral_rich_rock value = 1 } }
					modifier = { 
						factor = 0
						NOT = { prev = { any_tile = { has_blocker = tb_pc_asteroidal_carbometallic_rock } } }
					}					
				}
				20 = { 
					set_blocker = tb_pc_asteroidal_energy_rich_rock 
					prev = { change_variable = { which = tb_pc_asteroidal_energy_rich_rock value = 1 } }
					modifier = { 
						factor = 0
						NOT = { prev = { any_tile = { has_blocker = tb_pc_asteroidal_carbometallic_rock } } }
					}	
				}
				40 = { 
					set_blocker = tb_pc_asteroidal_carbometallic_rock 
					prev = { change_variable = { which = tb_pc_asteroidal_carbometallic_rock value = 1 } }
					modifier = { 
						add = 20
						prev = { 
							OR = { 
								check_variable = { which = tb_pc_asteroidal_mineral_ultra_rich_rock value > 0 } 
								check_variable = { which = tb_pc_asteroidal_mineral_rich_rock value > 0 } 
								check_variable = { which = tb_pc_asteroidal_energy_ultra_rich_rock value = 1 } 
								check_variable = { which = tb_pc_asteroidal_energy_rich_rock value = 1 } 
								check_variable = { which = tb_pc_asteroidal_carbometallic_rock value < 2 } 						
							}
						}	
					}	
					modifier = { 
						add = 40
						prev = { 
							OR = { 
								check_variable = { which = tb_pc_asteroidal_mineral_ultra_rich_rock value > 1 } 
								check_variable = { which = tb_pc_asteroidal_mineral_rich_rock value > 1 } 
								check_variable = { which = tb_pc_asteroidal_energy_ultra_rich_rock value > 1 } 
								check_variable = { which = tb_pc_asteroidal_energy_rich_rock value > 1 } 
							}	
						}	
					}
				}					
			}
			random_list = { 
				75 = { cgm_shared_regular_deposit_spawn_table = yes }
				25 = { }
			}
		}
		while = { 
			limit = { NOT = { any_tile = { has_blocker = no } } }
			random_list = {
				90 = { }
				10 = {
					random_tile = { 
						limit = { has_blocker = tb_pc_asteroidal_carbometallic_rock }
						remove_blocker = yes
						prev = { change_variable = { which = tb_pc_asteroidal_carbometallic_rock value = -1 } }
					}
				}
			}
		}	
	}
	else = { 		
		random_list = { 
			95 = { 
				change_pc = pc_ice_asteroidal_planetoid	
				while = { 
					limit = { planet_size > 8 } 
					change_planet_size = -1
				}	
				while = { 
					limit = { planet_size < 5 } 
					change_planet_size = 1
				}				
				switch = {
					trigger = planet_size
					5 = { set_variable = { which = planet_size_var value = 5 } }
					6 = { set_variable = { which = planet_size_var value = 6 } }
					7 = { set_variable = { which = planet_size_var value = 7 } }
					8 = { set_variable = { which = planet_size_var value = 8 } }
				}		
				set_variable = { which = tb_pc_ice_asteroidal_primordial_ice value = 0 } 
				set_variable = { which = tb_pc_ice_asteroidal_frozen_exotic_matter value = 0 } 
				every_tile = { 
					random_list = { 
						70 = { set_blocker = tb_pc_ice_asteroidal_primordial_ice prev = { change_variable = { which = tb_pc_ice_asteroidal_primordial_ice value = 1 }}}
						30 = { 
							set_blocker = tb_pc_ice_asteroidal_frozen_exotic_matter prev = { change_variable = { which = tb_pc_ice_asteroidal_frozen_exotic_matter value = 1 }}
							modifier = { 
								factor = 0
								prev = { NOT = { any_tile = { has_blocker = tb_pc_ice_asteroidal_primordial_ice } } }
							}	
						}
					}	
					random_list = { 
						75 = { cgm_shared_regular_deposit_spawn_table = yes }
						25 = { }
					}					
				}
				while = { 
					limit = { NOT = { any_tile = { has_blocker = no } } }
					random_list = {
						90 = { }
						10 = { 
							random_tile = { 
							limit = { has_blocker = tb_pc_ice_asteroidal_primordial_ice }					
							remove_blocker = yes
							prev = { change_variable = { which = tb_pc_ice_asteroidal_primordial_ice value = -1 } }
						}
					}	
				}					
			}	
			5 = { 
				change_pc = pc_crystal_asteroidal_planetoid	
				random_list = {
					10 = { make_planet_size_20 = yes }		
					10 = { make_planet_size_19 = yes }
					10 = { make_planet_size_18 = yes }
					10 = { make_planet_size_17 = yes }
					10 = { make_planet_size_16 = yes }
					10 = { make_planet_size_15 = yes }
					10 = { make_planet_size_14 = yes }
					10 = { make_planet_size_13 = yes }
					10 = { make_planet_size_12 = yes }
					10 = { make_planet_size_11 = yes }
				}	
				switch = {
					trigger = planet_size
					11 = { set_variable = { which = planet_size_var value = 11 } }
					12 = { set_variable = { which = planet_size_var value = 12 } }
					13 = { set_variable = { which = planet_size_var value = 13 } }
					14 = { set_variable = { which = planet_size_var value = 14 } }
					15 = { set_variable = { which = planet_size_var value = 15 } }
					16 = { set_variable = { which = planet_size_var value = 16 } }
					17 = { set_variable = { which = planet_size_var value = 17 } }
					18 = { set_variable = { which = planet_size_var value = 18 } }
					19 = { set_variable = { which = planet_size_var value = 19 } }
					20 = { set_variable = { which = planet_size_var value = 20 } }
				}			
				set_variable = { which = tb_pc_crystal_asteroidal_crystal_formation value = 0 } 
				set_variable = { which = tb_pc_crystal_asteroidal_dimensional_phenomena value = 0 } 
				every_tile = { 
					random_list = { 
						75 = { set_blocker = tb_pc_crystal_asteroidal_crystal_formation prev = { change_variable = { which = tb_pc_crystal_asteroidal_crystal_formation value = 1 }}}						
						25 = { set_blocker = tb_pc_crystal_asteroidal_dimensional_phenomena prev = { change_variable = { which = tb_pc_ice_asteroidal_frozen_exotic_matter value = 1 }}}
					}	
					random_list = { 
						75 = { cgm_shared_regular_deposit_spawn_table = yes }
						25 = { }
					}
				}
				while = { 
					limit = { NOT = { any_tile = { has_blocker = no } } }
					random_list = {
						90 = { }	
						10 = {	
							random_tile = { 
							limit = { has_blocker = tb_pc_crystal_asteroidal_crystal_formation }					
							remove_blocker = yes
							prev = { change_variable = { which = tb_pc_crystal_asteroidal_crystal_formation value = -1 } }
						}					
					}
				}	
			}	
		}			
	}	
}	

prescripted_asteroid_size_readjustment = {
	if = {
		limit = { is_planet_class = pc_dwarf_planet_asteroid }
		random_list = {
			50 = { set_planet_size = 8 }
			50 = { set_planet_size = 7 }
		}
		
	}
	else_if = {
		limit = { is_planet_class = pc_large_asteroid_moon }
		random_list = {
			30 = { set_planet_size = 6 }
			70 = { set_planet_size = 5 }
		}	
		
	}
	else_if = {
		limit = { is_planet_class = pc_small_asteroid_moon }
		random_list = {
			50 = { set_planet_size = 4 }
			50 = { set_planet_size = 3 }
		}	
	}
	else_if = {
		limit = { is_planet_class = pc_asteroid }
		random_list = {
			5 = { set_planet_size = 6  }
			10 = { set_planet_size = 5  }
			20 = { set_planet_size = 4 }
			35 = { set_planet_size = 3 }
			30 = { set_planet_size = 2 }
		}	
	}
	else_if = {
		limit = { is_planet_class = pc_ice_asteroid }
		random_list = {
			5 = { set_planet_size = 6  }
			10 = { set_planet_size = 5  }
			20 = { set_planet_size = 4 }
			35 = { set_planet_size = 3 }
			30 = { set_planet_size = 2 }
		}	
	}
	else_if = {
		limit = { is_planet_class = pc_crystal_asteroid }
		random_list = {
			30 = { set_planet_size = 6 }
			70 = { set_planet_size = 5 }
		}	
		
	}
	else_if = {
		limit = { is_planet_class = pc_crystal_asteroid_2 }
		random_list = {
			30 = { set_planet_size = 6 }
			70 = { set_planet_size = 5 }
		}	
		
	}
	else_if = { 
		limit = { is_asteroid = yes is_colonizable = yes is_colony = no } 
		random_list = {
			5 = { 
				set_planet_size = 6 
				random_list = {
					70 = { change_pc = pc_asteroid }
					30 = { change_pc = pc_ice_asteroid }
				}	
				
			}
			10 = { 
				set_planet_size = 5 
				random_list = {
					70 = { change_pc = pc_asteroid }
					30 = { change_pc = pc_ice_asteroid }
				}					
				
			}
			85 = { }				
		}    		
	}	
}