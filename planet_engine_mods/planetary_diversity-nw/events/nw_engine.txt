namespace = nwengine

event = {
	id = nwengine.00
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	immediate = { 
		set_global_flag = planetarydiversity-nw
		every_planet = { 
			if = { 			
				limit = { is_gas_giant = yes has_moon = yes }
				every_moon = { set_planet_flag = gas_giant_moon }
			}
			if = { 			
				limit = { is_asteroid = yes }
				new_worlds_adjust_asteroids_size = yes
			}
			
		}
		every_planet = { 
			if = {
				limit = {
					NOR = { 
						AND = { 
							exists = owner 
							owner = { is_country_type = default }
							OR = { 
								is_capital = yes
								is_homeworld = yes
							}
						}	
						AND = { 
							exists = owner 
							NAND = { 
								owner = { is_country_type = primitive } 
								any_owned_pop = { is_robot_pop = no } 
							}
						}	
						solar_system = {
							OR = {
								any_system_planet = { exists = owner owner = { is_country_type = default } is_capital = yes }
								has_star_flag = cgm_ignored_system
								has_star_flag = sol_system
								has_star_flag = custom_system
								has_star_flag = floating_system
								has_star_flag = pdcrystal_system
								has_star_flag = city_system
								has_star_flag = graveyard_system
								has_star_flag = mushroom_system
								has_star_flag = biolumen_system
								has_star_flag = technoorganic_system
								has_star_flag = archive_system
								has_star_flag = empire_home_system
								has_star_flag = primitive_sol
								has_star_flag = eilistraee_system
								has_star_flag = tulshar_system
								has_star_flag = elven_system
								has_star_flag = lunari_system
								has_star_flag = elven_ring_system
								has_star_flag = AI_hub
								has_star_flag = AI_lair
								has_star_flag = sentinel_system
								has_star_flag = vechtar_zavonia_system
								has_star_flag = toxic_moon_system
								has_star_flag = shattered_world_system
								has_star_flag = hostile_system
								has_star_flag = high_energy_system
								has_star_flag = superflare_system
								has_star_flag = ruined_empire
								has_star_flag = crystal_system
								has_star_flag = sealed_system
								has_star_flag = marauder_system
								has_star_flag = ruined_matter_decompressor_system
								has_star_flag = ruined_strategic_coordination_center_system
								has_star_flag = ruined_interstellar_assembly_system
								has_star_flag = precursor_system
								has_star_flag = hyacinth_system
								
							}
						}
					}						
				}	
				# these events occur one after the other.
				planet_event = { id = nwengine.01 days = 1 }
				planet_event = { id = nwengine.02 days = 1 }				
				planet_event = { id = nwengine.03 days = 2 }
				planet_event = { id = nwengine.04 days = 2 }
			}
		}
	}
}

planet_event = {
	id = nwengine.01 # HABITABLE SPAWNER / SIZE ADJUSTMENT
	hide_window = yes
	is_triggered_only = yes
	#fire_only_once = yes
	
	immediate = {
		if = {
			limit = { 
				NOR = {
					is_capital = yes
					has_planet_flag = fallen_empire_world
					exists = owner
					has_planet_flag = prescripted_ideal
				}
			}
			# Adjusts planet sizes to be more random while at the same time make them look better
			# new_worlds_adjust_inhabitable_planet_size = yes # DISABLED for now
			if = {
				limit = { 
					exists = owner
					owner = { is_country_type = primitive } 
				}
				# Changes primitives to a class more logical to the the planet
				#new_worlds_species_change_table = yes # THIS IS NO LONGER WORKING
				if = { 
					limit = { is_ideal_planet_class = { who = owner status = no } }
					#change_owner_species_to_this_planet_preference = yes			
				}	
			}
		}
	}
}

planet_event = {
	id = nwengine.02 # UNINHABITABLE SPAWNER / SIZE ADJUSTMENT
	hide_window = yes
	is_triggered_only = yes
	#fire_only_once = yes
	
	immediate = {
			if = { 
				limit = { uninhabitable_planet = yes }					
				new_worlds_adjust_uninhabitable_planet_size = yes
				new_worlds_adjust_gas_giant_planet_size = yes
				uninhabitable_planets_spawn_table = yes
				reroll_modifier = yes
			}
			if = { 
				limit = { is_gas_giant = yes }		
				gas_giant_tweak_spawn_table = yes
			}
			planet_event = { id = nwengine.05 days = 3 }
			planet_event = { id = nwengine.06 days = 3 }
			planet_event = { id = nwengine.07 days = 3 }
	}
}

planet_event = {
	id = nwengine.03 # ORBITAL RESOURCE SPAWNER
	hide_window = yes
	is_triggered_only = yes
	#fire_only_once = yes
	
	immediate = {
			if = { 
				limit = {
					AND = {
						OR = {
							uninhabitable_planet = yes
							is_star = yes
						}
						NOR = {
							has_deposit = d_trade_value_1
							has_deposit = d_trade_value_2
							has_deposit = d_trade_value_3
							has_deposit = d_trade_value_4
							has_deposit = d_trade_value_5
							has_deposit = d_trade_value_6
							has_deposit = d_trade_value_7
							has_deposit = d_trade_value_8
							has_deposit = d_trade_value_9
							has_deposit = d_trade_value_10
							has_deposit = d_engineering_6
							has_deposit = d_engineering_7
							has_deposit = d_engineering_8
							has_deposit = d_engineering_9
							has_deposit = d_engineering_10
							has_deposit = d_physics_6
							has_deposit = d_physics_7
							has_deposit = d_physics_8
							has_deposit = d_physics_9
							has_deposit = d_physics_10
							has_deposit = d_society_6
							has_deposit = d_society_7
							has_deposit = d_society_8
							has_deposit = d_society_9
							has_deposit = d_society_10
							has_deposit = d_energy_6
							has_deposit = d_energy_7
							has_deposit = d_energy_8
							has_deposit = d_energy_9
							has_deposit = d_energy_10
							has_deposit = d_minerals_6
							has_deposit = d_minerals_7
							has_deposit = d_minerals_8
							has_deposit = d_minerals_9
							has_deposit = d_minerals_10
							has_deposit = d_alloys_3
							has_deposit = d_alloys_4
							has_deposit = d_alloys_5
							has_deposit = d_vast_unity_deposit
							has_deposit = d_nanites_deposit
							has_deposit = d_guardian_dragon_hoard
						}
					}
				}
				clear_deposits = yes
				nw_orbital_resource_spawn_table = yes
			}
	}
}

event = {
		id = nwengine.04 # SPAWN GPM modifiers on Sol planets
		hide_window = yes
		is_triggered_only = yes
		fire_only_once = yes
		immediate = {
			# VENUS
			every_planet = {
				limit = { 
					has_global_flag = has_guillis_planet_modifiers_mod
					solar_system = { has_star_flag = sol }
					is_planet_class = pc_hot_reducing
				}
				add_modifier = {
					modifier = "Dense_Atmospheres"
					days = -1
				}
			}
			# MARS
			every_planet = {
				limit = { 
					has_global_flag = has_guillis_planet_modifiers_mod
					solar_system = { has_star_flag = sol }
					is_planet_class = pc_desolate
				}
				add_modifier = {
					modifier = "weak_magnetic_field_2"
					days = -1
				}
				add_modifier = {
					modifier = "Water_Pockets"
					days = -1
				}
			}
			# EUROPA
			every_planet = {
				limit = { 
					has_global_flag = has_guillis_planet_modifiers_mod
					solar_system = { has_star_flag = sol }
					is_planet_class = pc_frozen
					has_planet_flag = sol_europa
				}
				add_modifier = {
					modifier = "Cryogeysers"
					days = -1
				}
				add_modifier = {
					modifier = "Deep_Aquifer"
					days = -1
				}
			}
			# LUNA
			every_planet = {
				limit = { 
					has_global_flag = has_guillis_planet_modifiers_mod
					solar_system = { has_star_flag = sol }
					is_planet_class = pc_underground_rocky
				}
				
			}
		}
}

planet_event = {
	id = nwengine.05 # SPAWN TERRAFORMING CANDIDATE MODIFIER
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	#Terraforming Candidate
	immediate = {
		every_planet = { 
			limit = {  
				OR = {
					is_planet_class = pc_barren
					is_planet_class = pc_hot_reducing
					is_planet_class = pc_cold_reducing
				}
				not = { has_modifier = terraforming_candidate }	
				planet_size > 9
				planet_size < 26	
				solar_system = {
					NOR = {
						is_star_class = sc_black_hole
						is_star_class = sc_neutron_star
						is_star_class = sc_pulsar
					}
				}
			}	
			random_list = {
				6 = {
					modifier = { factor = 1.50 has_moon = yes }
					modifier = { factor = 1.25 is_gas_giant_moon = yes }
					modifier = { factor = 0.50 is_moon = yes NOT = { is_gas_giant_moon = yes } }
					modifier = { factor = 0.25 orbits_hot_star = yes }
					add_modifier = { modifier = terraforming_candidate days = -1 }
				}
				94 = { }	
			}
		}
	}
	#Defrost Candidate
	immediate = {
		every_planet = { 
			limit = {  
				AND = {
					is_planet_class = pc_frozen
					NOT = { orbits_cold_star = yes }
				}
				not = { has_modifier = defrost_candidate }	
				planet_size > 9
				planet_size < 26	
				solar_system = {
					NOR = {
						is_star_class = sc_black_hole
						is_star_class = sc_neutron_star
						is_star_class = sc_pulsar
					}
				}
			}	
			random_list = {
				5 = {
					modifier = { factor = 1.25 has_moon = yes }
					modifier = { factor = 2.00 is_gas_giant_moon = yes }
					modifier = { factor = 1.00 is_moon = yes NOT = { is_gas_giant_moon = yes } }
					modifier = { factor = 0.75 orbits_hot_star = yes }
					add_modifier = { modifier = defrost_candidate days = -1 }
				}
				95 = { }	
			}
		}
	}
	#Detox Candidate
	immediate = {
		every_planet = { 
			limit = {  
				AND = {
					is_planet_class = pc_toxic
					NOT = { orbits_cold_star = yes }
				}
				not = { has_modifier = detox_candidate }	
				planet_size > 9
				planet_size < 26	
				solar_system = {
					NOR = {
						is_star_class = sc_black_hole
						is_star_class = sc_neutron_star
						is_star_class = sc_pulsar
					}
				}
			}	
			random_list = {
				5 = {
					modifier = { factor = 1.25 has_moon = yes }
					modifier = { factor = 2.00 is_gas_giant_moon = yes }
					modifier = { factor = 1.00 is_moon = yes NOT = { is_gas_giant_moon = yes } }
					modifier = { factor = 0.75 orbits_hot_star = yes }
					add_modifier = { modifier = detox_candidate days = -1 }
				}
				95 = { }	
			}
		}
	}
}

planet_event = {
	id = nwengine.06 # SPAWN ROCKY SUBTERRANEAN CANDIDATE MODIFIER
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	#Rocky Subterranean Candidate
	immediate = {
		every_planet = { 
			limit = {  
				is_planet_class = pc_barren_cold
				not = { has_modifier = subterranean_rocky_candidate }	
				planet_size > 6
				planet_size < 16	
			}	
			random_list = {
				7 = {
					modifier = { factor = 1.50 is_moon = yes NOT = { is_gas_giant_moon = yes } }
					modifier = { factor = 0.50 is_gas_giant_moon = yes }
					modifier = {
						factor = 0.25 solar_system = { any_system_planet = { habitable_planet = yes } }
					}
					add_modifier = { modifier = subterranean_rocky_candidate days = -1 }
				}
				93 = { }	
			}
		}
	}
}

planet_event = {
	id = nwengine.07 # SPAWN ICY SUBTERRANEAN CANDIDATE MODIFIER
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	#Icy Subterranean Candidate
	immediate = {
		every_planet = { 
			limit = {  
				is_planet_class = pc_frozen
				not = { has_modifier = subterranean_icy_candidate }	
				planet_size > 6
				planet_size < 16	
			}	
			random_list = {
				7 = {
					modifier = { factor = 2 is_gas_giant_moon = yes }
					modifier = {
						factor = 0.25 solar_system = { any_system_planet = { habitable_planet = yes } }
					}
					add_modifier = { modifier = subterranean_icy_candidate days = -1 }
				}
				97 = { }	
			}
		}
	}
}

country_event = {
    id = nwengine.09
	title = nwengine.09.name
	desc = nwengine.09.desc
	picture = GFX_evt_drilling_for_gas
	show_sound = event_default
	location = root

	is_triggered_only = yes

	trigger = {
		owner = { is_ai = no }
		solar_system = { has_star_flag = sol_system }
	}

	option = {
		name = nwengine.09.a
        every_planet = {
            if = {
                limit = {
                    solar_system = { has_star_flag = sol }
                    is_planet_class = pc_hot_reducing       
                    NOT = { has_planet_flag = "pdvenusnoterraform" }
				}
                set_planet_flag = "pdvenusnoterraform"
            }
		}
		every_planet = {
            if = {
                limit = {
                    solar_system = { has_star_flag = sol }
                    is_planet_class = pc_cold_reducing       
                    NOT = { has_planet_flag = "pdtitannoterraform" }
				}
                set_planet_flag = "pdtitannoterraform"
            }
		}
	}

	option = {
		name = nwengine.09.b
        every_planet = {
            if = {
                limit = {
                    solar_system = { has_star_flag = sol }
                    is_planet_class = pc_hot_reducing       
                    NOT = { has_planet_flag = "pdvenus" }
				}
                add_modifier = { modifier = "terraforming_candidate" days = -1 }
                set_planet_flag = "pdvenus"
            }
		}
		every_planet = {
            if = {
                limit = {
                    solar_system = { has_star_flag = sol }
                    is_planet_class = pc_cold_reducing       
                    NOT = { has_planet_flag = "pdtitannoterraform" }
				}
                set_planet_flag = "pdtitannoterraform"
            }
		}
	}
	
	option = {
		name = nwengine.09.c
		every_planet = {
            if = {
                limit = {
                    solar_system = { has_star_flag = sol }
                    is_planet_class = pc_hot_reducing       
                    NOT = { has_planet_flag = "pdvenusnoterraform" }
				}
                set_planet_flag = "pdvenusnoterraform"
            }
		}
        every_planet = {
            if = {
                limit = {
                    solar_system = { has_star_flag = sol }
                    is_planet_class = pc_cold_reducing
                    NOT = { has_planet_flag = "pdtitan" }
				}
                add_modifier = { modifier = "terraforming_candidate" days = -1 }
                set_planet_flag = "pdtitan"
            }
		}
	}

	option = {
		name = nwengine.09.d
		every_planet = {
			if = {
				limit = {
					solar_system = { has_star_flag = sol }
					is_planet_class = pc_cold_reducing
					NOT = { has_planet_flag = "pdtitan" }
				}
				add_modifier = { modifier = "terraforming_candidate" days = -1 }
				set_planet_flag = "pdtitan"
	      	}
		}
	    every_planet = {
            if = {
                limit = {
					solar_system = { has_star_flag = sol }
                    is_planet_class = pc_hot_reducing
                    NOT = { has_planet_flag = "pdvenus" }
				}
                add_modifier = { modifier = "terraforming_candidate" days = -1 }
                set_planet_flag = "pdvenus"
			}
		}	
	}		
}