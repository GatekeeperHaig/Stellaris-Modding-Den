### Effects in this file are ran on pop scope.

calculate_average_pop_multipliers = {
	while = {
		limit = { 
			any_owned_pop = { 
				is_growing = no
				OR = {
					is_being_purged = no
					has_purge_type = { type = purge_displacement }
				}
				OR = {
					is_sapient = yes
					is_robot_pop = yes
				}	
				NOT = { has_pop_flag = pop_checked }
			}
		}	
		random_owned_pop = {
			limit = {
				is_growing = no
				OR = {
					is_being_purged = no
					has_purge_type = { type = purge_displacement }
				}
				OR = {
					is_sapient = yes
					is_robot_pop = yes
				}	
				NOT = { has_pop_flag = pop_checked }
			}
			check_pop_traits = yes
			check_pop_species_rights = yes
			set_pop_flag = pop_checked 
		}
	}	
	### get the average planet pop multiplier by dividing the multiplier variables with the number of pop variable.
	divide_variable = { which = energy_mult_planet_pop value = pop_num }
	divide_variable = { which = minerals_mult_planet_pop value = pop_num }
	divide_variable = { which = food_mult_planet_pop value = pop_num }
	divide_variable = { which = unity_mult_planet_pop value = pop_num }
	divide_variable = { which = society_research_mult_planet_pop value = pop_num }
	divide_variable = { which = physics_research_mult_planet_pop value = pop_num }
	divide_variable = { which = engineering_research_mult_planet_pop value = pop_num }			
}

check_pop_traits = {
	if = { 
		limit = { is_robot_pop = no }
		if = { 
			limit = { has_trait = "trait_nerve_stapled" }
			prev = {
				change_variable = { which = energy_mult_planet_pop value = -0.5 }
				change_variable = { which = minerals_mult_planet_pop value = 0.1 }
				change_variable = { which = food_mult_planet_pop value = 0.1 }
				change_variable = { which = unity_mult_planet_pop value = -0.5 }
				change_variable = { which = society_research_mult_planet_pop value = -0.25 }
				change_variable = { which = physics_research_mult_planet_pop value = -0.25 }
				change_variable = { which = engineering_research_mult_planet_pop value = -0.25 }
			}	
		}
		if = { 
			limit = { has_trait = "trait_presapient_proles" }
			prev = {
				change_variable = { which = energy_mult_planet_pop value = -0.5 }
				change_variable = { which = minerals_mult_planet_pop value = 0.1 }
				change_variable = { which = food_mult_planet_pop value = 0.1 }     
				change_variable = { which = society_research_mult_planet_pop value = -0.75 }
				change_variable = { which = physics_research_mult_planet_pop value = -0.75 }
				change_variable = { which = engineering_research_mult_planet_pop value = -0.75 }
			}	
		}   
		if = { 
			limit = { has_trait = "trait_syncretic_proles" }
			prev = {
				change_variable = { which = minerals_mult_planet_pop value = 0.1 }
				change_variable = { which = food_mult_planet_pop value = 0.1 }     
				change_variable = { which = society_research_mult_planet_pop value = -0.85 }
				change_variable = { which = physics_research_mult_planet_pop value = -0.85 }
				change_variable = { which = engineering_research_mult_planet_pop value = -0.85 }
			}	
		}     
		if = { 
			limit = { has_trait = "trait_agrarian" }
			prev = { change_variable = { which = food_mult_planet_pop value = 0.15 } }
		} 
		if = { 
			limit = { has_trait = "trait_thrifty" }
			prev = { change_variable = { which = energy_mult_planet_pop value = 0.15 } }
		}       
		if = { 
			limit = { has_trait = "trait_industrious" }
			prev = { change_variable = { which = minerals_mult_planet_pop value = 0.15 } }
		}     
		if = { 
			limit = { has_trait = "trait_intelligent" }
			prev = {
				change_variable = { which = society_research_mult_planet_pop value = 0.1 }
				change_variable = { which = physics_research_mult_planet_pop value = 0.1 }
				change_variable = { which = engineering_research_mult_planet_pop value = 0.1 }
			}	
		}     
		if = { 
			limit = { has_trait = "trait_natural_engineers" }
			prev = { change_variable = { which = engineering_research_mult_planet_pop value = 0.15 } }
		}           
		if = { 
			limit = { has_trait = "trait_natural_physicists" }
			prev = { change_variable = { which = physics_research_mult_planet_pop value = 0.15 } }
		}           
		if = { 
			limit = { has_trait = "trait_natural_sociologists" }
			prev = { change_variable = { which = society_research_mult_planet_pop value = 0.15 } }
		}     
		if = { 
			limit = { has_trait = "trait_very_strong" }
			prev = { change_variable = { which = minerals_mult_planet_pop value = 0.1 } }
		}           
		if = { 
			limit = { has_trait = "trait_strong" }
			prev = { change_variable = { which = minerals_mult_planet_pop value = 0.05 } }
		}                 
		if = { 
			limit = { has_trait = "trait_weak" }
			prev = { change_variable = { which = minerals_mult_planet_pop value = -0.95 } }
		} 
		if = { 
			limit = { has_trait = "trait_erudite" }
			prev = {
				change_variable = { which = society_research_mult_planet_pop value = 0.2 }
				change_variable = { which = physics_research_mult_planet_pop value = 0.2 }
				change_variable = { which = engineering_research_mult_planet_pop value = 0.2 }
			}	
		}
		if = {        
			limit = { has_trait = "trait_presapient_earthbound" }     
			prev = { change_variable = { which = energy_mult_planet_pop value = 0.1 } }
		}
		if = {        
			limit = { has_trait = "trait_presapient_natural_intellectuals" }      
			prev = {
				change_variable = { which = society_research_mult_planet_pop value = 0.1 }
				change_variable = { which = physics_research_mult_planet_pop value = 0.1 }
				change_variable = { which = engineering_research_mult_planet_pop value = 0.1 }
				change_variable = { which = minerals_mult_planet_pop value = 0.1 }
			}	
		} 
		if = {
			limit = { 
				has_trait = "trait_cybernetic" 
				planet = { has_building = building_neuro_electric_amplifier } 
		  }
		  prev = {
				change_variable = { which = minerals_mult_planet_pop value = 0.15 }
				change_variable = { which = energy_mult_planet_pop value = 0.15 }
			}	
		} 
		else = {
			if = { 
				limit = { has_trait = "trait_robotic_1" }
				prev = {
					change_variable = { which = energy_mult_planet_pop value = -0.2 }
					change_variable = { which = minerals_mult_planet_pop value = 0.1 }       
					change_variable = { which = unity_mult_planet_pop value = -0.6 }
					change_variable = { which = society_research_mult_planet_pop value = -0.2 }
					change_variable = { which = physics_research_mult_planet_pop value = -0.2 }
					change_variable = { which = engineering_research_mult_planet_pop value = -0.2 }
				}	
			}           
			if = { 
				limit = { has_trait = "trait_robotic_2" }
				prev = {
					change_variable = { which = energy_mult_planet_pop value = -0.8 }
					change_variable = { which = minerals_mult_planet_pop value = 0.15 }       
					change_variable = { which = unity_mult_planet_pop value = -0.8 }
					change_variable = { which = society_research_mult_planet_pop value = -0.6 }
					change_variable = { which = physics_research_mult_planet_pop value = -0.6 }
					change_variable = { which = engineering_research_mult_planet_pop value = -0.6 }
				}	
			}
			if = { 
				limit = { has_trait = "trait_robotic_3" }
				prev = {
					change_variable = { which = energy_mult_planet_pop value = 0.2 }
					change_variable = { which = minerals_mult_planet_pop value = 0.2 }       
					change_variable = { which = unity_mult_planet_pop value = 0.2 }
					change_variable = { which = society_research_mult_planet_pop value = 0.2 }
					change_variable = { which = physics_research_mult_planet_pop value = 0.2 }
					change_variable = { which = engineering_research_mult_planet_pop value = 0.2 }
				}	
			}     
			if = { 
				limit = { has_trait = "trait_robot_power_drills" }
				prev = { change_variable = { which = minerals_mult_planet_pop value = 0.1 } }       
			}     
			if = { 
				limit = { has_trait = "trait_robot_harvesters" }
				prev = { change_variable = { which = food_mult_planet_pop value = 0.1 } }       
			}     
			if = { 
				limit = { has_trait = "trait_robot_logic_engines" }
				prev = {
					change_variable = { which = society_research_mult_planet_pop value = 0.1 }
					change_variable = { which = physics_research_mult_planet_pop value = 0.1 }
					change_variable = { which = engineering_research_mult_planet_pop value = 0.1 }
				}	
			}
			if = { 
				limit = { has_trait = "trait_robot_superconductive" }
				prev = { change_variable = { which = energy_mult_planet_pop value = 0.1 } }       
			}
			if = { 
				limit = { has_trait = "trait_robot_propaganda_machines" }
				prev = { change_variable = { which = unity_mult_planet_pop value = 0.1 } }
			}      
		}
	}   
}	

check_pop_species_rights = {
	if = {
		limit = {
			is_enslaved = yes
		}
		if = {
			limit = { has_slavery_type = { type = slavery_normal } }
			prev = {
				change_variable = { which = energy_mult_planet_pop value = -0.67 }
				change_variable = { which = minerals_mult_planet_pop value = 0.1 }       
				change_variable = { which = food_mult_planet_pop value = 0.1 }
				change_variable = { which = unity_mult_planet_pop value = -0.25 }
				change_variable = { which = society_research_mult_planet_pop value = -0.25 }
				change_variable = { which = physics_research_mult_planet_pop value = -0.25 }
				change_variable = { which = engineering_research_mult_planet_pop value = -0.25 }		
			}	
		}			
		if = {
			limit = { has_slavery_type = { type = slavery_domestic } }
			prev = {
				change_variable = { which = energy_mult_planet_pop value = -0.67 }		
				change_variable = { which = unity_mult_planet_pop value = -0.67 }
				change_variable = { which = society_research_mult_planet_pop value = -0.25 }
				change_variable = { which = physics_research_mult_planet_pop value = -0.25 }
				change_variable = { which = engineering_research_mult_planet_pop value = -0.25 }		
			}	
		}				
		if = {
			limit = { has_slavery_type = { type = slavery_military } }
			prev = {
				change_variable = { which = energy_mult_planet_pop value = -0.85 }		
				change_variable = { which = unity_mult_planet_pop value = -0.5 }
				change_variable = { which = society_research_mult_planet_pop value = -0.5 }
				change_variable = { which = physics_research_mult_planet_pop value = -0.5 }
				change_variable = { which = engineering_research_mult_planet_pop value = -0.5 }		
			}	
		}		
		else = {
			if = {
				limit = { has_living_standard = { type = living_standard_chemical_bliss } }
				prev = {
					change_variable = { which = energy_mult_planet_pop value = -0.4 }
					change_variable = { which = minerals_mult_planet_pop value = -0.4 }       
					change_variable = { which = food_mult_planet_pop value = -0.4 }
					change_variable = { which = unity_mult_planet_pop value = -0.4 }
					change_variable = { which = society_research_mult_planet_pop value = -0.4 }
					change_variable = { which = physics_research_mult_planet_pop value = -0.4 }
					change_variable = { which = engineering_research_mult_planet_pop value = -0.4 }		
				}	
			}	
			if = {
				limit = { has_living_standard = { type = living_standard_academic_privilege } }
				prev = {
					change_variable = { which = society_research_mult_planet_pop value = 0.1 }
					change_variable = { which = physics_research_mult_planet_pop value = 0.1 }
					change_variable = { which = engineering_research_mult_planet_pop value = 0.1 }		
				}	
			}	
		}
	}
}