namespace = mp_hyperlanes

event = {
	id = mp_hyperlanes.00
	hide_window = yes
	is_triggered_only = yes

	immediate = {	## DESTROY ALL HYPERLANES except some special cases
		every_planet = {
			
			if = {
				limit = {
					solar_system = {
						#OR = {
						#	has_star_flag = "low_mass"
						#	has_star_flag = "med_mass"
						#	has_star_flag = "high_mass"
						#	has_star_flag = "giant_mass"
						#}
						NOR = {
							#has_star_flag = "empire_home_system"
							has_star_flag = "advanced_empire_space"
							has_star_flag = "special_empire_space"
							has_star_flag = "marauder_system"
							has_star_flag = "fallen_shrouded"
							has_star_flag = "fallen_shielded_1"
							has_star_flag = "fallen_shielded_2"
							has_star_flag = "fallen_shielded_3"
							has_star_flag = "holy_system_1"
							has_star_flag = "holy_system_2"
							has_star_flag = "holy_system_3"
							has_star_flag = "holy_system_4"
							has_star_flag = "fe_xeno_zoo"
						}
					}
				}			
				
				solar_system = {
					mp_destroy_hyperlane = yes
				}
			}
			
		}
	}
	
}

event = {	## GENERATE NEW GALAXY HYPERLANE NETWORK - if triggered in mp_on_actions.txt, currently not used
	id = mp_hyperlanes.01
	hide_window = yes
	is_triggered_only = yes

	immediate = {	
		every_planet = {
			## Create a fixed number of hyperlanes for special system types
			if = {
				limit = {
					solar_system = {
						OR = { 
							is_star_class_sc_black_hole = yes
							is_star_class_sc_neutron_star = yes
							is_star_class_sc_pulsar = yes
						}
					}
					planet_size > 27
					solar_system = {
						NOT = { has_star_flag = "spawned_hyperlanes" }
					}
				}
				
				solar_system = {
					while = {
						count = 4 # Spawns 4 hyperlanes in systems with above star classes
						mp_create_hyperlane = yes
					}
					set_star_flag = "spawned_hyperlanes"
				}
			}
			if = {
				limit = {
					solar_system = {
						OR = { 
							is_star_class_sc_b = yes
							is_star_class_sc_k = yes
							is_star_class_sc_black_hole = yes
							is_star_class_sc_neutron_star = yes
							is_star_class_sc_pulsar = yes
						}
					}
					solar_system = {
						NOT = { has_star_flag = "spawned_hyperlanes" }
					}
				}
				
				solar_system = {
					while = {
						count = 3 # Spawns 3 hyperlanes in systems with above star classes
						mp_create_hyperlane = yes
					}
					set_star_flag = "spawned_hyperlanes"
				}
			}
			## Create variable number of hyperlanes based on the number of stellar objects in the system
			if = {
				limit = {
					OR = { 
						is_planet_class = pc_b_star
						is_planet_class = pc_k_star
						is_planet_class = pc_m_star
						is_planet_class = pc_a_star
						is_planet_class = pc_g_star
						is_planet_class = pc_m_giant_star
						is_planet_class = pc_black_hole
						is_planet_class = pc_neutron_star
						is_planet_class = pc_pulsar
					}
					#planet_size > 27
					solar_system = {
						NOT = { has_star_flag = "spawned_hyperlanes" }
					}
				}
				
				solar_system = {
					mp_create_hyperlane = yes
				}
			}
			
		}
	}
	
}

event = {	## GENERATE HYPERLANES IN HOME SYSTEM - triggered on_press_begin
	id = mp_hyperlanes.02
	hide_window = yes
	is_triggered_only = yes

	immediate = {	
		every_planet = {
			
			if = {
				limit = {
					solar_system = {
						has_star_flag = "empire_home_system"
						NOR = {
							has_star_flag = "spawned_hyperlanes"
							has_star_flag = "sol"
						}
					}
				}
				
				solar_system = {
					while = {
						count = 2 # Spawns 2 hyperlanes
						mp_create_hyperlane = yes
					}
					set_star_flag = "spawned_hyperlanes"
				}
			}
			
			if = {
				limit = { solar_system = { has_star_flag = "sol" } }
				solar_system = {
					every_neighbor_system = {
						ignore_hyperlanes = yes
						limit = {
							has_star_flag = alpha_centauri
							NOT = {	has_hyperlane_to = PREV	}
						}
						
						add_hyperlane = { 
							from = PREV
							to = THIS 
						}
					}
				}
				solar_system = {
					every_neighbor_system = {
						ignore_hyperlanes = yes
						limit = {
							has_star_flag = sirius
							NOT = {	has_hyperlane_to = PREV	}
						}
						
						add_hyperlane = { 
							from = PREV
							to = THIS 
						}
					}
				}
			}
			
		}
	}
	
}

ship_event = {	## GENERATE HYPERLANES IN SURVEYED SYSTEM - triggered on_survey
	id = mp_hyperlanes.03
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		from = {
			OR = { 
				is_planet_class = pc_b_star
				is_planet_class = pc_k_star
				is_planet_class = pc_m_star
				is_planet_class = pc_a_star
				is_planet_class = pc_g_star
				is_planet_class = pc_m_giant_star
				is_planet_class = pc_black_hole
				is_planet_class = pc_neutron_star
				is_planet_class = pc_pulsar
			}
			NOT = { has_planet_flag = "star_surveyed" }
		}
	}
	
	immediate = {
		solar_system = {
			if = { # Spawn 4 hyperlanes
				limit = {
					OR = {
						from = { is_planet_class = pc_b_star }
						#from = { is_planet_class = pc_k_star }
						#from = { is_planet_class = pc_m_star }
						#from = { is_planet_class = pc_a_star }
						#from = { is_planet_class = pc_g_star }
						#from = { is_planet_class = pc_m_giant_star }
						#from = { is_planet_class = pc_black_hole }
						#from = { is_planet_class = pc_neutron_star }
						#from = { is_planet_class = pc_pulsar }
					}
					from = { planet_size > 29 }
				}
				mp_create_hyperlane = yes
				mp_create_hyperlane = yes
				mp_create_hyperlane = yes
				mp_create_hyperlane = yes
			}	
			else_if = { # Spawn 3 hyperlanes
				limit = {
					OR = {
						from = { is_planet_class = pc_b_star }
						from = { is_planet_class = pc_k_star }
						#from = { is_planet_class = pc_m_star }
						#from = { is_planet_class = pc_a_star }
						#from = { is_planet_class = pc_g_star }
						#from = { is_planet_class = pc_m_giant_star }
						#from = { is_planet_class = pc_black_hole }
						#from = { is_planet_class = pc_neutron_star }
						#from = { is_planet_class = pc_pulsar }
					}
					from = { planet_size > 25 }
				}
				mp_create_hyperlane = yes
				mp_create_hyperlane = yes
				mp_create_hyperlane = yes
			}	
			else_if = { # Spawn 2 hyperlanes
				limit = {
					OR = {
						from = { is_planet_class = pc_b_star }
						from = { is_planet_class = pc_k_star }
						#from = { is_planet_class = pc_m_star }
						#from = { is_planet_class = pc_a_star }
						#from = { is_planet_class = pc_g_star }
						#from = { is_planet_class = pc_m_giant_star }
						#from = { is_planet_class = pc_black_hole }
						#from = { is_planet_class = pc_neutron_star }
						#from = { is_planet_class = pc_pulsar }
					}
					from = { planet_size < 26 }
				}
				mp_create_hyperlane = yes
				mp_create_hyperlane = yes
			}			
			else_if = { # Spawn 2 hyperlanes
				limit = {
					OR = {
						#from = { is_planet_class = pc_b_star }
						#from = { is_planet_class = pc_k_star }
						#from = { is_planet_class = pc_m_star }
						from = { is_planet_class = pc_a_star }
						#from = { is_planet_class = pc_g_star }
						from = { is_planet_class = pc_m_giant_star }
						#from = { from = { is_planet_class = pc_black_hole }
						#from = { is_planet_class = pc_neutron_star }
						#from = { is_planet_class = pc_pulsar }
					}
					from = { planet_size > 29 }
				}
				mp_create_hyperlane = yes
				mp_create_hyperlane = yes
			}				
			else_if = { # Spawn 1 hyperlane
				limit = {
					OR = {
						#from = { is_planet_class = pc_b_star }
						#from = { is_planet_class = pc_k_star }
						#from = { is_planet_class = pc_m_star }
						from = { is_planet_class = pc_a_star }
						#from = { is_planet_class = pc_g_star }
						from = { is_planet_class = pc_m_giant_star }
						#from = { is_planet_class = pc_black_hole }
						#from = { is_planet_class = pc_neutron_star }
						#from = { is_planet_class = pc_pulsar }
					}
					from = { planet_size < 30 }
				}
				mp_create_hyperlane = yes
			}					
			else_if = { # Spawn 1 hyperlane
				limit = {
					OR = {
						#from = { is_planet_class = pc_b_star }
						#from = { is_planet_class = pc_k_star }
						#from = { is_planet_class = pc_m_star }
						#from = { is_planet_class = pc_a_star }
						from = { is_planet_class = pc_g_star }
						#from = { is_planet_class = pc_m_giant_star }
						from = { is_planet_class = pc_black_hole }
						from = { is_planet_class = pc_neutron_star }
						from = { is_planet_class = pc_pulsar }
					}
					from = { planet_size > 24 }
				}
				mp_create_hyperlane = yes
			}						
			else_if = { # Spawn 1 hyperlane
				limit = {
					OR = {
						#from = { is_planet_class = pc_b_star }
						#from = { is_planet_class = pc_k_star }
						from = { is_planet_class = pc_m_star }
						#from = { is_planet_class = pc_a_star }
						#from = { is_planet_class = pc_g_star }
						#from = { is_planet_class = pc_m_giant_star }
						#from = { is_planet_class = pc_black_hole }
						#from = { is_planet_class = pc_neutron_star }
						#from = { is_planet_class = pc_pulsar }
					}
					from = { planet_size > 33 }
				}
				mp_create_hyperlane = yes
			}			
		}
		from = { set_planet_flag = "star_surveyed" }
	}
	
}

ship_event = {	## RESPAWNS ORBITAL DEPOSITS ON SYSTEMS GENERATED FROM THE STAR CHART DECISION - triggered on_survey, replaces vanilla deposits with this mod's engine's
	id = mp_hyperlanes.04
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		from = {
			solar_system = {
				has_star_flag = spawned_system
			}
		}
	}
	
	immediate = {
		solar_system = {
			reroll_system_deposits = yes
			remove_star_flag = spawned_system
		}
	}
	
}