namespace = ex_planets_enhanced_events

planet_event = { #this event fires upon terraforming completion, to see what it does look in scripted effects
	id = ex_planets_enhanced_events.1
	hide_window = yes	
	is_triggered_only = yes
	
	immediate = {
		remove_negative_planet_modifiers = yes
		add_positive_planet_modifier = yes
		if = { limit = { NOT = { has_planet_flag = ex_size_increased } } roll_size_increase = yes }		
	}
}

country_event = { #this event fires when a megastructure is built/upgraded, checking for ringworld
	id = ex_planets_enhanced_events.2
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {	root = { any_owned_planet = { is_planet_class = pc_ringworld_habitable NOT = { has_planet_flag = modifier_added } } } }
	
	immediate = { 
		root = {
			every_owned_planet = {
				limit = { is_planet_class = pc_ringworld_habitable NOT = { has_planet_flag = modifier_added } }
				add_modifier = { modifier = "ex_ring_world" days = -1 } 
			}	
		}
	}	
}	

event = { #this event fires only once, on a monthly pulse, adding/removing strategic resources and planet modifiers
	id = ex_planets_enhanced_events.3
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	
	immediate = { 
		if = { 			
			limit = { NOT = { has_global_flag = ex_resources_and_modifiers_rolled } }
			set_global_flag = ex_resources_and_modifiers_rolled
			if = { #this rolls the 6 unique resources		
				limit = { any_planet = { has_unique_deposit = no } }
				roll_unique_deposit_1 = yes 
				roll_unique_deposit_2 = yes 
				roll_unique_deposit_3 = yes 
				roll_unique_deposit_4 = yes 
				roll_unique_deposit_5 = yes 
				roll_unique_deposit_6 = yes 				
			}	
			every_planet = {
				if = { #this removes the vanilla resources that were changed into planetary resources and replaces them with regular deposits to make sure research/mining stations in orbit keep operating }
					limit = { has_strategic_resource = yes }
					if = { 
						limit = { 
							OR = {								
								has_deposit = d_engos_deposit
								has_deposit = d_pitharan_deposit
							}
						}	
						random_tile = { limit = { is_orbital_tile = yes } set_deposit = d_vast_society_deposit }
					}	
					if = { 
						limit = { 
							has_deposit = d_satramene_deposit
						}	
						random_tile = { limit = { is_orbital_tile = yes } set_deposit = d_vast_energy_deposit }
					}						
				}	
				if = { #this rolls the new strategic resources as well as the changed vanilla resources
					limit = { 
						solar_system = {
							NOR = {
								has_star_flag = empire_home_system
								has_star_flag = sol_system
								has_star_flag = deneb_system
							}
						}
						is_colonizable = yes 
						is_homeworld = no 
						is_capital = no 
						any_tile = { is_orbital_tile = no has_pop = no has_building = no has_deposit = no } 
					}	
					check_and_roll_planetary_deposits = yes 
				}	
				if = { #this adds the special planet modifiers
					limit = {
						OR = {
							is_planet_class = pc_ringworld_habitable
							is_planet_class = pc_nuked
							is_planet_class = pc_gaia
						}	
						NOT = { has_planet_flag = modifier_added }
					}			
					set_planet_flag = modifier_added
					if = {
						limit = { is_planet_class = pc_ringworld_habitable }			
						add_modifier = { modifier = "ex_ring_world" days = -1 } 													
					}	
					if = {
						limit = { is_planet_class = pc_gaia }			
						add_modifier = { modifier = "ex_gaia_world" days = -1 } 														
					}			
					if = {
						limit = { is_planet_class = pc_nuked }
						random_list = {
							30 = { add_modifier = { modifier = ex_tw } }		
							30 = { add_modifier = { modifier = ex_necropolis } }
							20 = { add_modifier = { modifier = ex_tw } add_modifier = { modifier = ex_necropolis } }
							20 = { } #this means no modifier will be applied
						}	
					}	
				}	
				
			}
			else = { break = yes }	
		}
	}		
}