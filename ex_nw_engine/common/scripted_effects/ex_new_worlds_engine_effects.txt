#do not change this file unless you know what you are doing, it contains effects used by the engine to perform various tasks. 

make_mammalian = {
	if = {
		limit = { exists = owner owner = { is_country_type = primitive } } 
		create_species = {
			name = this
			plural = this
			class = MAM
			portrait = random
			homeworld = this
			traits = this
			sapient = yes
			is_mod = no
			immortal = no
		}
		owner = { 
			every_owned_pop = { change_species = last_created }
			change_dominant_species = { species = last_created change_all = yes }	
		}	
	}
	if = { limit = { is_presapient_pop = yes }
		species = { save_event_target_as = presapient_event_target }
		create_species = {
			name = this
			plural = this
			class = PRE_MAM
			portrait = random
			homeworld = this
			traits = this
			sapient = yes
			is_mod = no
			immortal = no
		}			
		prev = {
			every_owned_pop = {
				limit = { is_same_species = event_target:presapient_event_target }
				change_species = last_created
			}	
		}
	}
}	

make_avian = {
	if = {
		limit = { exists = owner owner = { is_country_type = primitive } } 
		create_species = {
			name = this
			plural = this
			class = AVI
			portrait = random
			homeworld = this
			traits = this
			sapient = yes
			is_mod = no
			immortal = no
		}
		owner = { 
			every_owned_pop = { change_species = last_created }
			change_dominant_species = { species = last_created change_all = yes }	
		}	
	}
	if = { limit = { is_presapient_pop = yes }
		species = { save_event_target_as = presapient_event_target }
		create_species = {
			name = this
			plural = this
			class = PRE_AVI
			portrait = random
			homeworld = this
			traits = this
			sapient = yes
			is_mod = no
			immortal = no
		}			
		prev = {
			every_owned_pop = {
				limit = { is_same_species = event_target:presapient_event_target }
				change_species = last_created
			}	
		}
	}
}	

make_molluscoid = {
	if = {
		limit = { exists = owner owner = { is_country_type = primitive } } 
		create_species = {
			name = this
			plural = this
			class = MOL
			portrait = random
			homeworld = this
			traits = this
			sapient = yes
			is_mod = no
			immortal = no
		}
		owner = { 
			every_owned_pop = { change_species = last_created }
			change_dominant_species = { species = last_created change_all = yes }	
		}	
	}
	if = { limit = { is_presapient_pop = yes }
		species = { save_event_target_as = presapient_event_target }
		create_species = {
			name = this
			plural = this
			class = PRE_MOL
			portrait = random
			homeworld = this
			traits = this
			sapient = yes
			is_mod = no
			immortal = no
		}			
		prev = {
			every_owned_pop = {
				limit = { is_same_species = event_target:presapient_event_target }
				change_species = last_created
			}	
		}
	}
}

make_fungoid = {
	if = {
		limit = { exists = owner owner = { is_country_type = primitive } } 
		create_species = {
			name = this
			plural = this
			class = FUN
			portrait = random
			homeworld = this
			traits = this
			sapient = yes
			is_mod = no
			immortal = no
		}
		owner = { 
			every_owned_pop = { change_species = last_created }
			change_dominant_species = { species = last_created change_all = yes }	
		}	
	}	
	if = { limit = { is_presapient_pop = yes }
		species = { save_event_target_as = presapient_event_target }
		create_species = {
			name = this
			plural = this
			class = PRE_FUN
			portrait = random
			homeworld = this
			traits = this
			sapient = yes
			is_mod = no
			immortal = no
		}			
		prev = {
			every_owned_pop = {
				limit = { is_same_species = event_target:presapient_event_target }
				change_species = last_created
			}	
		}
	}
}

make_arthropoid = {
	if = {
		limit = { exists = owner owner = { is_country_type = primitive } } 
		create_species = {
			name = this
			plural = this
			class = ART
			portrait = random
			homeworld = this
			traits = this
			sapient = yes
			is_mod = no
			immortal = no
		}
		owner = { 
			every_owned_pop = { change_species = last_created }
			change_dominant_species = { species = last_created change_all = yes }	
		}	
	}	
	if = { limit = { is_presapient_pop = yes }
		species = { save_event_target_as = presapient_event_target }
		create_species = {
			name = this
			plural = this
			class = PRE_ART
			portrait = random
			homeworld = this
			traits = this
			sapient = yes
			is_mod = no
			immortal = no
		}			
		prev = {
			every_owned_pop = {
				limit = { is_same_species = event_target:presapient_event_target }
				change_species = last_created
			}	
		}
	}
}

make_reptilian = {
	if = {
		limit = { exists = owner owner = { is_country_type = primitive } } 
		create_species = {
			name = this
			plural = this
			class = REP
			portrait = random
			homeworld = this
			traits = this
			sapient = yes
			is_mod = no
			immortal = no
		}
		owner = { 
			every_owned_pop = { change_species = last_created }
			change_dominant_species = { species = last_created change_all = yes }	
		}	
	}	
	if = { limit = { is_presapient_pop = yes }
		species = { save_event_target_as = presapient_event_target }
		create_species = {
			name = this
			plural = this
			class = PRE_REP
			portrait = random
			homeworld = this
			traits = this
			sapient = yes
			is_mod = no
			immortal = no
		}			
		prev = {
			every_owned_pop = {
				limit = { is_same_species = event_target:presapient_event_target }
				change_species = last_created
			}	
		}
	}
}

make_humanoid = {
	if = {
		limit = { exists = owner owner = { is_country_type = primitive } } 
		create_species = {
			name = this
			plural = this
			class = HUM
			portrait = random
			homeworld = this
			traits = this
			sapient = yes
			is_mod = no
			immortal = no
		}
		owner = { 
			every_owned_pop = { change_species = last_created }
			change_dominant_species = { species = last_created change_all = yes }	
		}	
	}	
}	

make_plantoid = {
	if = {
		limit = { exists = owner owner = { is_country_type = primitive } } 
		create_species = {
			name = this
			plural = this
			class = PLANT
			portrait = random
			homeworld = this
			traits = this
			sapient = yes
			is_mod = no
			immortal = no
		}
		owner = { 
			every_owned_pop = { change_species = last_created }
			change_dominant_species = { species = last_created change_all = yes }	
		}
	}	
}	

remove_regular_planet_modifiers = {
	set_variable = { which = pm_points value = 0 }
	if = { limit = { has_modifier = hazardous_weather } remove_modifier = hazardous_weather change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = dangerous_wildlife } remove_modifier = dangerous_wildlife change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = weak_magnetic_field } remove_modifier = weak_magnetic_field change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = strong_magnetic_field } remove_modifier = strong_magnetic_field change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = unstable_tectonics } remove_modifier = unstable_tectonics change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = tidal_locked } remove_modifier = tidal_locked change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = chthonian_planet } remove_modifier = chthonian_planet change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = asteroid_impacts } remove_modifier = asteroid_impacts change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = extensive_moon_system } remove_modifier = extensive_moon_system change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = carbon_world } remove_modifier = carbon_world change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = wild_storms } remove_modifier = wild_storms change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = low_gravity } remove_modifier = low_gravity change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = high_gravity } remove_modifier = high_gravity change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = mineral_rich } remove_modifier = mineral_rich change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = ultra_rich } remove_modifier = ultra_rich change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = mineral_poor } remove_modifier = mineral_poor change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = titanic_life } remove_modifier = titanic_life change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = asteroid_belt } remove_modifier = asteroid_belt change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = natural_beauty } remove_modifier = natural_beauty change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = atmospheric_aphrodisiac } remove_modifier = atmospheric_aphrodisiac change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = atmospheric_hallucinogen } remove_modifier = atmospheric_hallucinogen change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = lush } remove_modifier = lush change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = bleak } remove_modifier = bleak change_variable = { which = pm_points value = 1 } }
	if = { limit = { has_modifier = irradiated } remove_modifier = irradiated change_variable = { which = pm_points value = 1 } }
}	

planet_modifier_spawn_engine = {
	if = {
		limit = { 
			check_modifier = { which = "pm_points" value = 1 }
			planet_modifier_spawn_table = yes
			break = yes
		}
	}	
	if = {
		limit = { 
			check_modifier = { which = "pm_points" value = 2 }
			planet_modifier_spawn_table = yes
			planet_modifier_spawn_table = yes
			break = yes
		}
	}	
	if = {
		limit = { 
			check_modifier = { which = "pm_points" value = 3 }
			planet_modifier_spawn_table = yes
			planet_modifier_spawn_table = yes
			planet_modifier_spawn_table = yes
			break = yes
		}
	}		
	if = {
		limit = { 
			check_modifier = { which = "pm_points" value = 4 }
			planet_modifier_spawn_table = yes
			planet_modifier_spawn_table = yes
			planet_modifier_spawn_table = yes
			planet_modifier_spawn_table = yes
			break = yes
		}
	}			
	if = {
		limit = { 
			check_modifier = { which = "pm_points" value = 5 }
			planet_modifier_spawn_table = yes
			planet_modifier_spawn_table = yes
			planet_modifier_spawn_table = yes
			planet_modifier_spawn_table = yes
			break = yes
		}
	}
}	

check_habitability_trait_correspondence = {
	if = { limit = { prev = { is_planet_class = pc_continental } has_trait = "trait_pc_continental_preference" set_timed_pop_flag = { flag = preference_correspondence days = 1 } } }
	if = { limit = { prev = { is_planet_class = pc_tropical } has_trait = "trait_pc_tropical_preference" set_timed_pop_flag = { flag = preference_correspondence days = 1 } } }
	if = { limit = { prev = { is_planet_class = pc_ocean } has_trait = "trait_pc_ocean_preference" set_timed_pop_flag = { flag = preference_correspondence days = 1 } } }
	if = { limit = { prev = { is_planet_class = pc_desert } has_trait = "trait_pc_desert_preference" set_timed_pop_flag = { flag = preference_correspondence days = 1 } } }
	if = { limit = { prev = { is_planet_class = pc_arid } has_trait = "trait_pc_arid_preference" set_timed_pop_flag = { flag = preference_correspondence days = 1 } } }
	if = { limit = { prev = { is_planet_class = pc_savannah } has_trait = "trait_pc_savannah_preference" set_timed_pop_flag = { flag = preference_correspondence days = 1 } } }
	if = { limit = { prev = { is_planet_class = pc_arctic } has_trait = "trait_pc_arctic_preference" set_timed_pop_flag = { flag = preference_correspondence days = 1 } } }
	if = { limit = { prev = { is_planet_class = pc_alpine } has_trait = "trait_pc_alpine_preference" set_timed_pop_flag = { flag = preference_correspondence days = 1 } } }
	if = { limit = { prev = { is_planet_class = pc_tundra } has_trait = "trait_pc_tundra_preference" set_timed_pop_flag = { flag = preference_correspondence days = 1 } } }
}

change_habitability_trait_correspondence = {
	if = {
		limit = { any_tile = { any_pop = { has_pop_flag = preference_correspondence } } }
		else = { break = yes }
		random_owned_pop = {
			limit = { has_pop_flag = preference_correspondence }
			if = {
				limit = { is_presapient_pop = yes }
				remove_pop_flag = preference_correspondence
				if = { 
					limit = { prev = { is_planet_class = pc_geocrystalline } }
					species = { save_event_target_as = presapient_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_geocrystalline_preference
							trait = random_presapient_trait							
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:presapient_target_species } }
							change_species = last_created
						}	
					}	
				}
				if = { 
					limit = { prev = { is_planet_class = pc_terraformed } }
					species = { save_event_target_as = presapient_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_terraformed_preference
							trait = random_presapient_trait							
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:presapient_target_species } }
							change_species = last_created
						}	
					}	
				}			
				if = { 
					limit = { prev = { is_planet_class = pc_greenhouse_cold } }
					species = { save_event_target_as = presapient_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_greenhouse_cold_preference
							trait = random_presapient_trait							
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:presapient_target_species } }
							change_species = last_created
						}	
					}	
				}				
				if = { 
					limit = { prev = { is_planet_class = pc_lush } }
					species = { save_event_target_as = presapient_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_lush_preference
							trait = random_presapient_trait							
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:presapient_target_species } }
							change_species = last_created
						}	
					}	
				}		
				if = { 
					limit = { prev = { is_planet_class = pc_retinal } }
					species = { save_event_target_as = presapient_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_retinal_preference
							trait = random_presapient_trait							
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:presapient_target_species } }
							change_species = last_created
						}	
					}	
				}
				if = { 
					limit = { prev = { is_planet_class = pc_marginal } }
					species = { save_event_target_as = presapient_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_marginal_preference
							trait = random_presapient_trait							
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:presapient_target_species } }
							change_species = last_created
						}	
					}	
				}
				if = { 
					limit = { prev = { is_planet_class = pc_marginal_dry } }
					species = { save_event_target_as = presapient_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_marginal_dry_preference
							trait = random_presapient_trait							
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:presapient_target_species } }
							change_species = last_created
						}	
					}	
				}	
				if = { 
					limit = { prev = { is_planet_class = pc_marginal_cold } }
					species = { save_event_target_as = presapient_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_marginal_cold_preference
							trait = random_presapient_trait							
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:presapient_target_species } }
							change_species = last_created
						}	
					}	
				}			
			}	
			if = {
				limit = { owner = { is_country_type = primitive } }
				remove_pop_flag = preference_correspondence
				if = { 
					limit = { prev = { is_planet_class = pc_geocrystalline } }
					species = { save_event_target_as = primitive_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_geocrystalline_preference
							trait = random_traits						
						}
						sapient = no
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:primitive_target_species } }
							change_species = last_created
						}						
					}	
				}
				if = { 
					limit = { prev = { is_planet_class = pc_terraformed } }
					species = { save_event_target_as = primitive_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_terraformed_preference
							trait = random_traits						
						}
						sapient = yes
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:primitive_target_species } }
							change_species = last_created
						}	
					}	
				}			
				if = { 
					limit = { prev = { is_planet_class = pc_greenhouse_cold } }
					species = { save_event_target_as = primitive_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_greenhouse_cold_preference
							trait = random_traits						
						}
						sapient = yes
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:primitive_target_species } }
							change_species = last_created
						}	
					}	
				}				
				if = { 
					limit = { prev = { is_planet_class = pc_lush } }
					species = { save_event_target_as = primitive_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_lush_preference
							trait = random_traits						
						}
						sapient = yes
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:primitive_target_species } }
							change_species = last_created
						}	
					}	
				}		
				if = { 
					limit = { prev = { is_planet_class = pc_retinal } }
					species = { save_event_target_as = primitive_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_retinal_preference
							trait = random_traits						
						}
						sapient = yes
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:primitive_target_species } }
							change_species = last_created
						}	
					}	
				}
				if = { 
					limit = { prev = { is_planet_class = pc_marginal } }
					species = { save_event_target_as = primitive_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_marginal_preference
							trait = random_traits						
						}
						sapient = yes
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:primitive_target_species } }
							change_species = last_created
						}	
					}	
				}
				if = { 
					limit = { prev = { is_planet_class = pc_marginal_dry } }
					species = { save_event_target_as = primitive_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_marginal_dry_preference
							trait = random_traits						
						}
						sapient = yes
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:primitive_target_species } }
							change_species = last_created
						}	
					}	
				}	
				if = { 
					limit = { prev = { is_planet_class = pc_marginal_cold } }
					species = { save_event_target_as = primitive_target_species }
					create_species = {
						name = this
						plural = this
						class = this
						portrait = this
						homeworld = this
						traits = { 
							trait = trait_pc_marginal_cold_preference
							trait = random_traits						
						}
						sapient = yes
						is_mod = no
						immortal = no
					}
					prev = {
						every_owned_pop = {
							limit = { species = { is_same_value = event_target:primitive_target_species } }
							change_species = last_created
						}	
					}	
				}			
			}	
			if = {
				limit = {
					OR = {
						NOT = { exists = owner }
						AND = {
							exists = owner
							owner = { NOT = { is_country_type = primitive } }
							OR = {
								NOT = { species = { is_same_value = owner.species } }
								is_subspecies = yes
							}	
						}
					}	
				}
				remove_pop_flag = preference_correspondence
				remove_habitability_trait = yes
				if = { 
					limit = { prev = { is_planet_class = pc_geocrystalline } }
					modify_species = { species = this add_trait = trait_pc_geocrystalline_preference }
				}
				if = { 
					limit = { prev = { is_planet_class = pc_terraformed } }
					modify_species = { species = this add_trait = trait_pc_terraformed_preference }
				}			
				if = { 
					limit = { prev = { is_planet_class = pc_greenhouse_cold } }
					modify_species = { species = this add_trait = trait_pc_greenhouse_cold_preference }
				}						
				if = { 
					limit = { prev = { is_planet_class = pc_retinal } }
					modify_species = { species = this add_trait = trait_pc_retinal_preference }
				}									
				if = { 
					limit = { prev = { is_planet_class = pc_lush } }
					modify_species = { species = this add_trait = trait_pc_lush_preference }
				}
				if = { 
					limit = { prev = { is_planet_class = pc_marginal } }
					modify_species = { species = this add_trait = trait_pc_marginal_preference }
				}			
				if = { 
					limit = { prev = { is_planet_class = pc_marginal_dry } }
					modify_species = { species = this add_trait = trait_pc_marginal_dry_preference }
				}			
				if = { 
					limit = { prev = { is_planet_class = pc_marginal_cold } }
					modify_species = { species = this add_trait = trait_pc_marginal_cold_preference }
				}						
			}
			change_habitability_trait_correspondence = yes
		}
	}	
}

remove_habitability_trait = {
	if = { limit = { has_trait = "trait_pc_continental_preference" } modify_species = { species = this remove_trait = trait_pc_continental_preference } }
	if = { limit = { has_trait = "trait_pc_tropical_preference" } modify_species = { species = this remove_trait = trait_pc_tropical_preference } }
	if = { limit = { has_trait = "trait_pc_ocean_preference" } modify_species = { species = this remove_trait = trait_pc_ocean_preference } }
	if = { limit = { has_trait = "trait_pc_desert_preference" } modify_species = { species = this remove_trait = trait_pc_desert_preference } }
	if = { limit = { has_trait = "trait_pc_arid_preference" } modify_species = { species = this remove_trait = trait_pc_arid_preference } }
	if = { limit = { has_trait = "trait_pc_savannah_preference" } modify_species = { species = this remove_trait = trait_pc_savannah_preference } }
	if = { limit = { has_trait = "trait_pc_arctic_preference" } modify_species = { species = this remove_trait = trait_pc_arctic_preference } }
	if = { limit = { has_trait = "trait_pc_tundra_preference" } modify_species = { species = this remove_trait = trait_pc_tundra_preference } }
	if = { limit = { has_trait = "trait_pc_alpine_preference" } modify_species = { species = this remove_trait = trait_pc_alpine_preference } }
}		