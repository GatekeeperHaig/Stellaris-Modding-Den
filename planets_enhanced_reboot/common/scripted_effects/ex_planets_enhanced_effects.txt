#the three effects below use timed planet flag to make sure the flags disappear after the operation is complete
#these flags are used in limit fields.

disable_spwan = {
	break = yes
}	

enable_modifier_roll = { 
	set_timed_planet_flag = { flag = modifier_roll_enabled days = 1 }
}

enable_orbital_sr_deposit_roll = {
	set_timed_planet_flag = { flag = orbital_sr_deposit_roll_enabled days = 1 }
}
	
enable_planetary_sr_deposit_roll = {
	set_timed_planet_flag = { flag = planetary_sr_deposit_roll_enabled days = 1 }
}	


remove_negative_planet_modifiers = {
	if = { limit = { has_modifier = atmospheric_hallucinogen } remove_modifier = atmospheric_hallucinogen }	
	if = { limit = { has_modifier = atmospheric_aphrodisiac }	remove_modifier = atmospheric_aphrodisiac }		
	if = { limit = { has_modifier = bleak_planet } remove_modifier = bleak_planet	}		
	if = { limit = { has_modifier = wild_storms }	remove_modifier = wild_storms }				
	if = { limit = { has_modifier = asteroid_impacts } remove_modifier = asteroid_impacts	}	
	if = { limit = { has_modifier = unstable_tectonics } remove_modifier = unstable_tectonics	}	
	if = { limit = { has_modifier = weak_magnetic_field }	remove_modifier = weak_magnetic_field }	
	if = { limit = { has_modifier = hazardous_weather } remove_modifier = hazardous_weather }	
	if = { limit = { has_modifier = dangerous_wildlife } remove_modifier = dangerous_wildlife }	
	if = { limit = { has_modifier = irradiated_planet } remove_modifier = irradiated_planet }
	if = { limit = { has_modifier = abandoned_terraforming } remove_modifier = abandoned_terraforming owner = { end_event_chain = "abandoned_terraforming_chain" } }
}	

add_positive_planet_modifier = {
	if = { limit = { NOT = { has_modifier = ex_terraformed } } add_modifier = { modifier = ex_terraformed days = -1 } }	
	if = { limit = { is_planet_class = pc_gaia NOT = { has_modifier = ex_gaia_world } }	add_modifier = { modifier = ex_gaia_world days = -1 } }					
}	

roll_size_increase = {
	set_planet_flag = ex_size_increased
	if = {
		limit = { planet_size < 15 }												
		random_list = {
			20 = { change_planet_size = 3 }		
			30 = { change_planet_size = 2 }		
			50 = { change_planet_size = 1 }	
		}	
	}
	if = {
		limit = { 
			planet_size > 15
			planet_size < 20
		}												
		random_list = {
			10 = { change_planet_size = 3 }		
			30 = { change_planet_size = 2 }		
			60 = { change_planet_size = 1 }	
		}	
	}	
	if = {
		limit = { 
			planet_size > 20
			planet_size < 23
		}												
		random_list = {
			30 = { change_planet_size = 2 }		
			70 = { change_planet_size = 1 }	
		}	
	}		
	if = {
		limit = { 
			OR = {
				planet_size = 23
				planet_size = 24
			}	
		}												
		random_list = {
			50 = { change_planet_size = 1 }		
			50 = { }	
		}	
	}			
}	

set_unique_deposit_1 = {
	random_system = {
		limit = {
			has_owner = no
			any_planet = {			
				is_colonizable = yes
				has_unique_resource = no
			}	
		}
		random_planet = { 
			limit = { 				
				is_colonizable = yes
				has_unique_resource = no
			}
			random_tile = { 
				if = { limit = { has_building = yes } remove_building = yes } 
				set_deposit = d_sr_ex_unique_1_deposit
			}	
		}				
	}
}

set_unique_deposit_2 = {
	random_system = {
		limit = {
			has_owner = no
			any_planet = {			
				is_colonizable = yes
				has_unique_resource = no
			}	
		}
		random_planet = { 
			limit = { 				
				is_colonizable = yes
				has_unique_resource = no
			}
			random_tile = { 
				if = { limit = { has_building = yes } remove_building = yes } 
				set_deposit = d_sr_ex_unique_2_deposit
			}	
		}				
	}
}

set_unique_deposit_3 = {
	random_system = {
		limit = {
			has_owner = no
			any_planet = {			
				is_colonizable = yes
				has_unique_resource = no
			}	
		}
		random_planet = { 
			limit = { 				
				is_colonizable = yes
				has_unique_resource = no
			}
			random_tile = { 
				if = { limit = { has_building = yes } remove_building = yes } 
				set_deposit = d_sr_ex_unique_3_deposit
			}	
		}				
	}
}

set_unique_deposit_4 = {
	random_system = {
		limit = {
			has_owner = no
			any_planet = {			
				is_colonizable = yes
				has_unique_resource = no
			}	
		}
		random_planet = { 
			limit = { 				
				is_colonizable = yes
				has_unique_resource = no
			}
			random_tile = { 
				if = { limit = { has_building = yes } remove_building = yes } 
				set_deposit = d_sr_ex_unique_4_deposit
			}	
		}				
	}
}

set_unique_deposit_5 = {
	random_system = {
		limit = {
			has_owner = no
			any_planet = {			
				is_colonizable = yes
				has_unique_resource = no
			}	
		}
		random_planet = { 
			limit = { 				
				is_colonizable = yes
				has_unique_resource = no
			}
			random_tile = { 
				if = { limit = { has_building = yes } remove_building = yes } 
				set_deposit = d_sr_ex_unique_5_deposit
			}	
		}				
	}
}

set_unique_deposit_6 = {
	random_system = {
		limit = {
			has_owner = no
			any_planet = {			
				is_colonizable = yes
				has_unique_resource = no
			}	
		}
		random_planet = { 
			limit = { 				
				is_colonizable = yes
				has_unique_resource = no
			}
			random_tile = { 
				if = { limit = { has_building = yes } remove_building = yes } 
				set_deposit = d_sr_ex_unique_6_deposit
			}	
		}				
	}
}

count_strategic_resources = {
	if = { limit = { has_resource = { type = sr_ex_unique_1 amount = 1 } } change_variable = { which = "sr_count" value = 1 } }
	if = { limit = { has_resource = { type = sr_ex_unique_2 amount = 1 } } change_variable = { which = "sr_count" value = 1 } }
	if = { limit = { has_resource = { type = sr_ex_unique_3 amount = 1 } } change_variable = { which = "sr_count" value = 1 } }
	if = { limit = { has_resource = { type = sr_ex_unique_4 amount = 1 } } change_variable = { which = "sr_count" value = 1 } }			
	if = { limit = { has_resource = { type = sr_ex_unique_5 amount = 1 } } change_variable = { which = "sr_count" value = 1 } }			
	if = { limit = { has_resource = { type = sr_ex_unique_6 amount = 1 } } change_variable = { which = "sr_count" value = 1 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_1 amount = 1 } } change_variable = { which = "sr_count" value = 1 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_2 amount = 1 } } change_variable = { which = "sr_count" value = 1 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_3 amount = 1 } } change_variable = { which = "sr_count" value = 1 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_4 amount = 1 } } change_variable = { which = "sr_count" value = 1 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_5 amount = 1 } } change_variable = { which = "sr_count" value = 1 } }			
	if = { limit = { has_resource = { type = sr_archeological_remains amount = 1 } } change_variable = { which = "sr_count" value = 1 } }			
	if = { limit = { has_resource = { type = sr_ex_pitharan amount = 1 } } change_variable = { which = "sr_count" value = 1 } }			
	if = { limit = { has_resource = { type = sr_ex_engos amount = 1 } } change_variable = { which = "sr_count" value = 1 } }			
	if = { limit = { has_resource = { type = sr_ex_satramene amount = 1 } } change_variable = { which = "sr_count" value = 1 } }			
	if = { limit = { has_resource = { type = sr_betharian amount = 1 } } change_variable = { which = "sr_count" value = 1 } }			
	if = { limit = { has_resource = { type = sr_alien_pets amount = 1 } } change_variable = { which = "sr_count" value = 1 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_1 amount = 2 } } change_variable = { which = "sr_count" value = 2 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_2 amount = 2 } } change_variable = { which = "sr_count" value = 2 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_3 amount = 2 } } change_variable = { which = "sr_count" value = 2 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_4 amount = 2 } } change_variable = { which = "sr_count" value = 2 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_5 amount = 2 } } change_variable = { which = "sr_count" value = 2 } }			
	if = { limit = { has_resource = { type = sr_archeological_remains amount = 2 } } change_variable = { which = "sr_count" value = 2 } }			
	if = { limit = { has_resource = { type = sr_ex_pitharan amount = 2 } } change_variable = { which = "sr_count" value = 2 } }			
	if = { limit = { has_resource = { type = sr_ex_engos amount = 2 } } change_variable = { which = "sr_count" value = 2 } }			
	if = { limit = { has_resource = { type = sr_ex_satramene amount = 2 } } change_variable = { which = "sr_count" value = 2 } }			
	if = { limit = { has_resource = { type = sr_betharian amount = 2 } } change_variable = { which = "sr_count" value = 2 } }			
	if = { limit = { has_resource = { type = sr_alien_pets amount = 2 } } change_variable = { which = "sr_count" value = 2 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_1 amount = 3 } } change_variable = { which = "sr_count" value = 3 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_2 amount = 3 } } change_variable = { which = "sr_count" value = 3 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_3 amount = 3 } } change_variable = { which = "sr_count" value = 3 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_4 amount = 3 } } change_variable = { which = "sr_count" value = 3 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_5 amount = 3 } } change_variable = { which = "sr_count" value = 3 } }			
	if = { limit = { has_resource = { type = sr_archeological_remains amount = 3 } } change_variable = { which = "sr_count" value = 3 } }			
	if = { limit = { has_resource = { type = sr_ex_pitharan amount = 3 } } change_variable = { which = "sr_count" value = 3 } }			
	if = { limit = { has_resource = { type = sr_ex_engos amount = 3 } } change_variable = { which = "sr_count" value = 3 } }			
	if = { limit = { has_resource = { type = sr_ex_satramene amount = 3 } } change_variable = { which = "sr_count" value = 3 } }			
	if = { limit = { has_resource = { type = sr_betharian amount = 3 } } change_variable = { which = "sr_count" value = 3 } }			
	if = { limit = { has_resource = { type = sr_alien_pets amount = 3 } } change_variable = { which = "sr_count" value = 3 } }				
	if = { limit = { has_resource = { type = sr_ex_planetary_1 amount = 4 } } change_variable = { which = "sr_count" value = 4 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_2 amount = 4 } } change_variable = { which = "sr_count" value = 4 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_3 amount = 4 } } change_variable = { which = "sr_count" value = 4 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_4 amount = 4 } } change_variable = { which = "sr_count" value = 4 } }			
	if = { limit = { has_resource = { type = sr_ex_planetary_5 amount = 4 } } change_variable = { which = "sr_count" value = 4 } }			
	if = { limit = { has_resource = { type = sr_archeological_remains amount = 4 } } change_variable = { which = "sr_count" value = 4 } }			
	if = { limit = { has_resource = { type = sr_ex_pitharan amount = 4 } } change_variable = { which = "sr_count" value = 4 } }			
	if = { limit = { has_resource = { type = sr_ex_engos amount = 4 } } change_variable = { which = "sr_count" value = 4 } }			
	if = { limit = { has_resource = { type = sr_ex_satramene amount = 4 } } change_variable = { which = "sr_count" value = 4 } }			
	if = { limit = { has_resource = { type = sr_betharian amount = 4 } } change_variable = { which = "sr_count" value = 4 } }			
	if = { limit = { has_resource = { type = sr_alien_pets amount = 4 } } change_variable = { which = "sr_count" value = 4 } }				
}	

set_planetary_deposits = {	
	if = {
		limit = { NOT = { has_planet_flag = deposit_roll_stop } }
		if = { 
			limit = { check_variable = { which = "sr_count" value = 0 }	}
			roll_planetary_sr_deposit = yes
		}	
		if = { 
			limit = { check_variable = { which = "sr_count" value = 1 }	}			
			random_list = { 75 = { roll_planetary_sr_deposit = yes } 25 = { set_planet_flag = deposit_roll_stop } }
		}	
		if = { 
			limit = { check_variable = { which = "sr_count" value = 2 }	}			
			random_list = { 50 = { roll_planetary_sr_deposit = yes } 50 = { set_planet_flag = deposit_roll_stop } }
		}	
		if = { 
			limit = { check_variable = { which = "sr_count" value = 3 }	}			
			random_list = { 25 = { roll_planetary_sr_deposit = yes } 75 = { set_planet_flag = deposit_roll_stop } }
		}	
		if = { 
			limit = { check_variable = { which = "sr_count" value = 4 }	}			
			set_planet_flag = deposit_roll_stop
		}						
		set_planetary_deposits = yes ## this loop is meant to make sure the roll is performed until the deposit_roll_stop flag is set.
	}
}	

roll_planetary_sr_deposit = {
	random_list = {
		2 = { 
			random_tile = { limit = { has_deposit = no has_building = no } add_deposit = d_sr_ex_engos_deposit } change_variable = { which = "sr_count" value = 1 }
			modifier = { 
				factor = 2
				OR = { 
					is_cold_planet_class = yes
					is_planet_class = pc_gaia
				}
			}
		}	
		2 = { 
			random_tile = { limit = { has_deposit = no has_building = no } add_deposit = d_sr_ex_pitharan_deposit } change_variable = { which = "sr_count" value = 1 }
			modifier = { 
				factor = 2
				OR = { 
					is_wet_planet_class = yes
					is_planet_class = pc_gaia
				}
			}		
		}
		2 = { 
			random_tile = { limit = { has_deposit = no has_building = no } add_deposit = d_sr_ex_satramene_deposit } change_variable = { which = "sr_count" value = 1 }
			modifier = { 
				factor = 1.5
				OR = { 
					is_wet_planet_class = yes
					is_cold_planet_class = yes
				}
			}					
		}
		2 = { 
			random_tile = { limit = { has_deposit = no has_building = no } add_deposit = d_sr_ex_planetary_1_deposit } change_variable = { which = "sr_count" value = 1 }
			modifier = { 
				factor = 2
				OR = { 
					is_nuked = yes 
					is_planet_class = pc_gaia
					is_dry_planet_class = yes
				}
			}						
		}
		2 = { 
			random_tile = { limit = { has_deposit = no has_building = no } add_deposit = d_sr_ex_planetary_2_deposit } change_variable = { which = "sr_count" value = 1 }
			modifier = { 
				factor = 2
				OR = { 
					is_nuked = yes 
					is_planet_class = pc_gaia
					is_cold_planet_class = yes					
				}
			}								
		}
		2 = { 
			random_tile = { limit = { has_deposit = no has_building = no } add_deposit = d_sr_ex_planetary_3_deposit } change_variable = { which = "sr_count" value = 1 }
			modifier = { 
				factor = 2
				OR = { 
					is_planet_class = pc_gaia
					is_dry_planet_class = yes
				}
			}
			modifier = { 
				factor = 2
				OR = { 
					has_planet_modifier = "pm_asteroid_impacts"
					has_planet_modifier = "pm_strong_magnetic_field"
				}
			}						
		}
		2 = { 
			random_tile = { limit = { has_deposit = no has_building = no } add_deposit = d_sr_ex_planetary_4_deposit } change_variable = { which = "sr_count" value = 1 }
			modifier = { 
				factor = 2
				OR = { 
					is_planet_class = pc_gaia
					is_cold_planet_class = yes
				}
			}			
		}
		2 = { 
			random_tile = { limit = { has_deposit = no has_building = no } add_deposit = d_sr_ex_planetary_5_deposit } change_variable = { which = "sr_count" value = 1 }
			modifier = { 
				factor = 2
				OR = { 
					is_planet_class = pc_gaia
					is_wet_planet_class = yes
				}
			}			
		}
		2 = { 
			random_tile = { limit = { has_deposit = no has_building = no } add_deposit = d_archeological_remains_deposit } change_variable = { which = "sr_count" value = 1 }
			modifier = { 
				factor = 5
				is_planet_class = pc_gaia
			}
			modifier = { 
				factor = 10
				is_nuked = yes
			}					
		}
		82 = { }
	}
}		


	

roll_orbital_sr_deposit = {
	random_list = {
		85 = { }
		2 = { 
			random_tile = { limit = { is_orbital_tile = yes } set_deposit = d_sr_ex_1_deposit }
			modifier = { factor = 2	is_inside_nebula = yes }
			modifier = {
				factor = 0
				OR = { is_toxic = no is_molten = no }
			}	
		}	
		2 = { 
			random_tile = { limit = { is_orbital_tile = yes } set_deposit = d_sr_ex_2_deposit }
			modifier = { factor = 2	 is_inside_nebula = yes }
			modifier = {
				factor = 0
				OR = { is_barren = no is_molten = no }
			}	
		}	
		2 = { 
			random_tile = { limit = { is_orbital_tile = yes } set_deposit = d_sr_ex_3_deposit }
			modifier = { factor = 2	 is_inside_nebula = yes }
			modifier = {
				factor = 0
				is_barren = no
			}	
		}					
		2 = { 
			random_tile = { limit = { is_orbital_tile = yes } set_deposit = d_sr_ex_4_deposit }
			modifier = { factor = 2	 is_inside_nebula = yes }
			modifier = {
				factor = 0
				is_collapsed_start = no
			}	
		}	
		2 = { 
			random_tile = { limit = { is_orbital_tile = yes } set_deposit = d_sr_ex_5_deposit }
			modifier = { factor = 2	 is_inside_nebula = yes }
			modifier = {
				factor = 0
				OR = { is_gas_giant = no is_molten = no }
			}	
		}						
		2 = { 
			random_tile = { limit = { is_orbital_tile = yes } set_deposit = d_sr_ex_6_deposit }
			modifier = { factor = 2	 is_inside_nebula = yes }
			modifier = {
				factor = 0
				OR = { is_gas_giant = no is_toxic = no } 
			}	
		}	
		2 = { 
			random_tile = { limit = { is_orbital_tile = yes } set_deposit = d_sr_ex_7_deposit }
			modifier = { factor = 2	 is_inside_nebula = yes }
			modifier = {
				factor = 0
				is_collapsed_start = no
			}	
		}	
		2 = { 
			random_tile = { limit = { is_orbital_tile = yes } set_deposit = d_sr_ex_8_deposit }
			modifier = { factor = 2	 is_inside_nebula = yes }
			modifier = {
				factor = 0
				OR = { is_barren = no is_toxic = no }
			}	
		}						
		2 = { 
			random_tile = { limit = { is_orbital_tile = yes } set_deposit = d_sr_ex_9_deposit }
			modifier = { factor = 2	 is_inside_nebula = yes }
			modifier = {
				factor = 0
				OR = { is_frozen = no is_toxic = no }
			}	
		}							
		2 = { 
			random_tile = { limit = { is_orbital_tile = yes } set_deposit = d_sr_ex_10_deposit }
			modifier = { factor = 2	 is_inside_nebula = yes }
			modifier = {
				factor = 0
				OR = { is_star = no is_asteroid = no }
			}	
		}								
	}
}	
