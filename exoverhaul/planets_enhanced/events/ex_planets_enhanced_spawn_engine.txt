namespace = spawn_engine

event = { #this event fires on game start - if the mod is loaded into a new game. 
	id = spawn_engine.0
	hide_window = yes
	is_triggered_only = yes	
	
	immediate = { 
		set_global_flag = ex_game_start_spawn_engine
		every_planet = { 
			if = {
				limit = {
					OR = {
						is_planet_class = pc_nuked
						is_planet_class = pc_gaia
						is_ringworld = yes
					}	
				}	
				modifier_spawn_table = yes					
			}				
			if = {
				limit = { 
					is_colonizable = yes
					is_capital = no
					is_homeworld = no					
					solar_system = { 
						NOR = {
							has_star_flag = empire_home_system
							has_star_flag = sol_system
							has_star_flag = deneb_system		
						}
					}						
				}
				planet_event = { id = spawn_engine.2 days = 1 }
			}	
			if = {
				limit = { 
					is_colonizable = no
					solar_system = { 
						NOR = {
							has_star_flag = empire_home_system
							has_star_flag = sol_system
							has_star_flag = deneb_system		
						}
					}	
					NOR = { 
						has_deposit = "d_immense_mineral_deposit"
						has_deposit = "d_immense_energy_deposit"
						has_deposit = "d_immense_society_deposit"
						has_deposit = "d_immense_physics_deposit"
						has_deposit = "d_immense_engineering_deposit"	
					}						
				}
				planet_event = { id = spawn_engine.3 days = 2 }
			}			
		}		
	}
}	

event = { 
	id = spawn_engine.1
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	
	#This event fires only once.
	
	trigger = { NOT = { has_global_flag = ex_game_start_spawn_engine } }
					
	immediate = {		
		every_planet = { 
			if = {
				limit = {
					OR = {
						is_planet_class = pc_nuked
						is_planet_class = pc_gaia
						is_ringworld = yes
					}	
				}	
				modifier_spawn_table = yes					
			}				
			if = {
				limit = { 
					is_colonizable = yes
					is_capital = no
					is_homeworld = no					
					solar_system = { 
						NOR = {
							has_star_flag = empire_home_system
							has_star_flag = sol_system
							has_star_flag = deneb_system		
						}
					}						
				}
				planet_event = { id = spawn_engine.2 days = 1 }
			}	
			if = {
				limit = { 
					is_colonizable = no
					solar_system = { 
						NOR = {
							has_star_flag = empire_home_system
							has_star_flag = sol_system
							has_star_flag = deneb_system		
						}
					}
					NOR = { 
						has_deposit = "d_immense_mineral_deposit"
						has_deposit = "d_immense_energy_deposit"
						has_deposit = "d_immense_society_deposit"
						has_deposit = "d_immense_physics_deposit"
						has_deposit = "d_immense_engineering_deposit"	
					}	
				}
				planet_event = { id = spawn_engine.3 days = 2 }
			}			
		}
	}
}

planet_event = { 
	id = spawn_engine.2
	hide_window = yes
	is_triggered_only = yes
	
	immediate = { 		
		set_variable = { which = sr_count value = 0 }
		unique_planetary_resource_spawn = yes
		count_strategic_resources = yes
		roll_planetary_resource_loop = yes		
		planet_event = { id = spawn_engine.4 days = 3 } 
	}	
}

planet_event = { 
	id = spawn_engine.3
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { has_orbital_strategic_resource = yes }
			flag_resource_station_types = yes 			
			resource_cleanup_table = yes
			orbital_deposit_respawn = yes
			remove_resource_station_types_flags = yes
		}
		orbital_resource_spawn = yes			
	}	
}		

planet_event = { 
	id = spawn_engine.4
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes 
	
	immediate = { 
		if = { limit = { has_global_flag = sr_ex_unique_1 } remove_global_flag = sr_ex_unique_1 }
		if = { limit = { has_global_flag = sr_ex_unique_2 } remove_global_flag = sr_ex_unique_2 }
		if = { limit = { has_global_flag = sr_ex_unique_3 } remove_global_flag = sr_ex_unique_3 }
		if = { limit = { has_global_flag = sr_ex_unique_4 } remove_global_flag = sr_ex_unique_4 }
		if = { limit = { has_global_flag = sr_ex_unique_5 } remove_global_flag = sr_ex_unique_5 }
		if = { limit = { has_global_flag = sr_ex_unique_6 } remove_global_flag = sr_ex_unique_6 }
	}
}	