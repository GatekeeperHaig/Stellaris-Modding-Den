namespace = cgm_pe_terraforming_events

planet_event = { 
	id = cgm_pe_terraforming_events.1
	is_triggered_only = yes
	hide_window = yes
	
	trigger = { has_planet_flag = cgm_terraforming_planet }
	
	immediate = { 
		if = { 
			limit = { has_planet_flag = terraformer_active }
			if = { 
				limit = { exists = owner }
				if = { 
					limit = { check_variable = { which = planet_terraforming_points value > 0 }	}
					if = { 
						limit = { check_variable = { which = tb_points value > 0 } }
						random_list = { 
							33.3 = { 
								random_tile = { 
									limit = { has_cgm_terraforming_blocker = yes }
									remove_blocker = yes
									change_variable = { which = tb_points value = -1 }
								}	
								modifier = { factor = 1.5 has_planet_flag = increased_terraformer_speed }
								modifier = { factor = 2.25 has_planet_flag = maximal_terraformer_speed }
							}
							66.6 = { }
						}	
					}		
					if = { 
						limit = { has_planet_flag = baseline_terraformer_speed }
						change_variable = { which = planet_terraforming_points value = -1 }	
					}
					else_if = { 
						limit = { has_planet_flag = increased_terraformer_speed }
						change_variable = { which = planet_terraforming_points value = -1.5 }
					}
					else = { change_variable = { which = planet_terraforming_points value = -2.25 } }
					if = { 
						limit = { check_variable = { which = planet_terraforming_points value > 0 }	}
						planet_event = { id = cgm_pe_terraforming_events.1 days = 360 }
					}
					else = { planet_event = { id = cgm_pe_terraforming_events.2 } }					
				}
				else = { 
					planet_event = { id = cgm_pe_terraforming_events.2 }	
				}					
			}
			else = { 
				remove_planet_flag = terraformer_active
				set_planet_flag = terraformer_inactive								
				change_variable = { which = planet_terraforming_points value = 1 }
				set_variable = { which = years_terraformer_inactive value = 1 }	
				planet_event = { id = cgm_pe_terraforming_events.1 days = 360 }
				roll_terraformer_catastrophe = yes 				
			}				
		}	
		else = { 
			set_planet_flag = terraformer_inactive
			planet_event = { id = cgm_pe_terraforming_events.1 days = 360 }								
			if = { 
				limit = { check_variable = { which = years_terraformer_inactive value > 0 } }
				change_variable = { which = years_terraformer_inactive value = 1 }
			}
			else = { set_variable = { which = years_terraformer_inactive value = 1 } }	
			roll_terraformer_catastrophe = yes 					
		}			
	}
}	

planet_event = {
	id = cgm_pe_terraforming_events.2
	is_triggered_only = yes
	picture = GFX_evt_alien_planet
	title = cgm_terraforming_successful.title
	desc = cgm_terraforming_successful.desc	
	
	immediate = { 
		remove_planet_flag = terraformer_active
		remove_planet_flag = baseline_terraformer_speed
		remove_planet_flag = increased_terraformer_speed
		remove_planet_flag = maximal_terraformer_speed
		remove_planet_flag = cgm_terraforming_planet
		set_planet_flag = cgm_terraformed_planet		
		random_tile = {
			limit = { has_building = building_terraformer }
			remove_building = yes										
		}		
		if = { 
			limit = { is_planet_class_pc_barren_terraforming = yes }
			change_pc = pc_arid
		}
		else_if = { 	
			limit = { is_planet_class_pc_barren_cold_terraforming = yes }
			change_pc = pc_tundra
		}	
		else_if = { 	
			limit = { is_planet_class_pc_molten_terraforming = yes }
			change_pc = pc_desert
		}		
		else_if = { 	
			limit = { is_planet_class_pc_toxic_terraforming = yes }
			change_pc = pc_continental
		}			
		else_if = { 	
			limit = { is_planet_class_pc_frozen_terraforming = yes }
			change_pc = pc_arctic
		}	
		else_if = { 	
			limit = { is_planet_class_pc_hothouse_terraforming = yes }
			change_pc = pc_desert
		}			
		else_if = { 	
			limit = { is_planet_class_pc_geomorteus_terraforming = yes }
			change_pc = pc_desert
		}			
		else_if = { 	
			limit = { is_planet_class_pc_geomorteus_terraforming = yes }
			change_pc = pc_tundra
		}					
		else_if = { 	
			limit = { is_planet_class_pc_greenhouse_hot_terraforming = yes }
			change_pc = pc_tropical
		}			
		else_if = { 	
			limit = { is_planet_class_pc_greenhouse_cold_terraforming = yes }
			change_pc = pc_ocean
		}			
	}
	option = { name = OK }
}	

planet_event = {
	id = cgm_pe_terraforming_events.3
	is_triggered_only = yes
	title = cgm_terraforming_catastrophe.title
	desc = cgm_terraforming_catastrophe.desc		
	immediate = { generate_catastrophe = yes }
	option = { name = OK }
}	

planet_event = {
	id = cgm_pe_terraforming_events.4
	is_triggered_only = yes
	hide_window = yes	
	immediate = { 
		remove_planet_flag = increased_terraformer_speed
		remove_planet_flag = maximal_terraformer_speed
		remove_planet_flag = baseline_terraformer_speed	
		remove_planet_flag = terraformer_active
		set_planet_flag = terraformer_inactive	
		random_tile = { 
			limit = { has_terraformer = yes } 
			remove_building = yes
			set_building = building_terraformer_inactive
		}			
	}
}	

ship_event = {
	id = cgm_pe_terraforming_events.5
	is_triggered_only = yes
	location = from
	title = "cgm_asteroidal_planet_found.name"
	desc = "cgm_asteroidal_planet_found.desc"
	picture = "GFX_evt_mining_station"		
	immediate = { 
		from = { generate_asteroidal_planetoid = yes } 
	}		
	option = { name = OK } 
}	