namespace = ex_planets_enhanced_menu

country_event = { #game_start_country event
	id = ex_planets_enhanced_menu.0		
	hide_window = yes
	fire_only_once = yes

	trigger = { 		
		is_multiplayer = yes
		is_ai = no		
	}	

	immediate = { set_country_flag = ex_game_host }
}

country_event = {
	id = ex_planets_enhanced_menu.1	
	title = planets_enhanced_menu_title
	desc = planets_enhanced_menu_title_desc
	picture = GFX_evt_ai_planet	
	fire_only_once = yes
	
	trigger = { 		
		OR = {
			AND = { 
				is_multiplayer = no
				is_ai = no
			}							
			AND = { 
				is_multiplayer = yes				
				has_country_flag = ex_game_host
			}	
		}			
		NOT = { has_global_flag = ex_menu_event_fired }
	}
	
	immediate = { 
		set_global_flag = ex_menu_event_fired #this is a fail safe - to make sure this doesn't fire a second time
		set_global_flag = planets_enhanced_active
		every_planet = {
			if = { 
				limit = { is_star = yes }		
				if = { 
					limit = { solar_system = { NOT = { any_planet = { NOT = { is_same_value = root } has_planet_flag = system_star_1 } } } }
					set_planet_flag = system_star_1				
					else = {
						if = { 
							limit = { solar_system = { NOT = { any_planet = { NOT = { is_same_value = root } has_planet_flag = system_star_2 } } } }
							set_planet_flag = system_star_2						
							else = {
								if = { 
									limit = { solar_system = { NOT = { any_planet = { NOT = { is_same_value = root } has_planet_flag = system_star_3 } } } }
									set_planet_flag = system_star_3						
								}
							}
						}
					}				
				}	
			}			
			if = {
				limit = { 
					is_gas_giant = yes
					has_moon = yes
					any_moon = { NOT = { has_planet_flag = gas_giant_moon } }
				}				
				every_moon = { 
					limit = { NOT = { has_planet_flag = gas_giant_moon } }
					set_planet_flag = gas_giant_moon
				}	
			}
		}		
	}
	
	option = {
		name = enable_new_resources
		custom_tooltip = enable_new_resources_tooltip
		hidden_effect = { 
			set_global_flag = ex_new_resources_enabled
			root = { country_event = { id = ex_planets_enhanced_menu.2 } }
		}	
	}	
	option = {
		name = enable_resource_rework_only
		custom_tooltip = enable_resource_rework_only_tooltip
		hidden_effect = { 
			set_global_flag = ex_resource_rework_only_enabled
			root = { country_event = { id = ex_planets_enhanced_menu.2 } }
		}	
	}		
	option = {
		name = enable_full_resource_rework
		custom_tooltip = enable_full_resource_rework_tooltip
		hidden_effect = { 
			set_global_flag = ex_full_resource_rework_enabled
			root = { country_event = { id = ex_planets_enhanced_menu.2 } }
		}	
	}		
}

country_event = {
	id = ex_planets_enhanced_menu.2	
	title = legendary_worlds_feature_title
	desc = legendary_worlds_feature_desc
	picture = GFX_evt_ai_planet	
	is_triggered_only = yes

	option = {
		name = enable_legendary_worlds
		custom_tooltip = enable_legendary_worlds_tooltip
		hidden_effect = { 
			set_global_flag = ex_legendary_worlds_active
			root = { country_event = { id = ex_planets_enhanced_menu.3 } }
		}
	}		
	option = { 
		name = disable_legendary_worlds
		custom_tooltip = disable_legendary_worlds_tooltip
		hidden_effect = { 
			set_global_flag = ex_legendary_worlds_disabled
			root = { country_event = { id = ex_planets_enhanced_menu.3 } }
		}	
	}
}

country_event = {
	id = ex_planets_enhanced_menu.3	
	title = cybertronic_worlds_feature_title
	desc = cybertronic_worlds_feature_desc
	picture = GFX_evt_ai_planet	
	is_triggered_only = yes

	option = {
		name = enable_cybertronic_worlds
		custom_tooltip = enable_cybertronic_worlds_tooltip
		hidden_effect = { 
			set_global_flag = ex_cybertronic_worlds_active
			every_planet = {
				limit = { solar_system = { starting_system = no } }
				planet_event = { id = ex_spawn_engine_10.1 }
			}
		}
	}		
	option = { 
		name = disable_cybertronic_worlds
		custom_tooltip = disable_cybertronic_worlds_tooltip
		hidden_effect = { 
			set_global_flag = ex_cybertronic_worlds_disabled
			every_planet = {
				limit = { solar_system = { starting_system = no } }
				planet_event = { id = ex_spawn_engine_10.1 }
			}			
		}	
	}
}