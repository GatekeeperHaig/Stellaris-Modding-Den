namespace = ex_spaceport_events

event = { #this event fires on game start and with a monthly pulse
	id = ex_spaceport_events.0
	hide_window = yes
	is_triggered_only = yes

	immediate = { 
		every_country = { 
			limit = {
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
			}	
			every_owned_planet = { 				
				limit = { has_spaceport = yes }
				planet_event = { id = ex_spaceport_events.2 }
				if = {
					limit = { 
						has_free_module_slot = yes
						OR = {
							AND = {
								is_spaceport_module_slot_free = 1
								NOT = { has_planet_flag = ex_spaceport_1 }
							}	
							AND = {
								is_spaceport_module_slot_free = 2
								NOT = { has_planet_flag = ex_spaceport_2 }
							}						
							AND = {
								is_spaceport_module_slot_free = 3
								NOT = { has_planet_flag = ex_spaceport_3 }
							}						
							AND = {
								is_spaceport_module_slot_free = 4
								NOT = { has_planet_flag = ex_spaceport_4 }
							}						
							AND = {
								is_spaceport_module_slot_free = 5
								NOT = { has_planet_flag = ex_spaceport_5 }
							}						
							AND = {
								is_spaceport_module_slot_free = 6
								NOT = { has_planet_flag = ex_spaceport_6 }
							}						
							AND = {
								is_spaceport_module_slot_free = 7
								NOT = { has_planet_flag = ex_spaceport_7 }
							}						
							AND = {
								is_spaceport_module_slot_free = 8
								NOT = { has_planet_flag = ex_spaceport_8 }
							}						
							AND = {
								is_spaceport_module_slot_free = 9
								NOT = { has_planet_flag = ex_spaceport_9 }
							}
							AND = {
								OR = {	
									AND = {
										sector_controlled = yes
										owner = {
											OR = {
												has_policy_flag = full_automation
												has_policy_flag = sector_automation
											}
										}
									}	
									AND = {
										sector_controlled = no
										OR = {
											owner = { has_policy_flag = full_automation }	
											AND = {
												owner = { has_policy_flag = core_edicts }
												OR = {
													has_planet_flag = spaceport_automation_economic
													has_planet_flag = spaceport_automation_stardock
													has_planet_flag = spaceport_automation_defensive
												}	
											}
										}										
									}								
								}
								NOT = { has_spaceport_module = module_under_construction }
							}							
						}		
					}
					planet_event = { id = ex_spaceport_events.10 }
				}					
			}	
		}
	}	
}

ship_event = { #this event fires the moment a spaceport is built
	id = ex_spaceport_events.1
	hide_window = yes
	is_triggered_only = yes

	immediate = { from = { planet_event = { id = ex_spaceport_events.10 } } }		
}

country_event = { #this event fires whenever a new technology is researched and also on a monthly pulse.
	id = ex_spaceport_events.2
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_owned_planet = {
			limit = { has_spaceport = yes }	
			if = {
				limit = { 
					owner = { tier_2_kinetics = yes }
					OR = { has_spaceport_module = spaceport_kinetic_weapon_1 has_spaceport_module = spaceport_kinetic_weapon_2 has_spaceport_module = spaceport_kinetic_weapon_3 }
					NOT = { has_planet_flag = spaceport_kinetic_t2_modifier }											
				}
				spaceport = { 
					random_owned_ship = { 
						add_modifier = { modifier = spaceport_kinetic_t2 days = -1 }
					}
				}
				set_planet_flag = spaceport_kinetic_t2_modifier
			}
			if = {
				limit = { 
					owner = { tier_3_kinetics = yes }
					OR = { has_spaceport_module = spaceport_kinetic_weapon_1 has_spaceport_module = spaceport_kinetic_weapon_2 has_spaceport_module = spaceport_kinetic_weapon_3 }
					NOT = { has_planet_flag = spaceport_kinetic_t3_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						remove_modifier = spaceport_kinetic_t2
						add_modifier = { modifier = spaceport_kinetic_t3 days = -1 }
					}
				}	
				remove_planet_flag = spaceport_kinetic_t2_modifier					
				set_planet_flag = spaceport_kinetic_t3_modifier					
			}
			if = {
				limit = { 
					owner = { tier_4_kinetics = yes }
					OR = { has_spaceport_module = spaceport_kinetic_weapon_1 has_spaceport_module = spaceport_kinetic_weapon_2 has_spaceport_module = spaceport_kinetic_weapon_3 }
					NOT = { has_planet_flag = spaceport_kinetic_t4_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						remove_modifier = spaceport_kinetic_t3
						add_modifier = { modifier = spaceport_kinetic_t4 days = -1 }
					}
				}	
				remove_planet_flag = spaceport_kinetic_t3_modifier					
				set_planet_flag = spaceport_kinetic_t4_modifier						
			}	
			if = {
				limit = { 
					owner = { tier_5_kinetics = yes }
					OR = { has_spaceport_module = spaceport_kinetic_weapon_1 has_spaceport_module = spaceport_kinetic_weapon_2 has_spaceport_module = spaceport_kinetic_weapon_3 }
					NOT = { has_planet_flag = spaceport_kinetic_t5_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						remove_modifier = spaceport_kinetic_t4
						add_modifier = { modifier = spaceport_kinetic_t5 days = -1 }
					}
				}	
				remove_planet_flag = spaceport_kinetic_t4_modifier					
				set_planet_flag = spaceport_kinetic_t5_modifier						
			}
			if = {
				limit = { 
					owner = { tier_2_energy = yes }							
					OR = { has_spaceport_module = spaceport_energy_weapon_1 has_spaceport_module = spaceport_energy_weapon_2 has_spaceport_module = spaceport_energy_weapon_3 }
					NOT = { has_planet_flag = spaceport_energy_t2_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						add_modifier = { modifier = spaceport_energy_t2 days = -1 }
					}
				}	
				set_planet_flag = spaceport_energy_t2_modifier
			}
			if = {
				limit = { 
					owner = { tier_3_energy = yes }			
					OR = { has_spaceport_module = spaceport_energy_weapon_1 has_spaceport_module = spaceport_energy_weapon_2 has_spaceport_module = spaceport_energy_weapon_3 }
					NOT = { has_planet_flag = spaceport_energy_t3_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						remove_modifier = spaceport_energy_t2
						add_modifier = { modifier = spaceport_energy_t3 days = -1 }
					}
				}	
				remove_planet_flag = spaceport_energy_t2_modifier					
				set_planet_flag = spaceport_energy_t3_modifier					
			}
			if = {
				limit = { 
					owner = { tier_4_energy = yes }			
					OR = { has_spaceport_module = spaceport_energy_weapon_1 has_spaceport_module = spaceport_energy_weapon_2 has_spaceport_module = spaceport_energy_weapon_3 }
					NOT = { has_planet_flag = spaceport_energy_t4_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						remove_modifier = spaceport_energy_t3
						add_modifier = { modifier = spaceport_energy_t4 days = -1 }
					}
				}	
				remove_planet_flag = spaceport_energy_t3_modifier					
				set_planet_flag = spaceport_energy_t4_modifier						
			}	
			if = {
				limit = { 
					owner = { tier_5_energy = yes }			
					OR = { has_spaceport_module = spaceport_energy_weapon_1 has_spaceport_module = spaceport_energy_weapon_2 has_spaceport_module = spaceport_energy_weapon_3 }
					NOT = { has_planet_flag = spaceport_energy_t5_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						remove_modifier = spaceport_energy_t4
						add_modifier = { modifier = spaceport_energy_t5 days = -1 }
					}
				}	
				remove_planet_flag = spaceport_energy_t4_modifier					
				set_planet_flag = spaceport_energy_t5_modifier						
			}	
			if = {
				limit = { 
					owner = { tier_2_explosives = yes }							
					OR = { has_spaceport_module = spaceport_explosive_weapon_1 has_spaceport_module = spaceport_explosive_weapon_2 has_spaceport_module = spaceport_explosive_weapon_3 }
					NOT = { has_planet_flag = spaceport_explosive_t2_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						add_modifier = { modifier = spaceport_explosive_t2 days = -1 }
					}
				}	
				set_planet_flag = spaceport_explosive_t2_modifier	
			}
			if = {
				limit = { 
					owner = { tier_3_explosives = yes }		
					OR = { has_spaceport_module = spaceport_explosive_weapon_1 has_spaceport_module = spaceport_explosive_weapon_2 has_spaceport_module = spaceport_explosive_weapon_3 }
					NOT = { has_planet_flag = spaceport_explosive_t3_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						remove_modifier = spaceport_explosive_t2
						add_modifier = { modifier = spaceport_explosive_t3 days = -1 }
					}
				}
				remove_planet_flag = spaceport_explosive_t2_modifier					
				set_planet_flag = spaceport_explosive_t3_modifier						
			}
			if = {
				limit = { 
					owner = { tier_4_explosives = yes }		
					OR = { has_spaceport_module = spaceport_explosive_weapon_1 has_spaceport_module = spaceport_explosive_weapon_2 has_spaceport_module = spaceport_explosive_weapon_3 }
					NOT = { has_planet_flag = spaceport_explosive_t4_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						remove_modifier = spaceport_explosive_t3
						add_modifier = { modifier = spaceport_explosive_t4 days = -1 }
					}
				}	
				remove_planet_flag = spaceport_explosive_t3_modifier					
				set_planet_flag = spaceport_explosive_t4_modifier											
			}	
			if = {
				limit = { 
					owner = { tier_5_explosives = yes }		
					OR = { has_spaceport_module = spaceport_explosive_weapon_1 has_spaceport_module = spaceport_explosive_weapon_2 has_spaceport_module = spaceport_explosive_weapon_3 }
					NOT = { has_planet_flag = spaceport_explosive_t5_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						remove_modifier = spaceport_explosive_t4
						add_modifier = { modifier = spaceport_explosive_t5 days = -1 }
					}
				}		
				remove_planet_flag = spaceport_explosive_t4_modifier					
				set_planet_flag = spaceport_explosive_t5_modifier											
			}
			if = {
				limit = { 
					owner = { tier_2_disruptors = yes }		
					OR = { has_spaceport_module = spaceport_disruptor_1 has_spaceport_module = spaceport_disruptor_2 has_spaceport_module = spaceport_disruptor_3 }
					NOT = { has_planet_flag = spaceport_disruptor_t2_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						add_modifier = { modifier = spaceport_disruptor_t2 days = -1 }
					}
				}		
				set_planet_flag = spaceport_disruptor_t2_modifier											
			}	
			if = {
				limit = { 
					owner = { tier_3_disruptors = yes }		
					OR = { has_spaceport_module = spaceport_disruptor_1 has_spaceport_module = spaceport_disruptor_2 has_spaceport_module = spaceport_disruptor_3 }
					NOT = { has_planet_flag = spaceport_disruptor_t3_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						remove_modifier = spaceport_disruptor_t2
						add_modifier = { modifier = spaceport_disruptor_t3 days = -1 }
					}
				}		
				remove_planet_flag = spaceport_disruptor_t2_modifier
				set_planet_flag = spaceport_disruptor_t3_modifier											
			}	
			if = {
				limit = { 
					owner = { tier_2_plasma = yes }		
					OR = { has_spaceport_module = spaceport_plasma_1 has_spaceport_module = spaceport_plasma_2 has_spaceport_module = spaceport_plasma_3 }
					NOT = { has_planet_flag = spaceport_plasma_t2_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						add_modifier = { modifier = spaceport_plasma_t2 days = -1 }
					}
				}		
				set_planet_flag = spaceport_plasma_t2_modifier											
			}	
			if = {
				limit = { 
					owner = { tier_3_plasma = yes }		
					OR = { has_spaceport_module = spaceport_plasma_1 has_spaceport_module = spaceport_plasma_2 has_spaceport_module = spaceport_plasma_3 }
					NOT = { has_planet_flag = spaceport_plasma_t3_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						remove_modifier = spaceport_plasma_t2
						add_modifier = { modifier = spaceport_plasma_t3 days = -1 }
					}
				}		
				remove_planet_flag = spaceport_plasma_t2_modifier
				set_planet_flag = spaceport_plasma_t3_modifier											
			}	
			if = {
				limit = { 
					owner = { tier_2_swarmer_missiles = yes }		
					OR = { has_spaceport_module = spaceport_swarmer_missile_1 has_spaceport_module = spaceport_swarmer_missile_2 has_spaceport_module = spaceport_swarmer_missile_3 }
					NOT = { has_planet_flag = spaceport_swarmer_missile_t2_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						add_modifier = { modifier = spaceport_swarmer_missile_t2 days = -1 }
					}
				}		
				set_planet_flag = spaceport_swarmer_missile_t2_modifier											
			}	
			if = {
				limit = { 
					owner = { tier_3_swarmer_missiles = yes }		
					OR = { has_spaceport_module = spaceport_swarmer_missile_1 has_spaceport_module = spaceport_swarmer_missile_2 has_spaceport_module = spaceport_swarmer_missile_3 }
					NOT = { has_planet_flag = spaceport_swarmer_missile_t3_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						remove_modifier = spaceport_swarmer_missile_t2
						add_modifier = { modifier = spaceport_swarmer_missile_t3 days = -1 }
					}
				}		
				remove_planet_flag = spaceport_swarmer_missile_t2_modifier
				set_planet_flag = spaceport_swarmer_missile_t3_modifier											
			}	
			if = {
				limit = { 
					owner = { tier_2_kinetic_artillery = yes }		
					OR = { has_spaceport_module = spaceport_kinetic_artillery_1 has_spaceport_module = spaceport_kinetic_artillery_2 has_spaceport_module = spaceport_kinetic_artillery_3 }
					NOT = { has_planet_flag = spaceport_kinetic_artillery_t2_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						add_modifier = { modifier = spaceport_kinetic_artillery_t2 days = -1 }
					}
				}		
				set_planet_flag = spaceport_kinetic_artillery_t2_modifier											
			}	
			if = {
				limit = { 
					owner = { tier_3_kinetic_artillery = yes }		
					OR = { has_spaceport_module = spaceport_kinetic_artillery_1 has_spaceport_module = spaceport_kinetic_artillery_2 has_spaceport_module = spaceport_kinetic_artillery_3 }
					NOT = { has_planet_flag = spaceport_kinetic_artillery_t3_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						remove_modifier = spaceport_kinetic_artillery_t2
						add_modifier = { modifier = spaceport_kinetic_artillery_t3 days = -1 }
					}
				}		
				remove_planet_flag = spaceport_kinetic_artillery_t2_modifier
				set_planet_flag = spaceport_kinetic_artillery_t3_modifier											
			}		
			if = {
				limit = { 
					owner = { tier_2_strike_craft = yes }		
					OR = { has_spaceport_module = spaceport_fighter_strike_craft_1 has_spaceport_module = spaceport_fighter_strike_craft_2 has_spaceport_module = spaceport_fighter_strike_craft_3 has_spaceport_module = spaceport_interceptor_strike_craft_1 has_spaceport_module = spaceport_interceptor_strike_craft_2 has_spaceport_module = spaceport_interceptor_strike_craft_3	}
					NOT = { has_planet_flag = spaceport_strike_craft_t2_modifier }					
				}
				spaceport = { 
					random_owned_ship = { 
						add_modifier = { modifier = spaceport_strike_craft_t2 days = -1 }
					}
				}		
				set_planet_flag = spaceport_strike_craft_t2_modifier											
			}	
			if = {
				limit = { 
					owner = { tier_3_strike_craft = yes }		
					OR = { has_spaceport_module = spaceport_fighter_strike_craft_1 has_spaceport_module = spaceport_fighter_strike_craft_2 has_spaceport_module = spaceport_fighter_strike_craft_3 has_spaceport_module = spaceport_interceptor_strike_craft_1 has_spaceport_module = spaceport_interceptor_strike_craft_2 has_spaceport_module = spaceport_interceptor_strike_craft_3	}
					NOT = { has_planet_flag = spaceport_strike_craft_t3_modifier }
					
				}
				spaceport = { 
					random_owned_ship = { 
						remove_modifier = spaceport_strike_craft_t2
						add_modifier = { modifier = spaceport_strike_craft_t3 days = -1 }
					}
				}		
				remove_planet_flag = spaceport_strike_craft_t2_modifier
				set_planet_flag = spaceport_strike_craft_t3_modifier											
			}					
		}
	}
}	

country_event = { #this event is triggered when a spaceport is destroyed (not dismantled).
	id = ex_spaceport_events.3
	hide_window = yes
	is_triggered_only = yes
	trigger = {	fromfrom = { is_ship_size = orbital_station } }			
    immediate = { fromfrom = { orbit = { planet = {	remove_spaceport_flags_and_modifiers = yes } } } }
}
				
country_event = { #this event is triggered when a spaceport is dismantled.
	id = ex_spaceport_events.4
	hide_window = yes
	is_triggered_only = yes
	trigger = { from = { is_ship_size = orbital_station } }	
	immediate = { from = { orbit = { planet = {	remove_spaceport_flags_and_modifiers = yes } } } }
}	

planet_event = { # this event runs on every tick (day), checking and adding/removing planet flags/modifiers as necessary. 
	id = ex_spaceport_events.10
	hide_window = yes
	is_triggered_only = yes
	
	#trigger = { 
	#	#NOT = { has_planet_flag = level_check_delay }
	#	has_owner = yes
	#	has_spaceport = yes		
	#	has_free_module_slot = yes		
	#}
	
	immediate = {
		if = {
			limit = { is_spaceport_module_slot_free = 9	}
			if = { 
				limit = { 
					NOT = { has_planet_flag = ex_spaceport_9 }
				}
				set_planet_flag = ex_spaceport_9
				update_spaceport_modifiers = yes				
			}			
			if = { limit = { NOT = { has_planet_flag = slot_9_free } } set_planet_flag = slot_9_free }
		}	
		if = {
			limit = { is_spaceport_module_slot_free = 8	}
			if = { 
				limit = { 
					NOR = { 
						has_planet_flag = ex_spaceport_8 
						has_planet_flag = ex_spaceport_9
					}
				}
				set_planet_flag = ex_spaceport_8
				update_spaceport_modifiers = yes				
			}			
			if = { limit = { NOT = { has_planet_flag = slot_8_free } } set_planet_flag = slot_8_free }
		}	
		if = {
			limit = { is_spaceport_module_slot_free = 7	}
			if = { 
				limit = { 
					NOR = { 
						has_planet_flag = ex_spaceport_7 
						has_planet_flag = ex_spaceport_8 
						has_planet_flag = ex_spaceport_9
					}
				}
				set_planet_flag = ex_spaceport_7
				update_spaceport_modifiers = yes				
			}			
			if = { limit = { NOT = { has_planet_flag = slot_7_free } } set_planet_flag = slot_7_free }
		}		
		if = {
			limit = { is_spaceport_module_slot_free = 6	}
			if = { 
				limit = { 
					NOR = { 
						has_planet_flag = ex_spaceport_6 
						has_planet_flag = ex_spaceport_7 
						has_planet_flag = ex_spaceport_8 
						has_planet_flag = ex_spaceport_9
					}
				}
				set_planet_flag = ex_spaceport_6
				update_spaceport_modifiers = yes	
			}			
			if = { limit = { NOT = { has_planet_flag = slot_7_free } } set_planet_flag = slot_6_free }
		}	
		if = {
			limit = { is_spaceport_module_slot_free = 5	}
			if = { 
				limit = { 
					NOR = { 
						has_planet_flag = ex_spaceport_5 
						has_planet_flag = ex_spaceport_6 
						has_planet_flag = ex_spaceport_7 
						has_planet_flag = ex_spaceport_8 
						has_planet_flag = ex_spaceport_9
					}
				}
				set_planet_flag = ex_spaceport_5	
			}			
			if = { limit = { NOT = { has_planet_flag = slot_5_free } } set_planet_flag = slot_5_free }
		}	
		if = {
			limit = { is_spaceport_module_slot_free = 4	}
			if = { 
				limit = { 
					NOR = { 
						has_planet_flag = ex_spaceport_4
						has_planet_flag = ex_spaceport_5 
						has_planet_flag = ex_spaceport_6 
						has_planet_flag = ex_spaceport_7 
						has_planet_flag = ex_spaceport_8 
						has_planet_flag = ex_spaceport_9
					}
				}
				set_planet_flag = ex_spaceport_4
				update_spaceport_modifiers = yes				
			}			
			if = { limit = { NOT = { has_planet_flag = slot_4_free } } set_planet_flag = slot_4_free }
		}	
		if = {
			limit = { is_spaceport_module_slot_free = 3	}
			if = { 
				limit = { 
					NOR = { 
						has_planet_flag = ex_spaceport_3
						has_planet_flag = ex_spaceport_4
						has_planet_flag = ex_spaceport_5 
						has_planet_flag = ex_spaceport_6 
						has_planet_flag = ex_spaceport_7 
						has_planet_flag = ex_spaceport_8 
						has_planet_flag = ex_spaceport_9
					}
				}
				set_planet_flag = ex_spaceport_3	
				update_spaceport_modifiers = yes
			}			
			if = { limit = { NOT = { has_planet_flag = slot_3_free } } set_planet_flag = slot_3_free }
		}	
		if = {
			limit = { is_spaceport_module_slot_free = 2	}
			if = { 
				limit = { 
					NOR = { 
						has_planet_flag = ex_spaceport_2
						has_planet_flag = ex_spaceport_3
						has_planet_flag = ex_spaceport_4
						has_planet_flag = ex_spaceport_5 
						has_planet_flag = ex_spaceport_6 
						has_planet_flag = ex_spaceport_7 
						has_planet_flag = ex_spaceport_8 
						has_planet_flag = ex_spaceport_9
					}
				}
				set_planet_flag = ex_spaceport_2
				update_spaceport_modifiers = yes				
			}			
			if = { limit = { NOT = { has_planet_flag = slot_2_free } } set_planet_flag = slot_2_free }
		}
		if = {
			limit = { is_spaceport_module_slot_free = 1	}
			if = { 
				limit = { 
					NOR = { 
						has_planet_flag = ex_spaceport_1
						has_planet_flag = ex_spaceport_2
						has_planet_flag = ex_spaceport_3
						has_planet_flag = ex_spaceport_4
						has_planet_flag = ex_spaceport_5 
						has_planet_flag = ex_spaceport_6 
						has_planet_flag = ex_spaceport_7 
						has_planet_flag = ex_spaceport_8 
						has_planet_flag = ex_spaceport_9
					}
				}
				set_planet_flag = ex_spaceport_1	
				update_spaceport_modifiers = yes
			}			
			if = { 
				limit = { 
					NOT = { has_policy_flag = spaceport_automation_disabled }					
					OR = {
						AND = {
							sector_controlled = no
							owner = { has_policy_flag = full_automation } 
						}
						sector_controlled = yes
					}	
				}
				set_base_weapon = yes
			}
			else = { set_planet_flag = slot_1_free }
		}			
		#set_timed_planet_flag = { flag = level_check_delay days = 180 }
	}
}	

#the events below are spaceport development automation events.

planet_event = { #this event checks the spaceport type, compares to the edict and replaces the spaceport itself as needed. 
	id = ex_spaceport_events.100
	hide_window = yes
	is_triggered_only = yes

	trigger = { 		
		NOT = { 
			has_planet_flag = spaceport_automation_disabled_local			
			owner = { has_policy_flag = spaceport_automation_disabled }
		}		
	}
	
	immediate = {
		if = {
			limit = { 
				has_planet_flag = spaceport_automation_economic				
			}	
			if = {
				limit = {	
					OR = {
						has_spaceport_module = economic_spaceport_kinetic
						has_spaceport_module = economic_spaceport_energy
						has_spaceport_module = economic_spaceport_explosives								
					}
				}
				scrap_stardock_modules = yes
				scrap_defensive_modules = yes
				flag_modules = yes
				check_module_flags = yes
				clear_slot_flag = yes
				flag_module_slots = yes
				construct_module = yes
				break = yes
			}	
			else = {
				check_spaceport_base_weapon = yes
				scrap_stardock_modules = yes
				scrap_defensive_modules = yes
				spaceport = { delete_ship = this }
				clear_slot_flag = yes
				rebuild_spaceport_economic = yes
				rebuild_economic_modules = yes
				flag_module_slots = yes					
				flag_modules = yes
				check_module_flags = yes				
				construct_module = yes
				break = yes				
			}
		}	
		if = {
			limit = { 
				has_planet_flag = spaceport_automation_stardock				
			}	
			if = {
				limit = {	
					OR = {
						has_spaceport_module = stardock_spaceport_kinetic
						has_spaceport_module = stardock_spaceport_energy
						has_spaceport_module = stardock_spaceport_explosives								
					}
				}
				scrap_economic_modules = yes
				scrap_defensive_modules = yes
				flag_modules = yes
				check_module_flags = yes
				clear_slot_flag = yes
				flag_module_slots = yes				
				construct_module = yes
				break = yes
			}	
			else = {
				check_spaceport_base_weapon = yes
				scrap_economic_modules = yes
				scrap_defensive_modules = yes
				spaceport = { delete_ship = this }
				clear_slot_flag = yes
				rebuild_spaceport_stardock = yes
				rebuild_stardock_modules = yes				
				flag_module_slots = yes					
				flag_modules = yes
				check_module_flags = yes				
				construct_module = yes
				break = yes		
			}	
		}	
		if = {
			limit = { 
				has_planet_flag = spaceport_automation_defensive				
			}	
			if = {
				limit = {	
					OR = {
						has_spaceport_module = defensive_spaceport_kinetic
						has_spaceport_module = defensive_spaceport_energy
						has_spaceport_module = defensive_spaceport_explosives								
					}
				}
				scrap_economic_modules = yes
				scrap_stardock_modules = yes
				flag_modules = yes
				check_module_flags = yes
				clear_slot_flag = yes
				flag_module_slots = yes					
				construct_module = yes
				break = yes
			}	
			else = {
				check_spaceport_base_weapon = yes
				scrap_economic_modules = yes
				scrap_stardock_modules = yes
				spaceport = { delete_ship = this }
				clear_slot_flag = yes
				rebuild_spaceport_defensive = yes
				rebuild_defensive_modules = yes
				flag_module_slots = yes					
				flag_modules = yes
				check_module_flags = yes				
				construct_module = yes
				break = yes	
			}	
		}
	}
}